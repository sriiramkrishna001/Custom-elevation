System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/intl","esri/core/lang","esri/geometry/geometryEngine","esri/geometry/geometryEngineAsync","esri/geometry/Polyline","esri/geometry/Point","esri/geometry/SpatialReference","esri/core/unitUtils","esri/Graphic","esri/Color","jimu-ui/advanced/chart-engine","esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/widgets/ElevationProfile/ElevationProfileViewModel","esri/core/reactiveUtils","esri/layers/ElevationLayer","esri/symbols/support/jsonUtils","esri/layers/FeatureLayer","esri/core/promiseUtils"],(function(e,t){var i={},s={},o={},n={},a={},l={},r={},d={},h={},c={},u={},p={},g={},v={},f={},m={},y={},S={},x={},b={},w={},L={},I={};return{setters:[function(e){i.AppMode=e.AppMode,i.BaseWidget=e.BaseWidget,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceSelectionMode=e.DataSourceSelectionMode,i.DataSourceStatus=e.DataSourceStatus,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.React=e.React,i.UrlManager=e.UrlManager,i.WidgetState=e.WidgetState,i.WidgetVersionManager=e.WidgetVersionManager,i.classNames=e.classNames,i.css=e.css,i.geometryUtils=e.geometryUtils,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.lodash=e.lodash,i.urlUtils=e.urlUtils},function(e){s.Alert=e.Alert,s.Button=e.Button,s.Card=e.Card,s.CardBody=e.CardBody,s.Checkbox=e.Checkbox,s.Collapse=e.Collapse,s.Icon=e.Icon,s.Label=e.Label,s.Loading=e.Loading,s.LoadingType=e.LoadingType,s.MultiSelect=e.MultiSelect,s.NumericInput=e.NumericInput,s.Option=e.Option,s.Popper=e.Popper,s.Select=e.Select,s.Switch=e.Switch,s.Tooltip=e.Tooltip,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default},function(e){a.default=e.default},function(e){l.default=e.default},function(e){r.default=e.default},function(e){d.default=e.default},function(e){h.default=e.default},function(e){c.default=e.default},function(e){u.default=e.default},function(e){p.default=e.default},function(e){g.default=e.default},function(e){v.AnimatedThemeAm5=e.AnimatedThemeAm5,v.AxisRendererXAm5=e.AxisRendererXAm5,v.AxisRendererYAm5=e.AxisRendererYAm5,v.BulletAm5=e.BulletAm5,v.CircleAm5=e.CircleAm5,v.ColumnSeries=e.ColumnSeries,v.ContainerAm5=e.ContainerAm5,v.DarkThemeAm5=e.DarkThemeAm5,v.Exporting=e.Exporting,v.LabelAm5=e.LabelAm5,v.LegendAm5=e.LegendAm5,v.LineSeriesAm5=e.LineSeriesAm5,v.NumberFormatterAm5=e.NumberFormatterAm5,v.RectangleAm5=e.RectangleAm5,v.ResponsiveThemeAm5=e.ResponsiveThemeAm5,v.TooltipAm5=e.TooltipAm5,v.TriangleAm5=e.TriangleAm5,v.ValueAxisAm5=e.ValueAxisAm5,v.XYChartAm5=e.XYChartAm5,v.XYCursorAm5=e.XYCursorAm5,v.colorAm5=e.colorAm5,v.createRoot=e.createRoot,v.p0=e.p0,v.p100=e.p100,v.p50=e.p50},function(e){f.default=e.default},function(e){m.default=e.default},function(e){y.default=e.default},function(e){S.default=e.default},function(e){x.default=e.default},function(e){b.default=e.default},function(e){w.default=e.default},function(e){L.default=e.default},function(e){I.default=e.default}],execute:function(){e((()=>{var e={22936:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M19.5 20a.5.5 0 0 0 0-1H1V1.5a.5.5 0 0 0-1 0V19a1 1 0 0 0 1 1zM14 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-.581 1.956a2 2 0 0 1-.88-.01L9.366 11.54a2 2 0 1 1-3.06.395l-1.639-2.05a2 2 0 1 1 .831-.562l1.538 1.923a2 2 0 0 1 1.452-.186l3.165-5.581a2 2 0 1 1 2.66.03l2.267 4.535Q16.784 10 17 10a2 2 0 1 1-1.313.492zM5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2m9-1a1 1 0 1 0 0-2 1 1 0 0 0 0 2" clip-rule="evenodd"></path></svg>'},56499:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m6.036 12.157 8.01-8.01a.5.5 0 1 1 .707.707l-8.01 8.01a1 1 0 0 1-1.415 0L1.146 8.682a.5.5 0 1 1 .708-.707z"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},56165:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1a1 1 0 0 0-1 1v17a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zm2 1H2v17h2zM9 6a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1zm2 1H9v12h2zM15 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1zm1 0h2v8h-2z" clip-rule="evenodd"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},34992:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14.497 7c.277 0 .501-.224.502-.5v-.001A.5.5 0 0 0 14.5 6h-12l2.604-3.135a.528.528 0 0 0-.805-.682L1.243 5.718A1 1 0 0 0 1 6.372V6.5a.5.5 0 0 0 .5.5zM1.503 9c-.277 0-.501.224-.502.5v.001c0 .276.224.499.499.499h12l-2.604 3.135a.528.528 0 0 0 .805.682l3.056-3.535A1 1 0 0 0 15 9.628V9.5a.5.5 0 0 0-.5-.5z" clip-rule="evenodd"></path></svg>'},12046:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.227 1.312c-.404-.404-1.045-.417-1.432-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431zm-8.114 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},46420:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.52.52 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.51.51 0 0 0 0-.73L7.5 0 3.654 3.743a.51.51 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},56509:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m10.308.302-.589.808 3.84 2.796L9 6.555l5.013 3.736.597-.801-3.796-2.832 4.576-2.657zM.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},27442:e=>{"use strict";e.exports=g},22089:e=>{"use strict";e.exports=p},81449:e=>{"use strict";e.exports=a},7343:e=>{"use strict";e.exports=I},62243:e=>{"use strict";e.exports=x},56504:e=>{"use strict";e.exports=u},33420:e=>{"use strict";e.exports=y},90422:e=>{"use strict";e.exports=h},80196:e=>{"use strict";e.exports=d},53205:e=>{"use strict";e.exports=c},77958:e=>{"use strict";e.exports=l},97050:e=>{"use strict";e.exports=r},25804:e=>{"use strict";e.exports=n},79282:e=>{"use strict";e.exports=b},85633:e=>{"use strict";e.exports=L},59620:e=>{"use strict";e.exports=m},8968:e=>{"use strict";e.exports=w},86392:e=>{"use strict";e.exports=S},10624:e=>{"use strict";e.exports=f},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=s},95080:e=>{"use strict";e.exports=v}},t={};function C(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,C),o.exports}C.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return C.d(t,{a:t}),t},C.d=(e,t)=>{for(var i in t)C.o(t,i)&&!C.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},C.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),C.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},C.p="";var A={};return C.p=window.jimuConfig.baseUrl,(()=>{"use strict";C.r(A),C.d(A,{__set_webpack_public_path__:()=>Ae,default:()=>Ce});var e,t=C(79244),i=C(14321);!function(e){e.IconText="ICONTEXT"}(e||(e={}));var s=C(62686);function o(e){var i;const s=null===(i=e.sys.color.surface)||void 0===i?void 0:i.paper;let o="65px",n="200px",a="250px",l="220px";return"125%"===e.ref.typeface.htmlFontSize?(o="95px",n="240px",a="290px",l="260px"):"87.5%"===e.ref.typeface.htmlFontSize?(o="60px",n="180px",a="235px",l="205px"):"75%"===e.ref.typeface.htmlFontSize&&(o="55px",n="175px",a="210px",l="190px"),t.css`
    overflow: auto;
    background-color: ${s};
    .widget-elevation-profile {
      width: 100%;
      height: 100%;
      min-height: 200px;

      .userGuideInfo {
        font-weight: 400;
        overflow-y: auto;
        height: ${o};
      }

      .front-section {
        min-width: ${"75%"===e.ref.typeface.htmlFontSize?"180px":"200px"};
        min-height: ${n};
        max-height: ${a};
        max-width: ${l};
      }

      .front-cards {
        border-radius: 7px;
      }

      .hidden {
        display: none;
      }

      .mainSection {
        padding: 20px;
      }

      .adjust-cards {
        gap: 2px 35px;
        width: 100%;
        max-height: -webkit-fill-available;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }

      .loading-text {
        position: absolute;
        top: 50%;
        left: 50%;
        text-align: center;
        transform: translate(-50%, 50%);
        font-size: var(--calcite-font-size--2);
        color: var(--calcite-color-text-1);
      }
  `}function n(e){let i="3px 8px 2px 12px";return"125%"===e.ref.typeface.htmlFontSize?i="0px 8px 2px 10px":"87.5%"===e.ref.typeface.htmlFontSize?i="4px 8px 2px 13px":"75%"===e.ref.typeface.htmlFontSize&&(i="5px 8px 2px 14px"),t.css`
    .actionButton {
      margin: 2px 0px 2px 5px;
    }

    .exportHintStyle {
      font-style: italic;
    }

    .exportLabel {
      margin: 0 !important;
      font-weight: 500;
    }

    .showCustomizeEdit {
      display: block;
    }

    .hideCustomizeEdit {
      display: none;
    }

    .style-setting--unit-selector {
      width: 50px;
      margin-left: 0px;
      background: var(--ref-palette-neutral-300);
      color: var(--ref-palette-black);
      height: 26px;
    }

    .unitsLabel {
      margin: ${i};
      border-radius: 0px;
      color: var(--ref-palette-black);
    }

    .invalidRange {
      font-style: italic;
      color: ${e.sys.color.error.main};
    }

    .invalidValue {
      height: 28px!important;
      border: 1px solid  ${e.sys.color.error.main};
      box-shadow: 0 0 1px  ${e.sys.color.error.main};
    }
  `}function a(e){let i="calc(100% - 83px)";return"125%"===e.ref.typeface.htmlFontSize?i="calc(100% - 92px)":"87.5%"===e.ref.typeface.htmlFontSize?i="calc(100% - 78px)":"75%"===e.ref.typeface.htmlFontSize&&(i="calc(100% - 73px)"),t.css`
    .ep-widget-header {
      .chart-actions {
        float: right;
        width: 32px;
        height: 32px;
        margin: 2px 5px 2px 5px;
      }
    }

    .ep-widget-bodyContainer {
      height: ${i};

      .alignInfo {
        padding-right: 40px;
        padding-left: 40px;
      }

      .userInfo .left-part {
        font-weight: 400;
      }
    }

    .floatingInfoMsg {
      .alignDismissibleInfo {
        position: absolute;
        left: 53px;
        width: calc(100% - 109px);
        z-index: 1;
        bottom: 55px;
        margin: 0 auto;
      }

      .alignDismissibleInfo .left-part .text-left {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        display: -webkit-box;
        font-weight: 400;
      }

      .showMessage {
        display: flex;
      }

      .hideMessage {
        display: none;
      }
    }

    .ep-widget-footer {
      line-height: 1.3;
      background-color: unset;
      border: 1px solid ${e.ref.palette.neutral[300]};
      width: calc(100% - 9px);
      margin-left: 4px;

      .hidden {
        display: none;
      }

      .footer-display {
        display: inline-block;
      }

      .actionButton {
        float: right;
      }
    }
  `}const l={_widgetLabel:"Elevation Profile",mapLoadingMsg:"Please wait while the map is loading",_action_select_label:"Select line",_action_view_label:"View Elevation Profile",selectLinesLabel:"Select line",selectLinesDesc:"Select a line to view the elevation.",selectButtonLabel:"Select",drawProfileLabel:"Draw profile",drawProfileDesc:"Draw a line to view the ground elevation.",drawButtonLabel:"Draw",backButtonLabel:"Reset",doneButtonLabel:"Done",clearButtonLabel:"Clear",newProfileButtonLabel:"New profile",drawUserInfo:"Click the map to place the first point and double-click to finish.",selectUserInfo:"Click a line on the map to begin.",emptyDrawStateWarning:"Draw on the map to generate an elevation profile.",emptySelectStateWarning:"Select a line on the map to generate an elevation profile.",infoMsgWhileDrawing:"Double-click or click Done to finish.",infoMsgWhileSelecting:"Select a connected line (yellow dotted) or click Done to finish.",addToSelectionWarning:"There are no additional connected lines to select.",chartRender:"Elevation Profile for the selected or drawn lines.",noFeaturesFound:"No selectable line in this location. Click a line from the selectable layers.",unknownError:"There was an unknown error generating the profile.",noProfileError:"No elevation information is available for this location.",tooComplexError:"Profile could not be generated. Input line is too complex.",tooComplexAnalysisError:"Analysis could not be performed for this line. Input line is too complex.",invalidGeometryError:"Profile could not be generated. Invalid geometry.",invalidElevationInfoError:"Profile could not be generated. Elevation options of the line are not supported.",chartStatistics:"Profile Statistics",chartFlip:"Reverse Direction",chartExport:"Export Profiles",settingsOptions:"Settings",exportHint:"Values will be exported to a CSV file.",customizeIntervalTooltip:"Customize at which distance interval values are extracted. This interval is only applied to ground and profile elevation values.",customizeIntervalLabel:"Customize interval",exportLabel:"Export",intervalErrorHint:"This value is out of range {xMin} - {xMax}.",intervalHintForInvalidEntry:"This value is out of range.",layerName:"Layer Name",intersectingLayerDisplayFieldLabel:"Attribute (Display Field)",oneFieldLabelForExport:"Field 1",twoFieldLabelForExport:"Field 2",statisticsLabel:"Profile Statistics",elevationUnitLabel:"Elevation units",distanceUnitLabel:"Distance units",selectableLayersLabel:"Selectable layers",selectLayerLabel:"Select layers",selectedLayerCount:"{selectedLayerCount} enabled",intersectingLayersLabel:"Intersecting layers",bufferSelectorLabel:"Intersection buffer",groundElevation:"Ground Elevation",uniformChartScaling:"Uniform scaling",uniformChartScalingInfo:"Use a uniform scale for the Distance and Elevation axes.",selectLayerWarning:"At least one layer should be enabled for selection",volumetricObj:"Volumetric objects",meters:"Meters",metersAbbreviation:"m",feet:"Feet",feetAbbreviation:"ft",kilometers:"Kilometers",kilometersAbbreviation:"km",miles:"Miles",milesAbbreviation:"mi",yards:"Yards",yardsAbbreviation:"yd",noStatsValue:"No value",distanceLabel:"Distance",elevationLabel:"Elevation",graphDistanceLabel:"Distance - {unit}",graphElevationLabel:"Elevation - {unit}",expandLegend:"Expand Legend",maxDistance:"MAX Distance",minElevation:"MIN Elevation",maxElevation:"MAX Elevation",avgElevation:"AVG Elevation",elevationGain:"Elevation Gain",elevationLoss:"Elevation Loss",maxPositiveSlope:"MAX Positive Slope",maxNegativeSlope:"MAX Negative Slope",avgPositiveSlope:"AVG Positive Slope",avgNegativeSlope:"AVG Negative Slope"},r=C(22936),d=C(56509),h=C(45508),c=C(12046),u=C(96300),p=C(56499),g=C(9044),v=C(56165),f=C(34992),m=C(93303),y=C(30655),S=()=>({epIcon:{elevationIcon:r,selectIcon:d,infoIcon:h,drawIcon:c,arrowNavBack:u,doneIcon:p,clearIcon:g,chartIcon:v,flipIcon:f,settingsIcon:m,iconExpandCollapse:y}}),x=[{value:"meters",abbreviation:"metersAbbreviation"},{value:"feet",abbreviation:"feetAbbreviation"},{value:"kilometers",abbreviation:"kilometersAbbreviation"},{value:"miles",abbreviation:"milesAbbreviation"},{value:"yards",abbreviation:"yardsAbbreviation"}],b=[{value:"maxDistance",label:l.maxDistance},{value:"minElevation",label:l.minElevation},{value:"maxElevation",label:l.maxElevation},{value:"avgElevation",label:l.avgElevation},{value:"elevationGain",label:l.elevationGain},{value:"elevationLoss",label:l.elevationLoss},{value:"maxPositiveSlope",label:l.maxPositiveSlope},{value:"maxNegativeSlope",label:l.maxNegativeSlope},{value:"avgPositiveSlope",label:l.avgPositiveSlope},{value:"avgNegativeSlope",label:l.avgNegativeSlope}];var w,L;!function(e){e.NoVisibleProfiles="no-visible-profiles",e.InvalidGeometry="invalid-geometry",e.TooComplex="too-complex",e.InvalidElevationInfo="invalid-elevation-info",e.UnknownError="unknown-error",e.RefinedButNoChartData="refined-but-no-chart-data",e.None="none"}(w||(w={})),function(e){e.MaxDistance="maxDistance",e.MinElevation="minElevation",e.MaxElevation="maxElevation",e.AvgElevation="avgElevation",e.ElevationGain="elevationGain",e.ElevationLoss="elevationLoss",e.MaxPositiveSlope="maxPositiveSlope",e.MaxNegativeSlope="maxNegativeSlope",e.AvgPositiveSlope="avgPositiveSlope",e.AvgNegativeSlope="avgNegativeSlope"}(L||(L={}));const I=e=>{switch(e){case L.MaxPositiveSlope:return L.MaxNegativeSlope;case L.MaxNegativeSlope:return L.MaxPositiveSlope;case L.AvgPositiveSlope:return L.AvgNegativeSlope;case L.AvgNegativeSlope:return L.AvgPositiveSlope;case L.ElevationLoss:return L.ElevationGain;case L.ElevationGain:return L.ElevationLoss}return e};var E;function D(e){const i=(e,s)=>{const o=(null==e?void 0:e.isDataSourceSet)&&(null==e?void 0:e.getChildDataSources());o&&o.forEach((e=>{(null==e?void 0:e.isDataSourceSet)?i(e,s):(null==e?void 0:e.type)===t.DataSourceTypes.FeatureLayer&&s.push(e)}))},s=[],o=t.DataSourceManager.getInstance(),n=null==o?void 0:o.getDataSource(e);return i(n,s),s}function M(e,t){let i=null==e?void 0:e.profileChartSettings.elevationUnit,s=null==e?void 0:e.profileChartSettings.linearUnit;return(null==e?void 0:e.profileChartSettings.elevationUnit)||(i="english"===(null==t?void 0:t.units)?"feet":"meters"),(null==e?void 0:e.profileChartSettings.linearUnit)||(s="english"===(null==t?void 0:t.units)?"miles":"kilometers"),[i,s]}!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(E||(E={}));const F=e=>{switch(e){case"feet":return E.Feet;case"miles":return E.Miles;case"kilometers":return E.Kilometers;case"meters":return E.Meters;case"yards":return E.Yards;default:return 1e3}},P=e=>"english"===(null==e?void 0:e.units)?"feet":"meters",O=(e,t,i)=>(i||(i=[]),null==t||t.forEach((t=>{const s=i.filter((e=>e.dataSourceId===t.layerId)),o=(null==s?void 0:s.length)>0?s[0]:{dataSourceId:t.layerId,mainDataSourceId:t.layerId,rootDataSourceId:e,fields:[]};("one"===t.elevationSettings.type||"two"===t.elevationSettings.type)&&t.elevationSettings.field1&&!o.fields.includes(t.elevationSettings.field1)&&o.fields.push(t.elevationSettings.field1),"two"===t.elevationSettings.type&&t.elevationSettings.field2&&!o.fields.includes(t.elevationSettings.field2)&&o.fields.push(t.elevationSettings.field2),t.displayField&&!o.fields.includes(t.displayField)&&o.fields.push(t.displayField),0===s.length&&i.push(o)})),i);function V(e,t,i){return T(e,t,i)}function T(e,t,i){return t===i?+e:+e/j(t)*j(i)}function j(e){let t=1;switch(e){case"meters":t=1;break;case"kilometers":t=.001;break;case"feet":t=1/.3048;break;case"yards":t=1/.9144;break;case"miles":t=1/1609.344}return t}function R(e,t){const i=Math.floor(Math.log10(e)),s=e/Math.pow(10,i);let o;return o=t?s<1.5?1:s<3?2:s<5?2.5:s<7?5:10:s<=1?1:s<=2?2:s<=3?2.5:s<=5?5:10,o*Math.pow(10,i)}var k=C(25804),U=C(81449),N=C(77958),B=C(97050),z=C(80196),G=C(90422),_=C(53205),W=C(56504),H=C(22089),Y=C(27442);const X=(e,t)=>{var i,s,o,n;const a=e.layer;let l,r,d,h,c,u,p,g,v;if(r=!1,l={type:"simple-marker",style:"square",color:[0,255,255,0],outline:{color:t||"#00FFFF",width:2}},l.size=30,null==a?void 0:a.renderer)if(a.renderer.symbol)r=!0,l=q(l,a.renderer.symbol);else if((null===(i=a.renderer.infos)||void 0===i?void 0:i.length)>0){for(c=0;c<a.renderer.infos.length;c++)a.typeIdField?d=e.attributes[a.typeIdField]:a.renderer.attributeField&&(d=e.attributes[a.renderer.attributeField]),h=a.renderer.infos[c].value,null!=d&&""!==d&&null!=h&&""!==h&&d.toString()===h.toString()&&(r=!0,l=q(l,a.renderer.infos[c].symbol));r||a.renderer.defaultSymbol&&(r=!0,l=q(l,a.renderer.defaultSymbol))}if((null===(s=null==a?void 0:a.graphics)||void 0===s?void 0:s.length)>0&&a._getSymbol(e)){u=e.getShape(),(null==u?void 0:u.shape)?u.shape.hasOwnProperty("r")?(r=!0,l.size=2*u.shape.r+10):u.shape.hasOwnProperty("width")&&(r=!0,(null===(n=null===(o=a.renderer)||void 0===o?void 0:o.infos)||void 0===n?void 0:n.length)>0&&(l=q(l,a.renderer.infos[0].symbol)),l.size=u.shape.width+10):a.renderer.visualVariables&&(p=a._getRenderer(e),g=(e=>{let t=null;return e.renderer.visualVariables&&e.renderer.visualVariables.forEach((e=>{"sizeInfo"===e.type&&(t=e)})),t})(a),g&&(v=p.getSize(e,{sizeInfo:g,shape:a._getSymbol(e),resolution:a&&a.getResolutionInMeters&&a.getResolutionInMeters()}),null!==v&&(l.size=v+10)))}return new H.default({geometry:e.geometry,symbol:l,attributes:e.attributes})},q=(e,t)=>{let i,s,o;return t.hasOwnProperty("height")&&t.hasOwnProperty("width")&&(i=t.height,s=t.width,o=i>s?i:s,o+=10,e.size=o),t.hasOwnProperty("size")&&(!o||o<t.size)&&(e.size=t.size+10),t.hasOwnProperty("xoffset")&&(e.xoffset=t.xoffset),t.hasOwnProperty("yoffset")&&(e.yoffset=t.yoffset),e},J=(e,t)=>{var i,s,o,n;const a=e.layer;let l,r,d,h;if(l=4,null==a?void 0:a.renderer)if(null===(i=a.renderer.symbol)||void 0===i?void 0:i.hasOwnProperty("width"))l=a.renderer.symbol.width;else if((null===(o=null===(s=a.renderer)||void 0===s?void 0:s.infos)||void 0===o?void 0:o.length)>0)for(h=0;h<a.renderer.infos.length;h++)a.typeIdField?r=e.attributes[a.typeIdField]:a.renderer.attributeField&&(r=e.attributes[a.renderer.attributeField]),d=a.renderer.infos[h].value,null!=r&&""!==r&&null!=d&&""!==d&&r.toString()===d.toString()&&a.renderer.infos[h].symbol.hasOwnProperty("width")&&(l=a.renderer.infos[h].symbol.width);else(null===(n=a.renderer.defaultSymbol)||void 0===n?void 0:n.hasOwnProperty("width"))&&(l=a.renderer.defaultSymbol.width);const c={type:"simple-line",color:t||"#00FFFF",width:4,style:"solid",outline:{color:"#00FFFF",width:l}};return new H.default({geometry:e.geometry,symbol:c,attributes:e.attributes})},K=(e,t)=>{const i={type:"simple-fill",color:[0,255,255,0],style:"solid",outline:{color:t||"#00FFFF",width:2}};return new H.default({geometry:e.geometry,symbol:i,attributes:e.attributes})},Z={fontFamily:"Avenir Next",axisGridStroke:"#f4f4f4",axisLabelsFontWeight:"500",axisTooltipFontSize:12,axisTooltipPaddingTop:Math.round(3),axisTooltipPaddingBottom:Math.round(3),axisTooltipPaddingHorizontal:Math.round(3.75),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(6),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.95,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(3.75),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.95},$=Object.assign(Object.assign({},Z),{axisGridStroke:"#323232"});var Q=C(95080),ee=function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function a(e){try{r(s.next(e))}catch(e){n(e)}}function l(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}r((s=s.apply(e,t||[])).next())}))};const te="meters";class ie extends t.React.PureComponent{constructor(e){var s,o,n;super(e),this._chartContainer=t.React.createRef(),this.nls=e=>{const t=Object.assign({},l,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentWillUnmount=()=>{this.chart&&(this.chart.root.dispose(),this.chart=null)},this.componentDidUpdate=e=>{var t,i,s,o,n,a,l,r,d,h,c,u,p,g,v,f,m,y,S,x,b,w,L,I,C,A,E,D,M,F,P,O,V,T,j,R,k,U,N,B,z,G,_,W,H,Y,X,q,J,K,Z,$,ee,te,ie,se,oe,ne,ae,le,re,de,he;if((null===(t=e.commonGeneralSettings)||void 0===t?void 0:t.showGridAxis)!==(null===(i=this.props.commonGeneralSettings)||void 0===i?void 0:i.showGridAxis)&&(null===(s=this.chart)||void 0===s?void 0:s.xAxes.values.length)>0&&this.chart.yAxes.values.length>0||e.elevationGraphColor!==this.props.elevationGraphColor){if(this.chart){this.xAxis.get("renderer").grid.template.set("visible",null===(o=this.props.commonGeneralSettings)||void 0===o?void 0:o.showGridAxis);this.yAxis.get("renderer").grid.template.set("visible",null===(n=this.props.commonGeneralSettings)||void 0===n?void 0:n.showGridAxis),this.chartSeries.strokes.template.set("stroke",(0,Q.colorAm5)(this.props.elevationGraphColor)),this.chartSeries.fills.template.set("fill",(0,Q.colorAm5)(this.props.elevationGraphColor))}return}if((null===(a=e.commonGeneralSettings)||void 0===a?void 0:a.showLegend)!==(null===(l=this.props.commonGeneralSettings)||void 0===l?void 0:l.showLegend)||(null===(r=e.commonGeneralSettings)||void 0===r?void 0:r.showAxisTitles)!==(null===(d=this.props.commonGeneralSettings)||void 0===d?void 0:d.showAxisTitles))return this.xAxisLabel.set("visible",null===(h=this.props.commonGeneralSettings)||void 0===h?void 0:h.showAxisTitles),this.yAxisLabel.set("visible",null===(c=this.props.commonGeneralSettings)||void 0===c?void 0:c.showAxisTitles),this.isRTL?this.chart.setAll({paddingTop:0,paddingRight:5,paddingBottom:(null===(u=this.props.commonGeneralSettings)||void 0===u?void 0:u.showAxisTitles)&&(null===(p=this.props.commonGeneralSettings)||void 0===p?void 0:p.showLegend)?2:(null===(g=this.props.commonGeneralSettings)||void 0===g?void 0:g.showAxisTitles)&&!(null===(v=this.props.commonGeneralSettings)||void 0===v?void 0:v.showLegend)?0:!(null===(f=this.props.commonGeneralSettings)||void 0===f?void 0:f.showAxisTitles)&&(null===(m=this.props.commonGeneralSettings)||void 0===m?void 0:m.showLegend)?2:(null===(y=this.props.commonGeneralSettings)||void 0===y?void 0:y.showAxisTitles)||(null===(S=this.props.commonGeneralSettings)||void 0===S?void 0:S.showLegend)?0:5,paddingLeft:5}):this.chart.setAll({paddingTop:0,paddingRight:0,paddingBottom:(null===(x=this.props.commonGeneralSettings)||void 0===x?void 0:x.showAxisTitles)&&(null===(b=this.props.commonGeneralSettings)||void 0===b?void 0:b.showLegend)?2:(null===(w=this.props.commonGeneralSettings)||void 0===w?void 0:w.showAxisTitles)&&!(null===(L=this.props.commonGeneralSettings)||void 0===L?void 0:L.showLegend)?0:!(null===(I=this.props.commonGeneralSettings)||void 0===I?void 0:I.showAxisTitles)&&(null===(C=this.props.commonGeneralSettings)||void 0===C?void 0:C.showLegend)?2:(null===(A=this.props.commonGeneralSettings)||void 0===A?void 0:A.showAxisTitles)||(null===(E=this.props.commonGeneralSettings)||void 0===E?void 0:E.showLegend)?0:5,paddingLeft:5}),void this.setState({showLegend:null===(D=this.props.commonGeneralSettings)||void 0===D?void 0:D.showLegend},(()=>{this.state.showLegend?this.chartLegend?this.chartLegend.set("visible",this.state.showLegend):this.displayChartLegend(this.accessChartParams):this.chartLegend&&this.chartLegend.set("visible",this.state.showLegend)}));if(e.volumetricObjLineColor!==this.props.volumetricObjLineColor)return void(this.chart&&(this.volumetricObjLineSeries.strokes.template.set("stroke",(0,Q.colorAm5)(this.props.volumetricObjLineColor)),this.volumetricObjLineSeries.fills.template.set("fill",(0,Q.colorAm5)(this.props.volumetricObjLineColor))));if(e.volumetricObjLabel!==this.props.volumetricObjLabel)return void(this.chart&&this.volumetricObjLineSeries.setAll({name:this.props.volumetricObjLabel?this.props.volumetricObjLabel:this.nls("volumetricObj")}));const ce=this.didProfileLayersSettingsChanged(null===(M=e.currentConfig)||void 0===M?void 0:M.profileSettings.layers,null===(F=this.props.currentConfig)||void 0===F?void 0:F.profileSettings.layers),ue=this.didIntersectingLayersSettingsChanged(null===(O=null===(P=e.currentConfig)||void 0===P?void 0:P.assetSettings)||void 0===O?void 0:O.layers,null===(T=null===(V=this.props.currentConfig)||void 0===V?void 0:V.assetSettings)||void 0===T?void 0:T.layers);(ce||ue||e.assetIntersectionResult!==this.props.assetIntersectionResult||e.selectedLinearUnit!==this.props.selectedLinearUnit||e.selectedElevationUnit!==this.props.selectedElevationUnit||e.chartDataUpdateTime!==this.props.chartDataUpdateTime||e.theme!==this.props.theme||e.isFlip!==this.props.isFlip||e.isUniformChartScalingEnable!==this.props.isUniformChartScalingEnable||(null===(j=e.currentConfig)||void 0===j?void 0:j.advanceOptions)!==(null===(R=this.props.currentConfig)||void 0===R?void 0:R.advanceOptions)||(null===(U=null===(k=e.currentConfig)||void 0===k?void 0:k.profileSettings)||void 0===U?void 0:U.isProfileSettingsEnabled)!==(null===(B=null===(N=this.props.currentConfig)||void 0===N?void 0:N.profileSettings)||void 0===B?void 0:B.isProfileSettingsEnabled)||(null===(G=null===(z=e.currentConfig)||void 0===z?void 0:z.profileSettings)||void 0===G?void 0:G.isCustomizeOptionEnabled)!==(null===(W=null===(_=this.props.currentConfig)||void 0===_?void 0:_.profileSettings)||void 0===W?void 0:W.isCustomizeOptionEnabled)||(null===(Y=null===(H=e.currentConfig)||void 0===H?void 0:H.assetSettings)||void 0===Y?void 0:Y.isAssetSettingsEnabled)!==(null===(q=null===(X=this.props.currentConfig)||void 0===X?void 0:X.assetSettings)||void 0===q?void 0:q.isAssetSettingsEnabled)||e.showVolumetricObj!==this.props.showVolumetricObj&&!this.props.showVolumetricObj)&&((e.showVolumetricObj!==this.props.showVolumetricObj&&!this.props.showVolumetricObj||e.chartDataUpdateTime!==this.props.chartDataUpdateTime||e.selectedLinearUnit!==this.props.selectedLinearUnit||e.selectedElevationUnit!==this.props.selectedElevationUnit||e.isFlip!==this.props.isFlip)&&this.chart&&(this.chart.root.dispose(),this.chart=null),(ce||ue||e.assetIntersectionResult!==this.props.assetIntersectionResult||e.theme.sys.color.mode!==this.props.theme.sys.color.mode||e.theme.sys.color.primary.main!==this.props.theme.sys.color.primary.main||e.theme.ref.typeface.htmlFontSize!==this.props.theme.ref.typeface.htmlFontSize||(null===(J=e.currentConfig)||void 0===J?void 0:J.advanceOptions)!==(null===(K=this.props.currentConfig)||void 0===K?void 0:K.advanceOptions)||(null===($=null===(Z=e.currentConfig)||void 0===Z?void 0:Z.profileSettings)||void 0===$?void 0:$.isProfileSettingsEnabled)!==(null===(te=null===(ee=this.props.currentConfig)||void 0===ee?void 0:ee.profileSettings)||void 0===te?void 0:te.isProfileSettingsEnabled)||(null===(se=null===(ie=e.currentConfig)||void 0===ie?void 0:ie.profileSettings)||void 0===se?void 0:se.isCustomizeOptionEnabled)!==(null===(ne=null===(oe=this.props.currentConfig)||void 0===oe?void 0:oe.profileSettings)||void 0===ne?void 0:ne.isCustomizeOptionEnabled)||(null===(le=null===(ae=e.currentConfig)||void 0===ae?void 0:ae.assetSettings)||void 0===le?void 0:le.isAssetSettingsEnabled)!==(null===(de=null===(re=this.props.currentConfig)||void 0===re?void 0:re.assetSettings)||void 0===de?void 0:de.isAssetSettingsEnabled))&&this.chart&&(this.chart.root.dispose(),this.chart=null),ue&&(this.props.assetIntersectionResult.forEach((e=>{var t,i;null===(i=null===(t=this.props.currentConfig)||void 0===t?void 0:t.assetSettings)||void 0===i||i.layers.forEach((t=>{var i;t.layerId===(null===(i=null==e?void 0:e.settings)||void 0===i?void 0:i.layerId)&&(e.settings=t)}))})),this.chart&&(this.chart.root.dispose(),this.chart=null)),this.updatedProfileLayers=null===(he=this.props.currentConfig)||void 0===he?void 0:he.profileSettings.layers,this.createOrUpdateChartDefinition()),e.isExportEnable!==this.props.isExportEnable&&this.props.isExportEnable&&(this.props.setExportButton(!1),this.performExportOperation())},this.resetExportingInfo=()=>{this.groundExportingInfo={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",y:this.nls("groundElevation")+" ("+this.props.selectedElevationUnit+")"},this.intersectingLayersExportingInfo={}},this.exportDataForIntersectingLayers=()=>{const e={},t=Q.Exporting.new(this.accessChartParams.chart.root,{dataSource:this.accessChartParams.chartData}),i=new Date;t.setAll({filePrefix:this.nls("_widgetLabel")+"-"+i.toDateString()+" "+i.toLocaleTimeString(),dataFields:this.groundExportingInfo}),Object.entries(this.intersectionSeriesKey).forEach((([t,i])=>{const s=this.accessChartParams.chartData[t];Object.entries(i).forEach((([t,i])=>{var o;(null===(o=this.intersectingLayersExportingInfo)||void 0===o?void 0:o[t])&&i.forEach((i=>{const o={xCoordinate:s.xCoordinate,yCoordinate:s.yCoordinate,x:s.x,intersectingLayerY:i.value,intersectingLayerY2:void 0,intersectingLayerDisplayField:i.displayField,layerName:this.intersectingLayersExportingInfo[t].layerName};i.hasOwnProperty("y2")&&(o.intersectingLayerY2=i.y2),e[t]||(e[t]=[]),e[t].push(o)}))}))})),Object.keys(e).forEach((i=>{const s=e[i];this.props.isFlip&&s.reverse(),t.events.on("dataprocessed",(e=>{e.data=s}));const o=U.default.clone(this.intersectingLayersExportingInfo[i]);o.layerName=this.nls("layerName"),t.set("dataFields",o),t.download("csv"),t.events.removeType("dataprocessed")}))},this.performExportOperation=()=>{try{const e=Q.Exporting.new(this.accessChartParams.chart.root,{dataSource:this.accessChartParams.chartData}),t=new Date;e.setAll({filePrefix:this.nls("_widgetLabel")+"-"+t.toDateString()+" "+t.toLocaleTimeString(),dataFields:this.groundExportingInfo}),e.events.on("dataprocessed",(e=>{let t=[];const i=e.data;if(i){if(this.props.isCustomIntervalEnabled&&!isNaN(this.props.customDistanceInterval)){let e=0;i.forEach((i=>{i.x>=e&&(t.push(i),e+=this.props.customDistanceInterval)}))}else t=[...i];t=t.filter(((e,i)=>0===i||e.x!==t[i-1].x)),this.props.isFlip&&t.reverse(),e.data=t}return t})),e.download("csv"),e.events.removeType("dataprocessed"),this.exportDataForIntersectingLayers()}catch(e){console.log(e)}},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==t?void 0:t.length)!==(null==e?void 0:e.length)||(null==t||t.some(((t,s)=>{if(t.style.lineType!==e[s].style.lineType||t.style.lineColor!==e[s].style.lineColor||t.style.lineThickness!==e[s].style.lineThickness||t.elevationSettings.type!==e[s].elevationSettings.type||t.elevationSettings.unit!==e[s].elevationSettings.unit||t.elevationSettings.field1!==e[s].elevationSettings.field1||t.elevationSettings.field2!==e[s].elevationSettings.field2||t.distanceSettings.type!==e[s].distanceSettings.type||t.distanceSettings.field!==e[s].distanceSettings.field||t.distanceSettings.unit!==e[s].distanceSettings.unit)return i=!0,!0})),i)},this.didIntersectingLayersSettingsChanged=(e,t)=>{let i=!1;return(null==t?void 0:t.length)===(null==e?void 0:e.length)&&(null==t||t.some(((t,s)=>{var o,n,a,l,r,d,h,c,u,p,g,v,f,m,y,S,x,b,w,L,I,C,A,E,D;if((null===(o=null==t?void 0:t.style)||void 0===o?void 0:o.type)!==(null===(a=null===(n=e[s])||void 0===n?void 0:n.style)||void 0===a?void 0:a.type)||(null==t?void 0:t.displayField)!==(null===(l=e[s])||void 0===l?void 0:l.displayField)||(null===(r=null==t?void 0:t.style)||void 0===r?void 0:r.intersectingAssetShape)!==(null===(h=null===(d=e[s])||void 0===d?void 0:d.style)||void 0===h?void 0:h.intersectingAssetShape)||(null===(c=null==t?void 0:t.style)||void 0===c?void 0:c.intersectingAssetSize)!==(null===(p=null===(u=e[s])||void 0===u?void 0:u.style)||void 0===p?void 0:p.intersectingAssetSize)||(null===(g=null==t?void 0:t.style)||void 0===g?void 0:g.intersectingAssetColor)!==(null===(f=null===(v=e[s])||void 0===v?void 0:v.style)||void 0===f?void 0:f.intersectingAssetColor)||(null===(m=null==t?void 0:t.elevationSettings)||void 0===m?void 0:m.type)!==(null===(S=null===(y=e[s])||void 0===y?void 0:y.elevationSettings)||void 0===S?void 0:S.type)||(null===(x=null==t?void 0:t.elevationSettings)||void 0===x?void 0:x.unit)!==(null===(w=null===(b=e[s])||void 0===b?void 0:b.elevationSettings)||void 0===w?void 0:w.unit)||(null===(L=null==t?void 0:t.elevationSettings)||void 0===L?void 0:L.field1)!==(null===(C=null===(I=e[s])||void 0===I?void 0:I.elevationSettings)||void 0===C?void 0:C.field1)||(null===(A=null==t?void 0:t.elevationSettings)||void 0===A?void 0:A.field2)!==(null===(D=null===(E=e[s])||void 0===E?void 0:E.elevationSettings)||void 0===D?void 0:D.field2))return i=!0,!0}))),i},this.createOrUpdateChartDefinition=()=>{var e,t;if((null===(t=null===(e=this.props.profileResult)||void 0===e?void 0:e.lines)||void 0===t?void 0:t.length)>0&&this.props.selectedLinearUnit&&this.props.selectedElevationUnit&&this.props.theme){const e=this.props.profileResult.lines[0].samples;if(this.viewOutput=null,this.props.profileResult.lines.length>1&&this.props.showVolumetricObj&&"3d"===this.props.mapView.view.type&&(this.viewOutput=this.props.profileResult.lines[1].samples),e.length>0){const t=[];this.allDistances=[],e.length>0?(e.forEach(((e,i)=>{const s={xCoordinate:e.x,yCoordinate:e.y,x:T(e.distance,this.props.profileResult.effectiveUnits.distance,this.props.selectedLinearUnit),y:T(e.elevation,this.props.profileResult.effectiveUnits.elevation,this.props.selectedElevationUnit),esriCTViewY:null,pathIdx:0,pointIdx:i};this.viewOutput&&(s.esriCTViewY=T(this.viewOutput[i].elevation,this.props.profileResult.effectiveUnits.elevation,this.props.selectedElevationUnit)),t.push(s),this.allDistances.push(e.distance)})),this.minMaxOfEachProfile={},this.seriesKey=[],this.seriesValue=[],this.createDataForProfileLines(t).then((()=>{this.createDataForIntersectingAssets(t).then((()=>{let e=[];if(this.props.isFlip){const i=t[t.length-1].x;e=[...t],e.forEach((e=>{e.x=i-e.x}))}const i=this.getSelectedUnits(),s=this.props.intl.formatMessage({id:"graphDistanceLabel",defaultMessage:l.graphDistanceLabel},{unit:i[0]}),o=this.props.intl.formatMessage({id:"graphElevationLabel",defaultMessage:l.graphElevationLabel},{unit:i[1]}),n={data:this.props.isFlip?e:t,series:[{x:{field:"x",label:s},y:{field:"y",label:o},color:this.props.elevationGraphColor}]};this.setState({chartDefinition:n},(()=>{var e,t;if(this.chart)return this.xAxisLabel.set("text",s),this.yAxisLabel.set("text",o),this.accessChartParams.chart.zoomOutButton.get("background").set("fill",(0,Q.colorAm5)(this.props.theme.sys.color.primary.main)),this.xAxis.set("numberFormatter",this.makeFormatter(this.accessChartParams,i[2])),this.yAxis.set("numberFormatter",this.makeFormatter(this.accessChartParams,i[3])),void this.adjustAxisRanges(this.accessChartParams);this.createChart({definition:n,container:this._chartContainer.current,isDarkTheme:"dark"===this.props.theme.sys.color.mode,showGrid:null===(e=this.props.commonGeneralSettings)||void 0===e?void 0:e.showGridAxis,showTitleAxis:null===(t=this.props.commonGeneralSettings)||void 0===t?void 0:t.showAxisTitles,showLegend:this.state.showLegend,exbTheme:this.props.theme,zoomOutText:this.nls("zoomOut"),unitsAbbreviations:this.getSelectedUnits()})}))}))}))):this.setState({chartDefinition:null},(()=>{this.chart&&(this.chart.root.dispose(),this.chart=null)}))}}else this.setState({chartDefinition:null}),this.chart&&(this.chart.root.dispose(),this.chart=null)},this.checkForProfileSettings=()=>{var e,t,i,s;const o=[];return(null===(t=null===(e=this.props.drawingLayer)||void 0===e?void 0:e.graphics)||void 0===t?void 0:t.length)>0&&(null===(s=null===(i=this.props.drawingLayer.graphics.getItemAt(0))||void 0===i?void 0:i.attributes)||void 0===s?void 0:s.esriCTFeatureLayerId)&&this.props.drawingLayer.graphics.forEach((e=>{const t=e.getAttribute("esriCTFeatureLayerId");o.includes(t)||o.push(t)})),o},this.getSelectedUnits=()=>{const e=this.props.unitOptions.find((e=>e.value===this.props.selectedLinearUnit)),t=this.props.unitOptions.find((e=>e.value===this.props.selectedElevationUnit)),i=this.nls(e.value),s=this.nls(e.abbreviation);return[i,this.nls(t.value),s,this.nls(t.abbreviation)]},this._updateProfileResults=e=>{const t={distances:{},elevations:{}};var i,s,o;return t.distances=(i=e.distances,s=e.effectiveUnits.distance,o=this.props.selectedLinearUnit,i.map((e=>parseFloat(V(e,s,o).toString()))),i),t.elevations=function(e,t,i,s,o){return e.forEach((e=>{e.x=parseFloat(V(e.x,t,s).toString()),e.y=parseFloat(V(e.y,i,o).toString())})),e}(e.elevations,e.effectiveUnits.distance,e.effectiveUnits.elevation,this.props.selectedLinearUnit,this.props.selectedElevationUnit),t},this.clearChart=()=>{this.setState({chartDefinition:null})},this.getNearestElevationData=e=>{if(!this.props.profileResult)return null;const t=this.allDistances;let i=T(e,this.props.selectedLinearUnit,this.props.profileResult.effectiveUnits.distance);if(this.props.isFlip){const e=t[t.length-1];i=e-i}const s=t.reduce(((e,t)=>Math.abs(t-i)<Math.abs(e-i)?t:e));if(s>=0){const e=t?t.indexOf(s):-1;if(e>=0){return this.state.chartDefinition.data[e]}}return null},this.hideChartPosition=()=>{this.props.hideChartPosition()},this.getChartPadding=e=>{let t=0,i=0,s=0;return this.isRTL,t=5,i=e.showTitleAxis&&e.showLegend?2:e.showTitleAxis&&!e.showLegend?0:!e.showTitleAxis&&e.showLegend?2:e.showTitleAxis||e.showLegend?0:5,s=5,{paddingTop:0,paddingRight:t,paddingBottom:i,paddingLeft:s}},this.configureCursorAM5=({chart:e,xAxis:t,yAxis:i,params:s})=>{var o;const n=this.getFontSize(),a=Q.TooltipAm5.new(e.root,{pointerOrientation:"horizontal"});e.plotContainer.set("tooltip",a),null===(o=a.get("background"))||void 0===o||o.setAll({fill:(0,Q.colorAm5)(s.exbTheme.ref.palette.white),strokeWidth:.5,stroke:(0,Q.colorAm5)(s.exbTheme.ref.palette.neutral[700]),fillOpacity:1}),a.label.setAll({fontSize:n+3});const l=Q.XYCursorAm5.new(e.root,{behavior:"zoomXY",xAxis:t,yAxis:i});return e.set("cursor",l),l},this.setZoomButton=(e,t,i)=>{var s;const o=Q.TooltipAm5.new(e.root,{labelText:t});null===(s=o.get("background"))||void 0===s||s.setAll({fill:(0,Q.colorAm5)(i.sys.color.primary.main),fillOpacity:.6}),e.zoomOutButton.setAll({cursorOverStyle:"pointer",tooltipText:t,tooltip:o}),this.isRTL&&e.plotContainer.onPrivate("width",(t=>{e.zoomOutButton.set("dx",50-t)})),e.zoomOutButton.get("background").setAll({fill:(0,Q.colorAm5)(i.sys.color.primary.main),stroke:(0,Q.colorAm5)(i.sys.color.primary.main)}),e.zoomOutButton.get("background").states.create("hover",{}).setAll({fill:(0,Q.colorAm5)(i.sys.color.primary.main),stroke:(0,Q.colorAm5)(i.sys.color.primary.main)}),e.zoomOutButton.get("background").states.create("down",{}).setAll({fill:(0,Q.colorAm5)(i.sys.color.primary.dark),stroke:(0,Q.colorAm5)(i.sys.color.primary.dark)})},this.initChart=e=>ee(this,void 0,void 0,(function*(){const t=yield(0,Q.createRoot)(e.container,window.locale),i=e.isDarkTheme,s=i?$:Z;t.setThemes(i?[Q.ResponsiveThemeAm5.new(t),Q.DarkThemeAm5.new(t),Q.AnimatedThemeAm5.new(t)]:[Q.ResponsiveThemeAm5.new(t),Q.AnimatedThemeAm5.new(t)]);const o=t.container.children.push(Q.XYChartAm5.new(t,Object.assign(Object.assign({},this.getChartPadding(e)),{maxTooltipDistance:0,pinchZoomX:!0,pinchZoomY:!0,wheelY:"zoomXY",layout:t.verticalLayout})));this.setZoomButton(o,e.zoomOutText,e.exbTheme);const n=o.xAxes.push(Q.ValueAxisAm5.new(t,{renderer:Q.AxisRendererXAm5.new(t,{})})),a=o.yAxes.push(Q.ValueAxisAm5.new(t,{renderer:Q.AxisRendererYAm5.new(t,{})}));a.data.setAll(e.definition.data),n.data.setAll(e.definition.data);const l={params:e,chart:o,xAxis:n,yAxis:a,seriesInfos:new Map,messages:null,theme:s,pointerIsOver:!1,chartData:e.definition.data};this.accessChartParams=l,this.configureXAxis(l),this.configureYAxis(l);const r=this.configureCursorAM5(l),d=this.addGroundSeries(l);if(d.data.setAll(e.definition.data),o.series.push(d),this.profilingWithCustomizeOptions(l),this.viewOutput&&this.props.showVolumetricObj&&"3d"===this.props.mapView.view.type){const t=this.addVolumetricObjLineSeries(l);t.data.setAll(e.definition.data),o.series.push(t)}return this.displayChartLegend(l),setTimeout((()=>{this.adjustAxisRanges(l)}),500),{chart:o,cursor:r,xAxis:n,yAxis:a,groundSeries:d}})),this.showChartTooltip=e=>{var t,i,s,o,n;const{cursor:a,xAxis:l,yAxis:r,chart:d,groundSeries:h}=e;this.props.intersectionHighlightLayer.removeAll();const c=a.getPrivate("positionX"),u=l.toAxisPosition(c),p=l.positionToValue(u),g=this.getNearestElevationData(p),v=r.get("numberFormatter");if(g){let e=c;if(null!=this.props.profileResult.statistics){const s=this.props.profileResult;let{maxDistance:o}=s.statistics;if(null!=o){o=T(o,s.effectiveUnits.distance,this.props.selectedLinearUnit);const n=this.isRTL?1-c:c,a=l.positionToValue(null!==(t=l.get("start"))&&void 0!==t?t:0),r=l.positionToValue(null!==(i=l.get("end"))&&void 0!==i?i:1);e=this.positionRelativeToData(n,a,r,0,o)}}this.props.isFlip?this.props.highlightChartPositionOnMap(1-e):this.props.highlightChartPositionOnMap(e);let u=null;const p=r.height(),f=p+d.get("paddingTop"),m=v.format(g.y,5);let y='<div style="overflow: hidden;">';h.isVisible()&&(u=g.y,y+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+h.get("stroke").toString()+';"></div> '+h.get("name")+":  <b>"+m+"</b> <br/>");const S=v.format(g.esriCTViewY,5);this.props.profileResult.lines.length>1&&this.props.showVolumetricObj&&"3d"===this.props.mapView.view.type&&this.volumetricObjLineSeries.isVisible()&&(u=g.esriCTViewY,y+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+this.volumetricObjLineSeries.get("stroke").toString()+';"></div> '+this.volumetricObjLineSeries.get("name")+":  <b>"+S+"</b> <br/>");const x=this.seriesKey&&this.seriesKey[g.pointIdx]?this.seriesKey[g.pointIdx]:null;if(null===(o=null===(s=this.chart)||void 0===s?void 0:s.series)||void 0===o||o.values.forEach((e=>{if(e.get("valueYField")===x&&e.isVisible()){const t=v.format(g[x],5);return(null===u||u<g[x])&&(u=g[x]),y+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+e.get("stroke").toString()+';"></div> '+e.get("name")+":  <b>"+t+"</b> <br/>",!0}})),null!==this.intersectionSeriesKeyIndex[g.pointIdx]){const e=null===(n=this.intersectionSeriesKey)||void 0===n?void 0:n[this.intersectionSeriesKeyIndex[g.pointIdx]],t={},i=[];if(e){Object.keys(e).forEach((s=>{e[s].forEach((e=>{var s,o;null===(o=null===(s=this.chart)||void 0===s?void 0:s.series)||void 0===o||o.values.some((s=>{if(s.get("valueYField")===e.seriesId&&s.isVisible()&&void 0!==g[e.seriesId]){let o=v.format(g[e.seriesId],5);const n=e.layerId+e.featureIndex+o;return i.includes(n)||(i.push(n),t[e.layerId]||(t[e.layerId]=[]),t[e.layerId].includes(e.featureIndex)||t[e.layerId].push(e.featureIndex),(null===u||u<g[e.seriesId])&&(u=g[e.seriesId]),e.hasOwnProperty("y2")&&(o=v.format(e.value,5),o=o+" | "+v.format(e.y2,5)),e.displayField?y+='<div style="display:inline-block; '+e.assetStyle+'"></div> '+s.get("name")+" ("+e.displayField+"):  <b>"+o+"</b> <br/>":y+='<div style="display:inline-block; '+e.assetStyle+'"></div> '+s.get("name")+":  <b>"+o+"</b> <br/>"),!0}}))}))}))}this.highlightIntersectionsOnMap(t)}if(""!==y&&r.get("min")<=u){y+="</div>";const e=d.plotContainer.get("tooltip");e.set("html",y);const t={x:a.getPrivate("point").x,y:f-r.valueToPosition(u)*p-1};e.set("pointTo",t),e.show()}}},this.createChart=e=>ee(this,void 0,void 0,(function*(){this.seriesToBeHiddenInLegend=[];const t=yield this.initChart(e),{chart:i,cursor:s}=t;this.chart=i,s.events.on("cursormoved",(()=>{this.showChartTooltip(t)})),s.events.on("cursorhidden",(()=>{this.props.intersectionHighlightLayer.removeAll(),i.plotContainer.get("tooltip").hide(),this.hideChartPosition()}))})),this.canShowProfileSettingsForBackward=e=>{var t,i;let s=!1;return e&&(e.hasOwnProperty("advanceOptions")||(null==e?void 0:e.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))||(null==e?void 0:e.profileSettings.hasOwnProperty("isCustomizeOptionEnabled")))&&((null==e?void 0:e.advanceOptions)||(null===(t=null==e?void 0:e.profileSettings)||void 0===t?void 0:t.isProfileSettingsEnabled)&&(null===(i=null==e?void 0:e.profileSettings)||void 0===i?void 0:i.isCustomizeOptionEnabled))&&(s=!0),s},this.profilingWithCustomizeOptions=e=>{var t,i,s,o,n;if(this.resetExportingInfo(),this.canShowProfileSettingsForBackward(this.props.currentConfig)){const t=this.checkForProfileSettings();t.length>0&&t.forEach((t=>{this.addLineSeries(t,e)}))}this.props.currentConfig&&(this.props.currentConfig.hasOwnProperty("advanceOptions")&&(null===(t=this.props.currentConfig)||void 0===t?void 0:t.advanceOptions)||(null===(s=null===(i=this.props.currentConfig)||void 0===i?void 0:i.assetSettings)||void 0===s?void 0:s.isAssetSettingsEnabled))&&(null===(o=this.props.assetIntersectionResult)||void 0===o?void 0:o.length)>0&&(null===(n=this.props.assetIntersectionResult)||void 0===n||n.forEach((t=>{var i;if((null===(i=null==t?void 0:t.intersectionResult)||void 0===i?void 0:i.length)>0){"polyline"===t.intersectionResult[0].intersectingFeature.geometry.type?this.addIntersectingLineSeries(t,e):this.addPointSeries(t,e)}})))},this.adjustAxisRanges=e=>{var t;const{xAxis:i,yAxis:s}=e;if(null===(t=this.props.profileResult)||void 0===t?void 0:t.statistics){const{minX:e,maxX:t,minY:o,maxY:n}=this.getAdjustedBounds({data:this.props.profileResult,pixelWidth:i.width(),pixelHeight:s.height()});i.set("min",e),i.set("max",t),s.set("min",o),s.set("max",n)}},this.getAdjustedBounds=({data:e,pixelWidth:t,pixelHeight:i})=>{const s=e.statistics;let o=s.maxDistance;o=T(o,e.effectiveUnits.distance,this.props.selectedLinearUnit);let n=s.minElevation;n=T(n,e.effectiveUnits.elevation,this.props.selectedElevationUnit);let a=s.maxElevation;a=T(a,e.effectiveUnits.elevation,this.props.selectedElevationUnit);for(const e in this.minMaxOfEachProfile)this.minMaxOfEachProfile[e].max>a&&(a=this.minMaxOfEachProfile[e].max),this.minMaxOfEachProfile[e].min<n&&(n=this.minMaxOfEachProfile[e].min);const l=Math.max(o-0,.001);let r=Math.max(a-n,.001);if(e.dynamicElevationRange){const e=T(l,this.props.selectedLinearUnit,this.props.selectedElevationUnit);r=Math.max(r,e/300)}n-=.02*r,a=n+r+.02*r;const d=function(e,t,i=10){const s=R(t-e,!1);if(0===s)return[e,t];const o=R(s/(i-1),!0);return[Math.floor(e/o)*o,Math.ceil(t/o)*o]}(n,a,10);return r=d[1]-d[0],this.props.isUniformChartScalingEnable?this.getUniformBounds({bounds:{minX:0,maxX:o,minY:n,maxY:a},pixelWidth:t,pixelHeight:i,centered:!0}):{minX:0,maxX:0+l,minY:n,maxY:n+r}},this.getUniformBounds=({bounds:e,pixelWidth:t,pixelHeight:i,centered:s})=>{let{minX:o,maxX:n,minY:a,maxY:l}=e;const r=n-o,d=T(l-a,this.props.selectedElevationUnit,this.props.selectedLinearUnit)/i/(r/t);return d>=1?[o,n]=this.scaleRange([o,n],d,s):[a,l]=this.scaleRange([a,l],1/d,s),{minX:o,maxX:n,minY:a,maxY:l}},this.scaleRange=([e,t],i,s)=>{const o=(t-e)*i;if(s){const i=(e+t)/2-o/2;return[i,i+o]}return[e,e+o]},this.getFontSize=()=>{const e=this.props.theme;let t=9;return"125%"===e.ref.typeface.htmlFontSize?t=11:"87.5%"===e.ref.typeface.htmlFontSize?t=8:"75%"===e.ref.typeface.htmlFontSize&&(t=7),t},this.configureXAxis=e=>{var t;const{chart:i,xAxis:s,theme:o,params:n}=e;this.xAxis=s;const a=this.getFontSize(),l=n.unitsAbbreviations;this.xAxisLabel=Q.LabelAm5.new(e.chart.root,{text:n.definition.series[0].x.label,textAlign:"center",x:Q.p50,fontWeight:o.axisLabelsFontWeight,fontSize:a+3,visible:n.showTitleAxis,paddingBottom:0}),s.children.push(this.xAxisLabel),s.setAll({extraMax:.001,extraMin:.001,maxDeviation:0,numberFormatter:this.makeFormatter(e,l[2]),strictMinMax:!0,strictMinMaxSelection:!0,extraTooltipPrecision:2,cursorTooltipEnabled:!0});const r=s.get("renderer");r.setAll({inside:!1,minGridDistance:o.xAxisMinGridDistance,inversed:this.isRTL}),r.labels.template.setAll({centerX:Q.p0,centerY:Q.p0,fontFamily:o.fontFamily,fontSize:a,fontWeight:o.axisLabelsFontWeight,maxPosition:o.xAxisMaxLabelPosition,minPosition:o.xAxisMinLabelPosition,paddingLeft:0,paddingRight:0,paddingTop:o.xAxisLabelsSpacing});const d=s.set("tooltip",Q.TooltipAm5.new(i.root,{paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0}));null===(t=d.get("background"))||void 0===t||t.setAll({fill:(0,Q.colorAm5)(n.exbTheme.ref.palette.black),stroke:void 0}),d.label.setAll({fill:(0,Q.colorAm5)(n.exbTheme.ref.palette.white),fontFamily:o.fontFamily,fontSize:o.axisTooltipFontSize,paddingBottom:o.axisTooltipPaddingBottom,paddingLeft:o.axisTooltipPaddingHorizontal,paddingRight:o.axisTooltipPaddingHorizontal,paddingTop:o.axisTooltipPaddingTop}),r.grid.template.setAll({visible:e.params.showGrid,strokeOpacity:1,stroke:(0,Q.colorAm5)(o.axisGridStroke)})},this.configureYAxis=e=>{var t;const{yAxis:i,theme:s,chart:o,params:n}=e;this.yAxis=i;const a=n.unitsAbbreviations,l=this.getFontSize();this.yAxisLabel=Q.LabelAm5.new(e.chart.root,{text:n.definition.series[0].y.label,textAlign:"center",y:Q.p50,rotation:-90,fontWeight:"500",fontSize:l+3,visible:n.showTitleAxis}),this.isRTL?i.children.push(this.yAxisLabel):i.children.unshift(this.yAxisLabel),i.setAll({baseValue:-5e5,extraMax:0,extraMin:.01,maxDeviation:0,numberFormatter:this.makeFormatter(e,a[3]),strictMinMax:!0,strictMinMaxSelection:!0,cursorTooltipEnabled:!0,extraTooltipPrecision:2});const r=i.get("renderer");r.setAll({minGridDistance:s.yAxisMinGridDistance,opposite:this.isRTL,inside:!0}),r.labels.template.setAll({fontFamily:s.fontFamily,fontSize:l,fontWeight:s.axisLabelsFontWeight,maxPosition:s.yAxisMaxLabelPosition,minPosition:s.yAxisMinLabelPosition,paddingTop:-8,direction:this.isRTL?"rtl":"ltr"});const d=i.set("tooltip",Q.TooltipAm5.new(o.root,{paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0}));null===(t=d.get("background"))||void 0===t||t.setAll({fill:(0,Q.colorAm5)(n.exbTheme.ref.palette.black),stroke:void 0}),d.label.setAll({fill:(0,Q.colorAm5)(n.exbTheme.ref.palette.white),fontFamily:s.fontFamily,fontSize:s.axisTooltipFontSize,paddingBottom:s.axisTooltipPaddingBottom,paddingLeft:s.axisTooltipPaddingHorizontal,paddingRight:s.axisTooltipPaddingHorizontal,paddingTop:s.axisTooltipPaddingTop}),r.grid.template.setAll({visible:e.params.showGrid,strokeOpacity:1,stroke:(0,Q.colorAm5)(s.axisGridStroke)})},this.highlightIntersectionsOnMap=e=>{var t;const i=Object.keys(e);if((null===(t=this.props.assetIntersectionResult)||void 0===t?void 0:t.length)>0&&i.length>0){const t=[];i.forEach((i=>{const s=e[i];this.props.assetIntersectionResult.some((e=>{var o;if((null===(o=null==e?void 0:e.intersectionResult)||void 0===o?void 0:o.length)>0&&i===e.settings.layerId)return s.forEach((i=>{var s;const o=(null===(s=e.intersectionResult[i])||void 0===s?void 0:s.record).getFeature();t.push(((e,t)=>{switch(t||(t="#00FFFF"),e.geometry.type){case"point":return X(e,t);case"polyline":return J(e,t);case"polygon":return K(e,t)}})(o,"#FFFF00"))})),!0}))})),t.length>0&&(this.props.intersectionHighlightLayer.removeAll(),this.props.intersectionHighlightLayer.addMany(t))}},this.positionRelativeToData=(e,t,i,s,o)=>(t+e*(i-t)-s)/(o-s),this.addGroundSeries=e=>{const t=Q.LineSeriesAm5.new(e.chart.root,{name:this.nls("groundElevation"),connect:!1,excludeFromTotal:!0,fill:(0,Q.colorAm5)(e.params.definition.series[0].color),stroke:(0,Q.colorAm5)(e.params.definition.series[0].color),valueXField:"x",valueYField:"y",xAxis:e.xAxis,yAxis:e.yAxis,legendLabelText:"{name}"});return t.strokes.template.set("strokeWidth",1.5),t.fills.template.setAll({fillOpacity:.1,visible:!0}),this.chartSeries=t,this.props.chartInfo(this.accessChartParams.chart),t},this.addVolumetricObjLineSeries=e=>{const t=this.props.volumetricObjLabel?this.props.volumetricObjLabel:this.nls("volumetricObj"),i=this.props.volumetricObjLineColor,s=Q.LineSeriesAm5.new(e.chart.root,{name:t,connect:!1,excludeFromTotal:!0,fill:(0,Q.colorAm5)(i),stroke:(0,Q.colorAm5)(i),valueXField:"x",valueYField:"esriCTViewY",xAxis:e.xAxis,yAxis:e.yAxis,legendLabelText:"{name}"});return s.strokes.template.set("strokeWidth",1.5),s.fills.template.setAll({fillOpacity:.1,visible:!0}),this.volumetricObjLineSeries=s,this.props.chartInfo(this.accessChartParams.chart),this.groundExportingInfo.esriCTViewY=t+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",s},this.getDistanceOfIntersectingPointOnLine=(e,t)=>{var i;if(e&&(null===(i=null==t?void 0:t.paths)||void 0===i?void 0:i.length)>0){const i=N.default.nearestCoordinate(t,e).coordinate,s=[];let o=0;t.paths.forEach((e=>{e.forEach(((i,n)=>{if(0!==n){const a=[[U.default.clone(e[n-1]),U.default.clone(i)]];s[o++]=new z.default({hasZ:t.hasZ,hasM:t.hasM,paths:a,spatialReference:t.spatialReference.toJSON()})}}))}));const n=[];s.forEach((e=>{n.push(this.getLengthAsPerMapProjection(e,this.props.selectedLinearUnit))}));let a=0,l=-1;return s.some(((e,s)=>{if(N.default.intersects(e,i)){const s=e.getPoint(0,0);if(N.default.intersects(s,i))l=a+0;else{const e={paths:[[[s.x,s.y],[i.x,i.y]]],spatialReference:t.spatialReference},o=new z.default(e);l=a+this.getLengthAsPerMapProjection(o,this.props.selectedLinearUnit)}return!0}a+=n[s]})),l}return-1},this.createDataForIntersectingAssets=e=>ee(this,void 0,void 0,(function*(){var t,i,s,o,n,a;if(this.props.currentConfig){if(((null===(t=this.props.currentConfig)||void 0===t?void 0:t.hasOwnProperty("advanceOptions"))&&(null===(i=this.props.currentConfig)||void 0===i?void 0:i.advanceOptions)||(null===(o=null===(s=this.props.currentConfig)||void 0===s?void 0:s.assetSettings)||void 0===o?void 0:o.hasOwnProperty("isAssetSettingsEnabled"))&&(null===(n=this.props.currentConfig.assetSettings)||void 0===n?void 0:n.isAssetSettingsEnabled))&&(null===(a=this.props.assetIntersectionResult)||void 0===a?void 0:a.length)>0){const t=new Promise((t=>{this.intersectionSeriesKey={},this.props.assetIntersectionResult.forEach((t=>{var i,s,o,n;if((null===(i=null==t?void 0:t.settings)||void 0===i?void 0:i.elevationSettings)&&(null===(s=t.intersectionResult)||void 0===s?void 0:s.length)>0){const i=null===(n=null===(o=null==t?void 0:t.intersectionResult[0].intersectingFeature)||void 0===o?void 0:o.geometry)||void 0===n?void 0:n.type;"point"===i?this.createElevationDataForIntersectingPointLayer(t,e):"polyline"===i&&this.createElevationDataForIntersectingLineLayer(t,e)}})),t(e)}));return t}yield Promise.resolve()}})),this.createElevationDataForIntersectingPointLayer=(e,t)=>{var i;const s=e.settings.layerId,o=null===(i=null==e?void 0:e.settings)||void 0===i?void 0:i.elevationSettings,n=W.default.getMetersPerUnitForSR(new _.default(this.props.mapView.view.spatialReference.toJSON()));null==e||e.intersectionResult.forEach(((i,a)=>{var l,r,d,h,c,u;const p=this.getDistanceOfIntersectingPointOnLine(i.intersectingFeature.geometry,e.inputGeometry);let g;const v=i.intersectingFeature,f=(null===(l=null==e?void 0:e.settings)||void 0===l?void 0:l.displayField)?i.record.getFormattedFieldValue(null===(r=null==e?void 0:e.settings)||void 0===r?void 0:r.displayField,this.props.intl):void 0,m=null===(h=null===(d=null==e?void 0:e.settings)||void 0===d?void 0:d.style)||void 0===h?void 0:h.intersectingAssetShape,y=null===(u=null===(c=null==e?void 0:e.settings)||void 0===c?void 0:c.style)||void 0===u?void 0:u.intersectingAssetColor;let S=m;S||(S="circle");let x,b="";switch(S){case"rectangle":b+="margin: 0px 3px 0px 3px; height: 7px; width: 15px; background-color: "+y+";";break;case"circle":b+="margin: 0px 3px 0px 3px; height: 10px; width: 10px; background-color: "+y+"; border-radius: 50%;";break;case"square":b+="margin: 0px 3px 0px 3px; height: 10px; width: 10px; background-color: "+y+";";break;case"triangle":b+="margin: 0px 3px 0px 3px; width: 0; height: 0; border:5px solid transparent; border-bottom: 10px solid "+y+";"}"z"===o.type?(g=i.intersectingFeature.geometry.z*n,g=T(g,te,this.props.selectedElevationUnit)):"one"===o.type&&o.field1&&null!==v.attributes[o.field1]?(g=v.attributes[o.field1],o.unit&&o.unit!==this.props.selectedElevationUnit&&(g=T(g,o.unit,this.props.selectedElevationUnit))):"two"===o.type&&o.field1&&o.field2&&null!==v.attributes[o.field1]&&null!==v.attributes[o.field2]&&(g=v.attributes[o.field1],o.unit&&o.unit!==this.props.selectedElevationUnit&&(g=T(g,o.unit,this.props.selectedElevationUnit)),x=v.attributes[o.field2],o.unit&&o.unit!==this.props.selectedElevationUnit&&(x=T(x,o.unit,this.props.selectedElevationUnit)));const w=t.filter((e=>e.x>=p));let L;if(w.length<1){const e=t.length;t[e-1].x<p&&(L=t[e-1])}else null==w||w.some((e=>(L=e,!0)));const I=s+a+"y",C=s+a+"y2";L&&(void 0===g?"match profile"===o.type&&L.layerName?L[I]=L[L.layerName+"y"]:L[I]=L.y:L[I]=g,"two"===o.type?(L[C]=void 0===x?L.y:x,this.updateMinMaxForIntersectionProfile({pointIndex:L.pointIdx,layerId:s,seriesID:C,newValue:L[I],newValue2:L[C],displayField:f,assetShapeStyle:b,featureIndex:a})):this.updateMinMaxForIntersectionProfile({pointIndex:L.pointIdx,layerId:s,seriesID:I,newValue:L[I],newValue2:void 0,displayField:f,assetShapeStyle:b,featureIndex:a}))}))},this._getElevationValueForPointOnLineGeometry=(e,t,i)=>{let s;const o=this.getDistanceOfIntersectingPointOnLine(t,i.geometry),n=this.getLengthAsPerMapProjection(i.geometry,this.props.selectedLinearUnit),a=W.default.getMetersPerUnitForSR(new _.default(this.props.mapView.view.spatialReference.toJSON()));if("z"===e.type)s=t.z*a,s=T(s,te,this.props.selectedElevationUnit);else if("one"===e.type&&e.field1&&null!==i.attributes[e.field1])s=i.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(s=T(s,e.unit,this.props.selectedElevationUnit));else if("two"===e.type&&e.field1&&e.field2&&null!==i.attributes[e.field1]&&null!==i.attributes[e.field2]){let t=i.attributes[e.field1];e.unit&&e.unit!==this.props.selectedElevationUnit&&(t=T(t,e.unit,this.props.selectedElevationUnit));let a=i.attributes[e.field2];e.unit&&e.unit!==this.props.selectedElevationUnit&&(a=T(a,e.unit,this.props.selectedElevationUnit));s=t+(a-t)/n*o}return s},this.createElevationDataForIntersectingLineLayer=(e,i)=>{const s=e.settings.elevationSettings,o=e.settings.layerId,n=i.length;null==e||e.intersectionResult.forEach(((a,l)=>{var r,d,h,c;const u=a.intersectingFeature,p=(null===(r=null==e?void 0:e.settings)||void 0===r?void 0:r.displayField)?a.record.getFormattedFieldValue(null===(d=null==e?void 0:e.settings)||void 0===d?void 0:d.displayField,this.props.intl):void 0,g="margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:"+(null===(c=null===(h=null==e?void 0:e.settings)||void 0===h?void 0:h.style)||void 0===c?void 0:c.intersectingAssetColor)+";";a.connectedFeatureForProfiling.forEach((a=>{let r=[],d=[];const h=[],c=[];a.paths.forEach(((a,v)=>{d=[],r=[],h[v]=[],c[v]=[];const f=o+"y_I_"+l+"_"+v,m=o+"y-point_"+l+"_"+v;a.forEach(((a,y)=>{const S=new G.default(a),x=N.default.nearestCoordinate(e.inputGeometry,S).coordinate;let b=this.getDistanceOfIntersectingPointOnLine(x,e.inputGeometry);const w=this._getElevationValueForPointOnLineGeometry(s,S,u);if(r.push(w),d.push(b),0!==y){let e=d[y-1],a=w,u=r[y-1];b<e&&(e+=b,b=e-b,e-=b,a=r[y-1],u=w);const S=b-e,x=U.default.clone(e);e+=S;let L=i.filter((t=>t.x>=x&&t.x<e));if(0===L.length&&(0===e&&n>0?L=[i[0]]:(L=i.filter((t=>t.x<e)),L.length>0&&(L=[L[L.length-1]]))),L.length>1){if(void 0===a||void 0===u)L.forEach((e=>{let t=e.y;"match profile"===s.type&&e.layerName&&(t=e[e.layerName+"y"]),e[f]=t,this.updateMinMaxForIntersectionProfile({pointIndex:e.pointIdx,layerId:o,seriesID:f,newValue:t,newValue2:void 0,displayField:p,assetShapeStyle:g,featureIndex:l})}));else{const e=(a-u)/S;L.forEach((t=>{let i=0;i=t.x-x;const s=u+e*i;t[f]=s,this.updateMinMaxForIntersectionProfile({pointIndex:t.pointIdx,layerId:o,seriesID:f,newValue:s,newValue2:void 0,displayField:p,assetShapeStyle:g,featureIndex:l})}))}const e=L[0],t=L[L.length-1];e.x===t.x?(h[v].push([e]),c[v].push([a])):(h[v].push([e,t]),c[v].push([u,a]))}else if(1===L.length){let e=!1;h[v].length>0&&h[v].some((i=>{if(t.lodash.isDeepEqual(L,i))return e=!0,!0})),e||(h[v].push([L[0]]),c[v].push([u]))}else if(0===L.length){let t;i[n-1].x<e&&(t=i[n-1],void 0===a&&(a="match profile"===s.type&&t.layerName?t[t.layerName+"y"]:t.y),t[m]=a,this.updateMinMaxForIntersectionProfile({pointIndex:t.pointIdx,layerId:o,seriesID:m,newValue:a,newValue2:void 0,displayField:p,assetShapeStyle:g,featureIndex:l})),h[v].push([]),c[v].push([])}}}))})),h.forEach(((e,t)=>{const i=o+"y_I_"+l+"_"+t,n=o+"y-point_"+l+"_"+t;let a=0;if(e.forEach((e=>{a+=e.length})),a>1)e.forEach(((e,n)=>{if(e.length>0){let a,r;1===e.length&&(r=c[t][n][0],a=e[0],void 0===r&&(r="match profile"===s.type&&a.layerName?a[a.layerName+"y"]:a.y),a[i]=r,this.updateMinMaxForIntersectionProfile({pointIndex:a.pointIdx,layerId:o,seriesID:i,newValue:r,newValue2:void 0,displayField:p,assetShapeStyle:g,featureIndex:l}))}}));else if(1===a){let i,a;e.some(((e,r)=>{if(e.length>0&&e[0])return i=e[0],a=c[t][r][0],void 0===a&&(a="match profile"===s.type&&i.layerName?i[i.layerName+"y"]:i.y),i[n]=a,this.updateMinMaxForIntersectionProfile({pointIndex:i.pointIdx,layerId:o,seriesID:n,newValue:a,newValue2:void 0,displayField:p,assetShapeStyle:g,featureIndex:l}),!0}))}}))})),a.disconnectedFeatureForProfiling.forEach(((t,n)=>{const a=this._getElevationValueForPointOnLineGeometry(s,t,u),r=this.getDistanceOfIntersectingPointOnLine(t,e.inputGeometry),d=i.filter((e=>e.x>=r));let h;const c=o+"y-point_"+l+"_"+n+"_d";if(d.length<1){const e=i.length;i[e-1].x<r&&(h=i[e-1])}else null==d||d.some((e=>{if(!e.hasOwnProperty(c))return h=e,!0}));h&&(void 0===a?"match profile"===s.type&&h.layerName?h[c]=h[h.layerName+"y"]:h[c]=h.y:h[c]=a,this.updateMinMaxForIntersectionProfile({pointIndex:h.pointIdx,layerId:o,seriesID:c,newValue:h[c],newValue2:void 0,displayField:p,assetShapeStyle:g,featureIndex:l}))}))}))},this.createDataForProfileLines=e=>ee(this,void 0,void 0,(function*(){if(this.canShowProfileSettingsForBackward(this.props.currentConfig)){const t=this.checkForProfileSettings();if(t.length>0){return new Promise(((i,s)=>{this.getDistanceOfAllSelectedFeatures().then((s=>{t.forEach((t=>{let i=0;this.props.drawingLayer.graphics.forEach(((o,n)=>ee(this,void 0,void 0,(function*(){const a=o.attributes.esriCTFeatureLayerId,l=this.getConfiguredSettingsForLine(a);if((null==l?void 0:l.elevationSettings)&&a===t){const t=s[n],a=U.default.clone(i);i+=t;const r=e.filter((e=>e.x>=a&&e.x<=i));this.addElevationForSelectedFeature(l.elevationSettings,o,t,r,a)}else i+=s[n]}))))})),i(e)}))}))}yield Promise.resolve()}else yield Promise.resolve()})),this.removeNegativeExponents=e=>{let t;return t=e.toString().toLowerCase().split("e-").length>1?0:e,t},this.getLengthAsPerMapProjection=(e,t)=>{const i=this.props.mapView.view.spatialReference.isWebMercator||this.props.mapView.view.spatialReference.isGeographic?N.default.geodesicLength(e,t):N.default.planarLength(e,t);return this.removeNegativeExponents(i)},this.getDistanceAsPerMapProjection=(e,t)=>this.props.mapView.view.spatialReference.isWebMercator||this.props.mapView.view.spatialReference.isGeographic?B.default.geodesicLength(e,t):B.default.planarLength(e,t),this.getConfiguredSettingsForLine=e=>this.updatedProfileLayers.find((t=>t.layerId===e)),this.getDistanceAsPerConfiguredFieldAndUnits=(e,t)=>{const i=t.attributes[e.field];return isNaN(Number(i))?0:T(i,e.unit,this.props.selectedLinearUnit)},this.updateMinMaxForIntersectionProfile=e=>{let t=e.newValue,i=e.newValue;this.intersectionSeriesKey[e.pointIndex]||(this.intersectionSeriesKey[e.pointIndex]={}),this.intersectionSeriesKeyIndex[e.pointIndex]=e.pointIndex;const s={seriesId:e.seriesID,value:e.newValue,assetStyle:e.assetShapeStyle,featureIndex:e.featureIndex,layerId:e.layerId};void 0!==e.newValue2&&(s.y2=e.newValue2,i<e.newValue2&&(i=e.newValue2),t>e.newValue2&&(t=e.newValue2)),void 0!==e.displayField&&null!==e.displayField&&(s.displayField=e.displayField),this.intersectionSeriesKey[e.pointIndex][e.layerId]||(this.intersectionSeriesKey[e.pointIndex][e.layerId]=[]),this.intersectionSeriesKey[e.pointIndex][e.layerId].push(s),this.minMaxOfEachProfile[e.layerId]?this.minMaxOfEachProfile[e.layerId]&&(this.minMaxOfEachProfile[e.layerId].min>t&&(this.minMaxOfEachProfile[e.layerId].min=t),this.minMaxOfEachProfile[e.layerId].max<i&&(this.minMaxOfEachProfile[e.layerId].max=i)):this.minMaxOfEachProfile[e.layerId]={min:t,max:i}},this.updateMinMaxForProfile=(e,t,i)=>{this.seriesKey[e]=t+"y",this.seriesValue[e]=i,this.intersectionSeriesKeyIndex[e]=null,this.minMaxOfEachProfile[t]?this.minMaxOfEachProfile[t]&&(this.minMaxOfEachProfile[t].min>i&&(this.minMaxOfEachProfile[t].min=i),this.minMaxOfEachProfile[t].max<i&&(this.minMaxOfEachProfile[t].max=i)):this.minMaxOfEachProfile[t]={min:i,max:i}},this.addElevationForSelectedFeature=(e,t,i,s,o)=>{var n,a;let l,r;const d=t.attributes.esriCTFeatureLayerId;if("one"===e.type&&e.field1&&null!==t.attributes[e.field1])l=t.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(l=T(l,e.unit,this.props.selectedElevationUnit)),s.forEach((e=>{e[d+"y"]=l,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,l)}));else if("two"===e.type&&e.field1&&e.field2&&null!==t.attributes[e.field1]&&null!==t.attributes[e.field2]){l=t.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(l=T(l,e.unit,this.props.selectedElevationUnit)),r=t.attributes[e.field2],e.unit&&e.unit!==this.props.selectedElevationUnit&&(r=T(r,e.unit,this.props.selectedElevationUnit));const n=(r-l)/i;s.forEach((e=>{let t=0;t=e.x-o;const i=l+n*t;e[d+"y"]=i,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,i)}))}else if("z"===e.type&&t.geometry.hasZ){const e=t.geometry;if((null===(n=e.paths)||void 0===n?void 0:n.length)>0){const t=[];let i=0;e.paths.forEach((s=>{s.forEach(((o,n)=>{if(0!==n){const a=[[U.default.clone(s[n-1]),U.default.clone(o)]];t[i++]=new z.default({hasZ:e.hasZ,hasM:e.hasM,paths:a,spatialReference:e.spatialReference.toJSON()})}}))}));const o=W.default.getMetersPerUnitForSR(new _.default(this.props.mapView.view.spatialReference.toJSON()));let n=null===(a=s[0])||void 0===a?void 0:a.x;const l=this.props.drawingLayer.elevationInfo;t.forEach(((e,i)=>{const a=this.getLengthAsPerMapProjection(e,this.props.selectedLinearUnit),r=t[i].paths[0][0][2]*o,h=t[i].paths[0][1][2]*o,c=s.filter((e=>e.x>=n&&e.x<=n+a));let u=T(r,te,this.props.selectedElevationUnit),p=T(h,te,this.props.selectedElevationUnit);"3d"===this.props.mapView.view.type&&l&&(null==c?void 0:c.length)>0&&("relative-to-ground"!==l.mode&&"relative-to-scene"!==l.mode||(u+=c[0].y,p+=c[c.length-1].y));const g=(p-u)/a;c.forEach((e=>{if(!e[d+"y"]){let t=0;t=e.x-n;let i=u+g*t;"3d"===this.props.mapView.view.type&&"on-the-ground"===(null==l?void 0:l.mode)&&(i=e.y),e[d+"y"]=i,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,i)}})),n+=a}))}}else e.type&&s.forEach((e=>{e[d+"y"]=e.y,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,e.y)}))},this.getDistanceOfAllSelectedFeatures=()=>{const e=[];return this.props.drawingLayer.graphics.forEach((t=>{e.push(this.getDistanceAsPerMapProjection(t.geometry,this.props.selectedLinearUnit))})),Promise.all(e)},this.addLineSeries=(e,i)=>{let s=null,o="";const n=t.DataSourceManager.getInstance();if(this.updatedProfileLayers.length>0&&(s=this.updatedProfileLayers.filter((t=>t.layerId===e))),1===(null==s?void 0:s.length)){o=n.getDataSource(e).layer.title;const t=Q.LineSeriesAm5.new(i.chart.root,{name:o,connect:!1,excludeFromTotal:!0,stroke:(0,Q.colorAm5)(s[0].style.lineColor),valueXField:"x",valueYField:e+"y",xAxis:i.xAxis,yAxis:i.yAxis,legendLabelText:"{name}"});"dotted-line"===s[0].style.lineType?t.strokes.template.setAll({strokeWidth:s[0].style.lineThickness,strokeDasharray:[2,4]}):"dashed-line"===s[0].style.lineType?t.strokes.template.setAll({strokeWidth:s[0].style.lineThickness,strokeDasharray:[8,4]}):t.strokes.template.set("strokeWidth",s[0].style.lineThickness),t.fills.template.setAll({visible:!0}),t.data.setAll(i.params.definition.data),i.chart.series.push(t),this.groundExportingInfo[e+"y"]=o+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")"}},this.getDisplayFieldAlias=(e,i)=>{var s,o;const n=t.DataSourceManager.getInstance().getDataSource(e),a=null===(s=null==n?void 0:n.getSchema())||void 0===s?void 0:s.fields;return(null===(o=null==a?void 0:a[i])||void 0===o?void 0:o.alias)||i},this.createPointSeriesForIntersectingLines=(e,t,i,s,o)=>{const n=Q.LineSeriesAm5.new(e.chart.root,{calculateAggregates:!1,name:i,stroke:(0,Q.colorAm5)(t.style.intersectingAssetColor),valueXField:"x",valueYField:t.layerId+"y-point_"+s+"_"+o,xAxis:e.xAxis,yAxis:e.yAxis}),a=Q.ContainerAm5.new(e.chart.root,{centerX:Q.p50,centerY:Q.p50});return a.children.push(Q.RectangleAm5.new(e.chart.root,{x:Q.p50,y:Q.p50,width:t.style.intersectingAssetSize?t.style.intersectingAssetSize:6,height:t.style.intersectingAssetSize?t.style.intersectingAssetSize:6,fill:(0,Q.colorAm5)(t.style.intersectingAssetColor),stroke:(0,Q.colorAm5)(t.style.intersectingAssetColor)})),n.bullets.push((function(t){return Q.BulletAm5.new(e.chart.root,{sprite:a})})),this.seriesToBeHiddenInLegend.push(n.uid),n.data.setAll(e.params.definition.data),e.chart.series.push(n),n},this.createSeriesForIntersectingLines=(e,t,i,s,o)=>{const n=Q.LineSeriesAm5.new(e.chart.root,{name:i,connect:!1,excludeFromTotal:!0,stroke:(0,Q.colorAm5)(t.style.intersectingAssetColor),valueXField:"x",valueYField:t.layerId+"y_I_"+s+"_"+o,xAxis:e.xAxis,yAxis:e.yAxis,legendLabelText:"{name}"}),a=t.style.intersectingAssetSize?t.style.intersectingAssetSize:4;"dotted-line"===t.style.intersectingAssetShape?n.strokes.template.setAll({strokeWidth:a,strokeDasharray:[2,4]}):"dashed-line"===t.style.intersectingAssetShape?n.strokes.template.setAll({strokeWidth:a,strokeDasharray:[8,4]}):n.strokes.template.set("strokeWidth",a),n.fills.template.setAll({visible:!0}),n.data.setAll(e.params.definition.data);const l=this.createPointSeriesForIntersectingLines(e,t,i,s,o);return n.on("visible",(function(e,t){e?(l.show(0),n.show(0)):(l.hide(0),n.hide(0))})),e.chart.series.push(n),n},this.addIntersectingLineSeries=(e,t)=>{var i;const s=null==e?void 0:e.title,o=null==e?void 0:e.settings,n=[];o&&s&&(null==e||e.intersectionResult.forEach(((e,i)=>{e.connectedFeatureForProfiling.forEach((e=>{e.paths.forEach(((e,a)=>{const l=this.createSeriesForIntersectingLines(t,o,s,i,a);n.length>0&&this.seriesToBeHiddenInLegend.push(l.uid),n.push(l)}))})),e.disconnectedFeatureForProfiling.forEach(((e,a)=>{const l=this.createSeriesForIntersectingLines(t,o,s,i,a+"_d");n.length>0&&this.seriesToBeHiddenInLegend.push(l.uid),n.push(l)}))})),this.intersectingLayersExportingInfo[o.layerId]={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",intersectingLayerY:this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",layerName:s,intersectingLayerDisplayField:this.getDisplayFieldAlias(o.layerId,o.displayField)},null===(i=n[0])||void 0===i||i.on("visible",(function(e){n.forEach((t=>{e?t.show(0):t.hide(0)}))})))},this.addPointSeries=(e,t)=>{const i=null==e?void 0:e.title,s=null==e?void 0:e.settings,o=[];if(s&&i){for(let n=0;n<e.intersectionResult.length;n++){let e;if("two"===s.elevationSettings.type){e=Q.ColumnSeries.new(t.chart.root,{sequencedInterpolation:!1,name:i,stroke:(0,Q.colorAm5)(s.style.intersectingAssetColor),valueXField:"x",openValueYField:s.layerId+n+"y",valueYField:s.layerId+n+"y2",xAxis:t.xAxis,yAxis:t.yAxis});this.createBulletsForDumbbellPlotSeries(t,e,s).set("locationY",1);this.createBulletsForPointSeries(t,e,s).set("locationY",.5);this.createBulletsForDumbbellPlotSeries(t,e,s).set("locationY",0)}else e=Q.LineSeriesAm5.new(t.chart.root,{calculateAggregates:!1,name:i,stroke:(0,Q.colorAm5)(s.style.intersectingAssetColor),valueXField:"x",valueYField:s.layerId+n+"y",xAxis:t.xAxis,yAxis:t.yAxis}),this.createBulletsForPointSeries(t,e,s);this.seriesToBeHiddenInLegend.push(e.uid),null==e||e.data.setAll(t.params.definition.data),t.chart.series.push(e),o.push(e)}const n=Q.LineSeriesAm5.new(t.chart.root,{name:i,connect:!1,excludeFromTotal:!0,stroke:(0,Q.colorAm5)(s.style.intersectingAssetColor),valueXField:"x",valueYField:s.layerId+"y-linePoint",xAxis:t.xAxis,yAxis:t.yAxis,legendLabelText:"{name}"});n.strokes.template.setAll({strokeWidth:1,strokeOpacity:0}),n.fills.template.setAll({visible:!0}),n.data.setAll(t.params.definition.data),this.createBulletsForPointSeries(t,n,s,!0),null==n||n.on("visible",(function(e){o.forEach((t=>{e?t.show(0):t.hide(0)}))})),n.data.setAll(t.params.definition.data),t.chart.series.push(n);const a=this.getDisplayFieldAlias(s.layerId,s.displayField);"two"===s.elevationSettings.type?this.intersectingLayersExportingInfo[s.layerId]={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",intersectingLayerY:this.nls("oneFieldLabelForExport")+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",intersectingLayerY2:this.nls("twoFieldLabelForExport")+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",layerName:i,intersectingLayerDisplayField:a}:this.intersectingLayersExportingInfo[s.layerId]={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",intersectingLayerY:this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",layerName:i,intersectingLayerDisplayField:a}}},this.createBulletsForPointSeries=(e,t,i,s)=>{let o=i.style.intersectingAssetSize?i.style.intersectingAssetSize:6;s&&o>10&&(o=10);const n=Q.ContainerAm5.new(e.chart.root,{centerX:Q.p50,centerY:Q.p50});let a;switch(i.style.intersectingAssetShape){case"rectangle":a=Q.RectangleAm5.new(e.chart.root,{x:Q.p50,y:Q.p50,interactive:!0,width:o,height:o/2,fill:(0,Q.colorAm5)(i.style.intersectingAssetColor),stroke:(0,Q.colorAm5)(i.style.intersectingAssetColor)});break;case"square":a=Q.RectangleAm5.new(e.chart.root,{x:Q.p50,y:Q.p50,interactive:!0,width:o,height:o,fill:(0,Q.colorAm5)(i.style.intersectingAssetColor),stroke:(0,Q.colorAm5)(i.style.intersectingAssetColor)});break;case"triangle":a=Q.TriangleAm5.new(e.chart.root,{x:Q.p50,y:Q.p50,interactive:!0,width:o,height:o,fill:(0,Q.colorAm5)(i.style.intersectingAssetColor),stroke:(0,Q.colorAm5)(i.style.intersectingAssetColor)});break;default:a=Q.CircleAm5.new(e.chart.root,{interactive:!0,radius:o,fill:(0,Q.colorAm5)(i.style.intersectingAssetColor),stroke:(0,Q.colorAm5)(i.style.intersectingAssetColor),x:Q.p50,y:Q.p50})}n.children.push(a),a.states.create("hover",{scale:1.3});const l=Q.BulletAm5.new(e.chart.root,{sprite:n});return t.bullets.push((function(){return l})),l},this.createBulletsForDumbbellPlotSeries=(e,t,i)=>{const s=i.style.intersectingAssetSize?i.style.intersectingAssetSize:6,o=Q.ContainerAm5.new(e.chart.root,{centerX:Q.p50,centerY:Q.p50});o.children.push(Q.RectangleAm5.new(e.chart.root,{width:"circle"===i.style.intersectingAssetShape?2*s:s+2,height:1,fill:(0,Q.colorAm5)(i.style.intersectingAssetColor),stroke:(0,Q.colorAm5)(i.style.intersectingAssetColor)}));const n=Q.BulletAm5.new(e.chart.root,{sprite:o});return t.bullets.push((function(){return n})),n},this.displayChartLegend=e=>{const{chart:t}=e,i=t.children.push(Q.LegendAm5.new(t.root,{x:this.isRTL?Q.p100:Q.p0,centerX:this.isRTL?Q.p100:Q.p0,reverseChildren:this.isRTL,visible:this.state.showLegend}));i.itemContainers.template.setAll({reverseChildren:this.isRTL,paddingTop:5,marginBottom:0,paddingBottom:0}),i.labels.template.setAll({direction:this.isRTL?"rtl":"ltr",textAlign:this.isRTL?"end":"start",paddingRight:this.isRTL?5:0}),i.valueLabels.template.set("forceHidden",!0);const s=t.series.values.filter((e=>!this.seriesToBeHiddenInLegend.includes(e.uid)));i.data.setAll(s),i.itemContainers.each((e=>{e.events.on("click",(e=>{this.props.toggleLegendSeriesState(e.target.dataItem.dataContext.isHidden(),e.target.dataItem.dataContext.get("name"))}))})),this.chartLegend=i},this.makeFormatter=(e,t)=>{const i=Q.NumberFormatterAm5.new(e.chart.root,{});return i.format=(e,i,s=2)=>{if("string"==typeof e)return"";return`${k.default.formatNumber(e,{maximumFractionDigits:s})} ${t}`},i},this.minMaxOfEachProfile={},this.allDistances=[],this.seriesKey=[],this.seriesValue=[],this.intersectionSeriesKey={},this.intersectionSeriesKeyIndex=[],this.groundExportingInfo={},this.intersectingLayersExportingInfo={},this.seriesToBeHiddenInLegend=[];const a=(0,t.getAppStore)().getState();this.isRTL=null===(s=null==a?void 0:a.appContext)||void 0===s?void 0:s.isRTL,this.chart=null,this.xAxis=null,this.xAxisLabel=null,this.yAxisLabel=null,this.yAxis=null,this.chartSeries=null,this.viewOutput=null,this.volumetricObjLineSeries=null,this.accessChartParams=null,this.updatedProfileLayers=null===(o=this.props.currentConfig)||void 0===o?void 0:o.profileSettings.layers,this.state={chartDefinition:null,showLegend:null===(n=this.props.commonGeneralSettings)||void 0===n?void 0:n.showLegend},this.props.profileResult&&this.createOrUpdateChartDefinition()}render(){return(0,t.jsx)(t.React.Fragment,null,this.state&&this.state.chartDefinition&&(0,t.jsx)("div",{tabIndex:-1,className:"w-100 h-100 p-2"},(0,t.jsx)("div",{tabIndex:0,"aria-label":this.nls("chartRender"),className:"w-100 h-100",ref:this._chartContainer})))}}const{epIcon:se}=S();class oe extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{const t=Object.assign({},l,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{this.generateStats()},this.generateStats=()=>{this.selectedStats=[],this.props.activeDsConfig.profileChartSettings.selectedStatistics.forEach((e=>{e.enabled&&this.selectedStats.push({label:e.label,name:e.name})})),this.selectedStatisticsDisplay()},this.componentDidUpdate=e=>{e.selectedElevationUnit===this.props.selectedElevationUnit&&e.selectedLinearUnit===this.props.selectedLinearUnit&&e.selectedStatsDisplay===this.props.selectedStatsDisplay&&e.isFlip===this.props.isFlip&&e.chartDataUpdateTime===this.props.chartDataUpdateTime||this.generateStats(),e.renderSeries!==this.props.renderSeries&&this.selectedStatisticsDisplay()},this.selectedStatisticsDisplay=()=>{const e=[];let s="",o=null,n="";this.selectedStats.forEach((a=>{var l,r;this.props.renderSeries||this.props.legendName!==this.props.toggledSeriesName?(n=a.name,this.props.chartProfileResult?(this.props.isFlip&&a.name!==L.AvgElevation&&a.name!==L.MaxDistance&&a.name!==L.MaxElevation&&a.name!==L.MinElevation&&(n=I(a.name)),o=null===(r=null===(l=this.props.chartProfileResult)||void 0===l?void 0:l.statistics)||void 0===r?void 0:r[n],s=this.getStatsValueWithUnit(o,n)):s=this.nls("noStatsValue")):s=this.nls("noStatsValue"),e.push((0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{tabIndex:0,className:"statistic-info"},(0,t.jsx)(i.Label,{id:this.props.parentWidgetId+this.props.index,"aria-label":this.nls(a.name),className:"statistic-label text-break mb-1 pt-4"},this.nls(a.name)),(0,t.jsx)("div",{tabIndex:0,"aria-label":s},s))))})),this.setState({statsResultList:e})},this.getStatsValueWithUnit=(e,t)=>{let i="",s=null;return x.forEach((o=>{var n,a;t===L.MaxDistance?o.value===this.props.selectedLinearUnit&&(s=T(e,null===(n=this.props.chartProfileResult)||void 0===n?void 0:n.effectiveUnits.distance,this.props.selectedLinearUnit),i=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.nls(o.abbreviation)):t===L.MaxPositiveSlope||t===L.MaxNegativeSlope||t===L.AvgPositiveSlope||t===L.AvgNegativeSlope?i=null===e?this.nls("noStatsValue"):this.props.intl.formatNumber(e,{maximumFractionDigits:2})+" \xb0":o.value===this.props.selectedElevationUnit&&(s=T(e,null===(a=this.props.chartProfileResult)||void 0===a?void 0:a.effectiveUnits.elevation,this.props.selectedElevationUnit),i=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.nls(o.abbreviation))})),i},this.onExpandClick=()=>{this.setState({legendExpanded:!this.state.legendExpanded})},this.state={legendExpanded:!1,statsResultList:[]}}render(){return(0,t.jsx)("div",{tabIndex:-1},(0,t.jsx)("div",{tabIndex:-1,className:"ep-legend-section ep-shadow py-1"},(0,t.jsx)("div",{tabIndex:0,className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(i.Label,{id:this.props.parentWidgetId+this.props.index,"aria-label":this.props.legendName,className:"w-100 legendLabel text-break"},this.props.legendName),!this.props.singleSeriesExpandStat&&(0,t.jsx)("div",{tabIndex:0,className:this.state.legendExpanded?"arrow-up":"arrow-down"},(0,t.jsx)(i.Button,{id:this.props.parentWidgetId+this.props.index,role:"button","aria-expanded":this.state.legendExpanded,title:this.nls("expandLegend"),className:"expand-collapse-button",type:"tertiary",icon:!0,size:"sm",onClick:this.onExpandClick.bind(this)},(0,t.jsx)(i.Icon,{icon:se.iconExpandCollapse,size:"10"})))),(0,t.jsx)(i.Collapse,{isOpen:this.state.legendExpanded||this.props.singleSeriesExpandStat},(0,t.jsx)("div",{tabIndex:-1,className:"stat-content"},(0,t.jsx)("div",{tabIndex:0,className:"profile-statistics"},this.state.statsResultList.map(((e,i)=>(0,t.jsx)(t.React.Fragment,{key:i},e))))))))}}var ne=C(46420),ae=C.n(ne);const{epIcon:le}=S(),re=(0,t.getAppStore)().getState().portalSelf;class de extends t.React.PureComponent{constructor(e){var s,o,a,r,d,h,c,u,p,g,v,f,m,y,S,b,w,L,I,C,A,E,O,V,j,R,k;super(e),this.selectableLayers=[],this.intersectingLayers=[],this.alertElement=t.React.createRef(),this.nls=e=>{const t=Object.assign({},l,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.updateOutputStatistics=t.lodash.debounce((()=>{this.props.buildOutputStatistics(this.state.selectedElevationUnit,this.state.selectedLinearUnit,this.state.isFlipChart)}),700),this.componentDidMount=()=>{this.getSelectableLayers(this.props.activeDataSource),this.getIntersectingLayers(this.props.activeDataSource),this.props.intersectingBufferRuntime({enabled:this.state.isBufferSelectorEnableInConfig,bufferDistance:this.state.selectedBufferDistance,bufferUnits:this.state.selectedBufferUnit,bufferSymbol:this.state.selectedBufferSymbol}),(this.props.selectMode||this.props.drawMode)&&setTimeout((()=>{var e,t;null===(t=null===(e=this.alertElement)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),100)},this.componentDidUpdate=e=>{var i,s,o,n,a,l,r,d,h,c,u,p,g,v,f,m,y,S,x,b,w,L,I,C,A,E,D,F,P,O,V;const T=this.props.activeDatasourceConfig,j=e.activeDatasourceConfig,R=M(T,re);(e.commonDsGeneralSettings.showLegend!==(null===(i=this.props.commonDsGeneralSettings)||void 0===i?void 0:i.showLegend)||(null==j?void 0:j.profileChartSettings.displayStatistics)!==(null==T?void 0:T.profileChartSettings.displayStatistics)||e.chartDataUpdateTime!==this.props.chartDataUpdateTime||this.didStatisticsListChanged(null==j?void 0:j.profileChartSettings.selectedStatistics,null==T?void 0:T.profileChartSettings.selectedStatistics))&&this.setState({showLegend:null===(s=this.props.commonDsGeneralSettings)||void 0===s?void 0:s.showLegend,displayStats:null==T?void 0:T.profileChartSettings.displayStatistics,selectedStatisticsList:null==T?void 0:T.profileChartSettings.selectedStatistics},(()=>{this.state.displayStats&&this.props.profileResult||this.setState({statisticsOpen:!1}),this.displayStatisticsInfo(this.chart),this.exportOptionDisplay()})),e.commonDsGeneralSettings.allowExport===(null===(o=this.props.commonDsGeneralSettings)||void 0===o?void 0:o.allowExport)&&e.chartDataUpdateTime===this.props.chartDataUpdateTime||this.setState({allowExport:null===(n=this.props.commonDsGeneralSettings)||void 0===n?void 0:n.allowExport,isExport:!1},(()=>{e.chartDataUpdateTime!==this.props.chartDataUpdateTime&&(this.setState({distanceInterval:this.getDefaultIntervalValue()}),this.showIntervalError(this.getDefaultIntervalValue()))})),e.noFeaturesFoundError!==this.props.noFeaturesFoundError&&this.setState({noFeaturesError:this.props.noFeaturesFoundError}),e.viewModelErrorState===this.props.viewModelErrorState&&e.profileErrorMsg===this.props.profileErrorMsg||this.setState({noValidInput:this.props.viewModelErrorState,viewModelErrorMsg:this.props.profileErrorMsg}),(null==j?void 0:j.profileChartSettings.elevationUnit)===(null==T?void 0:T.profileChartSettings.elevationUnit)&&(null==j?void 0:j.profileChartSettings.linearUnit)===(null==T?void 0:T.profileChartSettings.linearUnit)&&(null==j?void 0:j.advanceOptions)===(null==T?void 0:T.advanceOptions)&&(null===(a=null==j?void 0:j.profileSettings)||void 0===a?void 0:a.isProfileSettingsEnabled)===(null===(l=null==T?void 0:T.profileSettings)||void 0===l?void 0:l.isProfileSettingsEnabled)&&(null===(r=null==j?void 0:j.profileSettings)||void 0===r?void 0:r.isCustomizeOptionEnabled)===(null===(d=null==T?void 0:T.profileSettings)||void 0===d?void 0:d.isCustomizeOptionEnabled)&&(null===(h=null==j?void 0:j.assetSettings)||void 0===h?void 0:h.isAssetSettingsEnabled)===(null===(c=null==T?void 0:T.assetSettings)||void 0===c?void 0:c.isAssetSettingsEnabled)||this.setState({selectedElevationUnit:(null==T?void 0:T.profileChartSettings.elevationUnit)?T.profileChartSettings.elevationUnit:R[0],selectedLinearUnit:(null==T?void 0:T.profileChartSettings.linearUnit)?T.profileChartSettings.linearUnit:R[1],isProfileSettingsOptionEnabled:null==T?void 0:T.profileSettings.isProfileSettingsEnabled,isCustomizeOptionEnabled:null==T?void 0:T.profileSettings.isCustomizeOptionEnabled,isAssetSettingsOptionEnabled:null===(u=null==T?void 0:T.assetSettings)||void 0===u?void 0:u.isAssetSettingsEnabled,profileLayers:null==T?void 0:T.profileSettings.layers,intersectingLayers:null===(p=null==T?void 0:T.assetSettings)||void 0===p?void 0:p.layers},(()=>{this.displayStatisticsInfo(this.chart),this.showIntervalError(this.getDefaultIntervalValue()),this.exportOptionDisplay(),this.getSelectableLayers(this.props.activeDataSource),this.getIntersectingLayers(this.props.activeDataSource)})),(null==j?void 0:j.profileChartSettings.showVolumetricObjLineInGraph)===(null==T?void 0:T.profileChartSettings.showVolumetricObjLineInGraph)&&(null==j?void 0:j.profileChartSettings.volumetricObjLineColor)===(null==T?void 0:T.profileChartSettings.volumetricObjLineColor)&&(null==j?void 0:j.profileChartSettings.volumetricObjLabel)===(null==T?void 0:T.profileChartSettings.volumetricObjLabel)||this.setState({showViewLineGraph:null==T?void 0:T.profileChartSettings.showVolumetricObjLineInGraph,volumetricObjLineColor:null==T?void 0:T.profileChartSettings.volumetricObjLineColor,volumetricObjLabel:null==T?void 0:T.profileChartSettings.volumetricObjLabel}),this.didProfileLayersSettingsChanged(null==j?void 0:j.profileSettings.layers,null==T?void 0:T.profileSettings.layers)&&this.setState({profileLayers:null==T?void 0:T.profileSettings.layers},(()=>{this.getSelectableLayers(this.props.activeDataSource)})),this.didIntersectingLayersSettingsChanged(null===(g=null==j?void 0:j.assetSettings)||void 0===g?void 0:g.layers,null===(v=null==T?void 0:T.assetSettings)||void 0===v?void 0:v.layers)&&this.setState({intersectingLayers:null===(f=null==T?void 0:T.assetSettings)||void 0===f?void 0:f.layers},(()=>{this.getIntersectingLayers(this.props.activeDataSource)})),(this.props.drawMode&&e.onDrawingComplete!==this.props.onDrawingComplete||e.isNewSegmentsForSelection!==this.props.isNewSegmentsForSelection||e.noGraphicAfterFirstSelection!==this.props.noGraphicAfterFirstSelection)&&this.setState({dismissInfoMsg:this.props.selectMode&&this.props.isNewSegmentsForSelection||this.props.drawMode&&!this.props.onDrawingComplete,dismissWarningMsg:!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection&&this.props.selectMode}),(null===(y=null===(m=null==j?void 0:j.assetSettings)||void 0===m?void 0:m.assetIntersectingBuffer)||void 0===y?void 0:y.enabled)===(null===(x=null===(S=null==T?void 0:T.assetSettings)||void 0===S?void 0:S.assetIntersectingBuffer)||void 0===x?void 0:x.enabled)&&(null===(w=null===(b=null==j?void 0:j.assetSettings)||void 0===b?void 0:b.assetIntersectingBuffer)||void 0===w?void 0:w.bufferDistance)===(null===(I=null===(L=null==T?void 0:T.assetSettings)||void 0===L?void 0:L.assetIntersectingBuffer)||void 0===I?void 0:I.bufferDistance)&&(null===(A=null===(C=null==j?void 0:j.assetSettings)||void 0===C?void 0:C.assetIntersectingBuffer)||void 0===A?void 0:A.bufferUnits)===(null===(D=null===(E=null==T?void 0:T.assetSettings)||void 0===E?void 0:E.assetIntersectingBuffer)||void 0===D?void 0:D.bufferUnits)&&t.lodash.isDeepEqual(null===(P=null===(F=null==j?void 0:j.assetSettings)||void 0===F?void 0:F.assetIntersectingBuffer)||void 0===P?void 0:P.bufferSymbol,null===(V=null===(O=null==T?void 0:T.assetSettings)||void 0===O?void 0:O.assetIntersectingBuffer)||void 0===V?void 0:V.bufferSymbol)||this.setState({isBufferSelectorEnableInConfig:null==T?void 0:T.assetSettings.assetIntersectingBuffer.enabled,isBufferSelectorEnableAtRuntime:null==T?void 0:T.assetSettings.assetIntersectingBuffer.enabled,selectedBufferDistance:(null==T?void 0:T.assetSettings.assetIntersectingBuffer.bufferDistance)||this.state.selectedBufferDistance,selectedBufferUnit:(null==T?void 0:T.assetSettings.assetIntersectingBuffer.bufferUnits)||this.state.selectedBufferUnit,selectedBufferSymbol:null==T?void 0:T.assetSettings.assetIntersectingBuffer.bufferSymbol},(()=>{this.props.intersectingBufferRuntime({enabled:this.state.isBufferSelectorEnableInConfig,bufferDistance:this.state.selectedBufferDistance,bufferUnits:this.state.selectedBufferUnit,bufferSymbol:this.state.selectedBufferSymbol})})),this.state.statisticsOpen&&e.currentPageId!==this.props.currentPageId&&this.setState({statisticsOpen:!1})},this.didStatisticsListChanged=(e,t)=>{let i=!1;return null==t||t.some(((t,s)=>{if(t.name!==e[s].name||t.label!==e[s].label||t.enabled!==e[s].enabled)return i=!0,!0})),i},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.didIntersectingLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.showIntervalError=e=>{this.setState({distanceInterval:e}),e>=0&&e<=this.getMaxDistance()?this.setState({showInValidIntervalErrorMsg:!1}):this.setState({showInValidIntervalErrorMsg:!0,getIntervalsError:this.getIntervalLimitValues(0,this.getMaxDistance())})},this.getSelectableLayers=e=>{const t=D(e);this.selectableLayers=[];const i=[];let s=!1;null==t||t.forEach((e=>{var t,o,n,a;e&&e.getLayerDefinition()&&e.getLayerDefinition().geometryType&&((null===(t=this.props.activeDatasourceConfig)||void 0===t?void 0:t.hasOwnProperty("advanceOptions"))||this.state.isProfileSettingsOptionEnabled)&&((null===(o=this.props.activeDatasourceConfig)||void 0===o?void 0:o.hasOwnProperty("advanceOptions"))&&(null===(n=this.props.activeDatasourceConfig)||void 0===n?void 0:n.advanceOptions)||this.state.isCustomizeOptionEnabled?0===this.state.profileLayers.length?s=!1:"esriGeometryPolyline"===e.getLayerDefinition().geometryType&&(null===(a=this.state.profileLayers)||void 0===a||a.forEach((t=>{(null==t?void 0:t.layerId)===e.id&&(this.selectableLayers.push({label:e.getSchema().label,value:e.id}),i.push(e.id),s=!0)}))):"esriGeometryPolyline"===e.getLayerDefinition().geometryType&&(this.selectableLayers.push({label:e.getSchema().label,value:e.id}),i.push(e.id),s=!0))})),this.props.selectableLayersRuntime(i),this.setState({selectedLayers:i,isAnyProfileLineLayers:s})},this.getIntersectingLayers=e=>{const t=D(e);this.intersectingLayers=[];const i=[];let s=!1;null==t||t.forEach((e=>{var t,o;e&&e.getLayerDefinition()&&e.getLayerDefinition().geometryType&&this.state.isAssetSettingsOptionEnabled&&(0===(null===(t=this.state.intersectingLayers)||void 0===t?void 0:t.length)?s=!1:"esriGeometryPolyline"!==e.getLayerDefinition().geometryType&&"esriGeometryPoint"!==e.getLayerDefinition().geometryType||null===(o=this.state.intersectingLayers)||void 0===o||o.forEach((t=>{(null==t?void 0:t.layerId)===e.id&&(this.intersectingLayers.push({label:e.getSchema().label,value:e.id}),i.push(e.id),s=!0)})))})),this.props.intersectingLayersRuntime(i),this.setState({selectedIntersectedLayers:i,isAnyIntersectingLayers:s})},this.onDoneClick=()=>{this.props.doneClick()?this.setState({enableForNewProfile:!0}):this.setState({enableForNewProfile:!1,initialEmptyState:!1,emptyStateIfDoneClick:!0,noFeaturesError:!1,noValidInput:!1},(()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.alertElement)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),100)}))},this.toggleStatistics=()=>{this.setState({statisticsOpen:!this.state.statisticsOpen},(()=>{this.displayStatisticsInfo(this.chart)}))},this.toggleSettings=()=>{this.setState({settingsOptionsOpen:!this.state.settingsOptionsOpen})},this.highlightChartPosition=e=>{this.props.chartPosition(e)},this.hideChartPosition=()=>{this.props.hideChartPosition()},this.onChartFlip=()=>{this.setState({isFlipChart:!this.state.isFlipChart},(()=>{this.displayStatisticsInfo(this.chart),this.exportOptionDisplay()}))},this.onNewProfileClick=()=>{this.createNewProfile(),this.props.jimuMapView.clearSelectedFeatures(),this.setState({enableForNewProfile:!1})},this.onClearButtonClick=()=>{this.createNewProfile()},this.createNewProfile=()=>{this.props.activateDrawSelectToolForNewProfile(),this.setState({initialEmptyState:!0,emptyStateIfDoneClick:!1,noFeaturesError:!1,noValidInput:!1,statisticsOpen:!1,isExport:!1},(()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.alertElement)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),100)}))},this.onElevationUnitChange=e=>{this.setState({selectedElevationUnit:e.target.value},(()=>{this.displayStatisticsInfo(this.chart)}))},this.onLinearUnitChange=e=>{this.setState({selectedLinearUnit:e.target.value},(()=>{this.displayStatisticsInfo(this.chart),this.showIntervalError(this.getDefaultIntervalValue()),this.exportOptionDisplay()}))},this.onLayerSelected=(e,t,i)=>{let s=!0;this.setState({selectedLayers:i}),0===i.length&&(s=!1),this.setState({isLayerSelected:s}),this.props.selectableLayersRuntime(i)},this.onIntersectedLayerSelected=(e,t,i)=>{this.setState({selectedIntersectedLayers:i}),this.props.intersectingLayersRuntime(i)},this.displaySelectedFields=e=>{let t=this.nls("selectLayerLabel");return e&&e.length&&(t=this.props.intl.formatMessage({id:"selectedLayerCount",defaultMessage:l.selectedLayerCount},{selectedLayerCount:e.length})),t},this.updateBufferValues=()=>{this.props.intersectingBufferRuntime({enabled:this.state.isBufferSelectorEnableAtRuntime,bufferDistance:this.state.selectedBufferDistance,bufferUnits:this.state.selectedBufferUnit,bufferSymbol:this.state.selectedBufferSymbol})},this.onBufferSelectorChange=e=>{this.setState({isBufferSelectorEnableAtRuntime:e.target.checked},(()=>{this.updateBufferValues()}))},this.onBufferUnitsChange=e=>{const t=((e,t)=>{const i=F(t);return e>i?i:e})(this.state.selectedBufferDistance,e.target.value);this.setState({selectedBufferUnit:e.target.value,selectedBufferDistance:t},(()=>{this.updateBufferValues()}))},this.onBufferDistanceChange=e=>{this.setState({selectedBufferDistance:null!=e?e:0},(()=>{this.updateBufferValues()}))},this.onUniformScalingChange=e=>{this.setState({isUniformScalingEnable:e.target.checked})},this.setExportButtonState=e=>{this.setState({exportData:e})},this.customizeIntervalChange=e=>{this.setState({isCustomizeInterval:e.target.checked}),e.target.checked&&this.onDistanceIntervalChange(this.state.distanceInterval)},this.getMaxDistance=()=>{var e,t;return(null===(t=null===(e=this.props.profileResult)||void 0===e?void 0:e.statistics)||void 0===t?void 0:t.maxDistance)?T(this.props.profileResult.statistics.maxDistance,this.props.profileResult.effectiveUnits.distance,this.state.selectedLinearUnit):0},this.onExportButtonClick=()=>{this.state.showInValidIntervalErrorMsg?this.setState({exportData:!1}):this.setState({exportData:!0})},this.onExportCancelButtonClick=()=>{this.setState({isExport:!1})},this.getDefaultIntervalValue=()=>{const e=this.getMaxDistance();let t=1;return e<1&&e>=.1?t=.1:e<.1&&e>=.01?t=.01:e<.01&&e>=.001?t=.001:e<.001&&e>=1e-4&&(t=1e-4),t},this.onDistanceIntervalChange=e=>{this.setState({distanceInterval:null!=e?e:0},(()=>{0===this.state.distanceInterval?this.setState({showInValidIntervalErrorMsg:!0,getIntervalsError:this.getIntervalLimitValues(null,null)}):this.state.distanceInterval>=0&&this.state.distanceInterval<=this.getMaxDistance()?this.setState({showInValidIntervalErrorMsg:!1}):this.setState({showInValidIntervalErrorMsg:!0,getIntervalsError:this.getIntervalLimitValues(0,this.getMaxDistance())})}))},this.getIntervalLimitValues=(e,t)=>{let i="";return i=e||t?this.props.intl.formatMessage({id:"intervalErrorHint",defaultMessage:l.intervalErrorHint},{xMin:e,xMax:this.truncateMaxIntervalDistance(t)}):this.nls("intervalHintForInvalidEntry"),i},this.truncateMaxIntervalDistance=e=>{let t;if(!isNaN(e)&&null!==e){const i=4;t=new RegExp(i>0?"^\\d*[.]?\\d{0,"+i+"}":"^\\d*").exec(e.toString())[0],t=this.props.intl.formatNumber(t,{maximumFractionDigits:i})}return t},this.adjustInfoIconPosition=()=>{let e=-8;return"125%"===this.props.theme.ref.typeface.htmlFontSize&&(e=-11),e},this.exportOptionDisplay=()=>{const e=(0,t.getAppStore)().getState().appContext.isRTL,s=x.find((e=>e.value===this.state.selectedLinearUnit));return(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:n(this.props.theme),open:this.state.isExport,reference:"export"+this.props.widgetId,placement:"right-start",version:0,offset:[0,0],toggle:e=>{this.setState({isExport:!this.state.isExport})}},(0,t.jsx)("div",{style:{width:250},className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("chartExport"),className:"exportLabel text-break"},this.nls("chartExport")),(0,t.jsx)(i.Label,{tabIndex:0,className:"pt-2 pl-1 exportHintStyle"},this.nls("exportHint")),(0,t.jsx)("div",{className:"pt-1 pb-1 d-flex"},(0,t.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("customizeIntervalTooltip"),title:this.nls("customizeIntervalTooltip"),showArrow:!0,placement:"top"},(0,t.jsx)(i.Button,{className:"d-inline",style:{marginTop:this.adjustInfoIconPosition(),marginLeft:-4},type:"tertiary",icon:!0},(0,t.jsx)(i.Icon,{icon:le.infoIcon}))),(0,t.jsx)(i.Label,{className:"w-100 d-flex pl-1"},this.nls("customizeIntervalLabel")),(0,t.jsx)(i.Switch,{role:"switch","aria-label":this.nls("customizeIntervalLabel"),title:this.nls("customizeIntervalLabel"),checked:this.state.isCustomizeInterval,onChange:this.customizeIntervalChange})),(0,t.jsx)("div",{className:this.state.isCustomizeInterval?"showCustomizeEdit":"hideCustomizeEdit"},(0,t.jsx)("div",{className:(0,t.classNames)("d-flex",this.state.showInValidIntervalErrorMsg?"pb-1":"pb-2")},(0,t.jsx)(i.NumericInput,{"aria-label":this.nls("customizeIntervalLabel"),size:"sm",defaultValue:this.state.distanceInterval,value:this.state.distanceInterval,title:this.state.distanceInterval+"",className:(0,t.classNames)("ml-1 w-100",this.state.showInValidIntervalErrorMsg?"invalidValue":""),showHandlers:!1,onChange:this.onDistanceIntervalChange}),(0,t.jsx)("div",{title:this.nls(s.abbreviation),className:"style-setting--unit-selector border"},(0,t.jsx)(i.Label,{className:"text-truncate unitsLabel"},this.nls(s.abbreviation)))),(0,t.jsx)(i.Label,{className:(0,t.classNames)("ml-1 pb-1 invalidRange",this.state.isCustomizeInterval&&this.state.showInValidIntervalErrorMsg?"showCustomizeEdit":"hideCustomizeEdit")},this.state.getIntervalsError)),(0,t.jsx)("div",{style:{height:35},className:"mt-1 mb-2 d-flex w-100"},(0,t.jsx)("div",{className:"align-items-center w-100 pt-1",style:{display:"inline-block"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("exportLabel"),title:this.nls("exportLabel"),className:"actionButton text-break",style:{float:e?"left":"right"},size:"default",type:"primary",onClick:this.onExportButtonClick},this.nls("exportLabel")),(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("cancel"),title:this.nls("cancel"),className:"actionButton text-break",style:{float:e?"right":"left"},size:"default",type:"secondary",onClick:this.onExportCancelButtonClick},this.nls("cancel")))))))},this.displayStatisticsInfo=e=>{var s,o,n;const a=[];this.setState({legendStats:[]});let l=!1;(null==e?void 0:e.series)?((null===(o=null===(s=null==e?void 0:e.series)||void 0===s?void 0:s.values)||void 0===o?void 0:o[0])&&(l=!0),null===(n=null==e?void 0:e.series)||void 0===n||n.values.forEach(((e,i)=>{if(0===i)return a.push((0,t.jsx)(oe,{theme:this.props.theme,intl:this.props.intl,parentWidgetId:this.props.widgetId,index:i,key:e.name+i,singleSeriesExpandStat:l,legendName:e.get("name"),activeDsConfig:this.props.activeDatasourceConfig,selectedElevationUnit:this.state.selectedElevationUnit,selectedLinearUnit:this.state.selectedLinearUnit,chartDataUpdateTime:this.props.chartDataUpdateTime,chartProfileResult:this.props.visibleGroundProfileStats,selectedStatsDisplay:this.state.selectedStatisticsList,renderSeries:this.state.renderSeries,toggledSeriesName:this.state.toggledSeriesName,isFlip:this.state.isFlipChart})),!0}))):a.push((0,t.jsx)(i.Loading,{type:i.LoadingType.Donut})),this.setState({legendStats:a},(()=>{this.updateOutputStatistics()}))},this.statisticsDisplay=()=>{return(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:(e=this.props.theme,s=this.props.chartColorRender?this.props.chartColorRender:"#b54900",t.css`
    .ep-shadow {
      box-shadow: 0 0 8px 3px rgba(0,0,0,0.2)!important;
    }

    .ep-legend {
      height: 100px;
      overflow-y: auto;
    }

    .ep-legend-section {
      border-radius: 2px;
      padding: 5px;
      margin-top: 10px;
      border-left: 3px solid ${s};
      min-width: 120px;
    }

    .cursor-pointer {
      cursor: pointer
    }

    .legendLabel {
      margin-bottom: 0px;
      font-weight: bold;
      word-wrap: break-word;
    }

    .expand-collapse-button {
      &:hover {
        color: ${e.sys.color.secondary.dark};
      }
    }

    .arrow-up {
      transform-origin: center center;
      transform: rotate(180deg);
      transition: transform .5s ease 0s;
    }

    .arrow-down {
      transform-origin: center center;
      transform: rotate(0deg);
      transition: transform .5s ease 0s;
    }

    .stat-content {
      display: block;
      padding: 12px 15px;
      padding-top: 0;
    }

    .profile-statistics {
      --max-width: 105px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(var(--max-width), 1fr));
      gap: 2px 22px;
      width: 100%;
    }

    .statistic-info {
      display: block;
      text-align: start;
    }

    .statistic-label {
      font-weight: 500;
    }
  `),open:this.state.statisticsOpen,reference:"statistics"+this.props.widgetId,floating:!0,headerTitle:this.nls("statisticsLabel"),placement:"auto",version:0,offset:[0,0],onHeaderClose:()=>{this.setState({statisticsOpen:!this.state.statisticsOpen})},defaultSize:{width:400,height:235}},(0,t.jsx)("div",{style:{height:"calc(100% - 15px)",overflow:"auto"},className:"pr-4 pl-4 pt-2 pb-4"},this.state.legendStats.map(((e,i)=>(0,t.jsx)(t.React.Fragment,{key:i},e))))));var e,s},this.settingsOptionsRender=()=>(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:(this.props.theme,t.css`
  .settingsLabel {
    margin: 0 !important;
    font-weight: 500;
  }

  .selectLayerWarningMsg {
    padding: 1px !important;
    background-color: transparent !important;
    border: none !important;
    font-size: 11px;
  }

  .selectLayerWarningMsg .left-part {
    color: var(--sys-color-warning-dark) !important;
    margin-right: 0 !important;
  }

  .custom-multiselect .jimu-dropdown .jimu-btn .dropdown-button-content {
    padding-top: 3px;
    padding-bottom: 3px;
  }
  `),open:this.state.settingsOptionsOpen,reference:"settingsOptions"+this.props.widgetId,placement:"right-start",version:0,offset:[0,0],toggle:e=>{this.setState({settingsOptionsOpen:!this.state.settingsOptionsOpen})}},(0,t.jsx)("div",{tabIndex:-1,style:{width:175}},(0,t.jsx)("div",{tabIndex:-1,className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("elevationUnitLabel"),className:"settingsLabel text-break"},this.nls("elevationUnitLabel")),(0,t.jsx)(i.Select,{menuRole:"menu","aria-label":this.nls("elevationUnitLabel")+" "+this.state.selectedElevationUnit,className:"pt-1",name:"elevationUnit",size:"sm",onChange:this.onElevationUnitChange,value:this.state.selectedElevationUnit},x.map((e=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:e.value,value:e.value},this.nls(e.value)))))),(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("distanceUnitLabel"),className:"settingsLabel text-break"},this.nls("distanceUnitLabel")),(0,t.jsx)(i.Select,{menuRole:"menu","aria-label":this.nls("distanceUnitLabel")+" "+this.state.selectedLinearUnit,className:"pt-1",name:"linearUnit",size:"sm",onChange:this.onLinearUnitChange,value:this.state.selectedLinearUnit},x.map((e=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:e.value,value:e.value},this.nls(e.value)))))),this.props.selectMode&&this.state.isAnyProfileLineLayers&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("selectableLayersLabel"),className:"settingsLabel text-break"},this.nls("selectableLayersLabel")),!this.state.isLayerSelected&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 selectLayerWarningMsg",onClose:function(){},open:!this.state.isLayerSelected,text:this.nls("selectLayerWarning"),type:"warning",withIcon:!0}),(0,t.jsx)(i.MultiSelect,{items:(0,t.Immutable)(this.selectableLayers),values:(0,t.Immutable)(this.state.selectedLayers),className:"pt-1 custom-multiselect",buttonProps:{showDynamicTitle:!0},size:"sm",fluid:!0,onClickItem:this.onLayerSelected,displayByValues:this.displaySelectedFields}))),(this.props.selectMode||this.props.drawMode)&&this.state.isAnyIntersectingLayers&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("intersectingLayersLabel"),className:"settingsLabel text-break"},this.nls("intersectingLayersLabel")),(0,t.jsx)(i.MultiSelect,{items:(0,t.Immutable)(this.intersectingLayers),values:(0,t.Immutable)(this.state.selectedIntersectedLayers),className:"pt-1 custom-multiselect",buttonProps:{showDynamicTitle:!0},size:"sm",fluid:!0,onClickItem:this.onIntersectedLayerSelected,displayByValues:this.displaySelectedFields}))),this.state.isAssetSettingsOptionEnabled&&this.state.isBufferSelectorEnableInConfig&&(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("bufferSelectorLabel"),className:"w-100 d-flex"},(0,t.jsx)("div",{className:"flex-grow-1 settingsLabel text-break"},this.nls("bufferSelectorLabel")),(0,t.jsx)(i.Switch,{role:"switch","aria-label":this.nls("bufferSelectorLabel"),title:this.nls("bufferSelectorLabel"),checked:this.state.isBufferSelectorEnableAtRuntime,onChange:this.onBufferSelectorChange})),this.state.isBufferSelectorEnableAtRuntime&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.NumericInput,{"aria-label":this.nls("bufferSelectorLabel")+this.state.selectedBufferDistance,size:"sm",min:0,max:F(this.state.selectedBufferUnit),defaultValue:this.state.selectedBufferDistance,value:this.state.selectedBufferDistance,onChange:this.onBufferDistanceChange}),(0,t.jsx)(i.Select,{menuRole:"menu","aria-label":this.state.selectedBufferUnit,className:"pt-1 pb-1",size:"sm",name:"bufferUnits",value:this.state.selectedBufferUnit,onChange:this.onBufferUnitsChange},x.map(((e,s)=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:s,value:e.value},this.nls(e.value))))))),(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"pl-2 pb-2 pr-2"},(0,t.jsx)(i.Label,{className:"cursor-pointer settingsLabel text-break",title:this.nls("uniformChartScalingInfo")},(0,t.jsx)(i.Checkbox,{role:"checkbox",className:"mr-2 font-13","aria-label":this.nls("uniformChartScaling"),checked:this.state.isUniformScalingEnable,onChange:this.onUniformScalingChange.bind(this)}),this.nls("uniformChartScaling"))))))),this.dismissInfoMsg=()=>{this.setState({dismissInfoMsg:!this.state.dismissInfoMsg})},this.dismissWarningMsg=()=>{this.setState({dismissWarningMsg:!this.state.dismissWarningMsg})},this.getChartInfo=e=>{this.chart=e,setTimeout((()=>{this.displayStatisticsInfo(this.chart)}),50)},this.onToggleSeries=(e,t)=>{this.setState({renderSeries:e,toggledSeriesName:t})},this.toggleExport=()=>{this.setState({isExport:!this.state.isExport})};const U=M(this.props.activeDatasourceConfig,re);this.chart=null;let N=null===(a=null===(o=null===(s=this.props.activeDatasourceConfig)||void 0===s?void 0:s.assetSettings)||void 0===o?void 0:o.assetIntersectingBuffer)||void 0===a?void 0:a.bufferUnits;""===N&&(N=P(re)),this.state={initialEmptyState:!0,emptyStateIfDoneClick:!1,enableForNewProfile:!1,settingsOptionsOpen:!1,unitOptions:x,isFlipChart:!1,selectedElevationUnit:this.props.activeDatasourceConfig?U[0]:this.props.defaultConfig.profileChartSettings.elevationUnit,selectedLinearUnit:this.props.activeDatasourceConfig?U[1]:this.props.defaultConfig.profileChartSettings.linearUnit,selectedLayers:[],selectedIntersectedLayers:[],profileLayers:null===(r=this.props.activeDatasourceConfig)||void 0===r?void 0:r.profileSettings.layers,intersectingLayers:(null===(c=null===(h=null===(d=this.props.activeDatasourceConfig)||void 0===d?void 0:d.assetSettings)||void 0===h?void 0:h.layers)||void 0===c?void 0:c.length)>0?null===(p=null===(u=this.props.activeDatasourceConfig)||void 0===u?void 0:u.assetSettings)||void 0===p?void 0:p.layers:[],isAnyProfileLineLayers:!1,isAnyIntersectingLayers:!1,isProfileSettingsOptionEnabled:null===(g=this.props.activeDatasourceConfig)||void 0===g?void 0:g.profileSettings.isProfileSettingsEnabled,isCustomizeOptionEnabled:null===(v=this.props.activeDatasourceConfig)||void 0===v?void 0:v.profileSettings.isCustomizeOptionEnabled,isAssetSettingsOptionEnabled:null===(m=null===(f=this.props.activeDatasourceConfig)||void 0===f?void 0:f.assetSettings)||void 0===m?void 0:m.isAssetSettingsEnabled,noFeaturesError:this.props.noFeaturesFoundError,dismissInfoMsg:this.props.selectMode&&this.props.isNewSegmentsForSelection||this.props.drawMode&&!this.props.onDrawingComplete,dismissWarningMsg:!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection&&this.props.selectMode,statisticsOpen:!1,legendStats:[],showLegend:null===(y=this.props.commonDsGeneralSettings)||void 0===y?void 0:y.showLegend,displayStats:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.displayStatistics:this.props.defaultConfig.profileChartSettings.displayStatistics,selectedStatisticsList:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.selectedStatistics:this.props.defaultConfig.profileChartSettings.selectedStatistics,renderSeries:!0,toggledSeriesName:"",isUniformScalingEnable:!1,isLayerSelected:!0,isBufferSelectorEnableInConfig:null===(w=null===(b=null===(S=this.props.activeDatasourceConfig)||void 0===S?void 0:S.assetSettings)||void 0===b?void 0:b.assetIntersectingBuffer)||void 0===w?void 0:w.enabled,isBufferSelectorEnableAtRuntime:null===(C=null===(I=null===(L=this.props.activeDatasourceConfig)||void 0===L?void 0:L.assetSettings)||void 0===I?void 0:I.assetIntersectingBuffer)||void 0===C?void 0:C.enabled,selectedBufferDistance:(null===(O=null===(E=null===(A=this.props.activeDatasourceConfig)||void 0===A?void 0:A.assetSettings)||void 0===E?void 0:E.assetIntersectingBuffer)||void 0===O?void 0:O.bufferDistance)||10,selectedBufferUnit:N||P(re),selectedBufferSymbol:null===(R=null===(j=null===(V=this.props.activeDatasourceConfig)||void 0===V?void 0:V.assetSettings)||void 0===j?void 0:j.assetIntersectingBuffer)||void 0===R?void 0:R.bufferSymbol,noValidInput:this.props.viewModelErrorState,viewModelErrorMsg:this.props.profileErrorMsg,isExport:!1,isCustomizeInterval:!1,allowExport:null===(k=this.props.commonDsGeneralSettings)||void 0===k?void 0:k.allowExport,exportData:!1,showViewLineGraph:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.showVolumetricObjLineInGraph:this.props.defaultConfig.profileChartSettings.showVolumetricObjLineInGraph,volumetricObjLineColor:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.volumetricObjLineColor:this.props.defaultConfig.profileChartSettings.volumetricObjLineColor,volumetricObjLabel:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.volumetricObjLabel:this.props.defaultConfig.profileChartSettings.volumetricObjLabel,distanceInterval:1,showInValidIntervalErrorMsg:!1,getIntervalsError:""},this.selectableLayers=[],this.intersectingLayers=[]}render(){var s,o,n;let l="",r="",d="";this.state.initialEmptyState&&this.props.drawMode||this.state.emptyStateIfDoneClick&&this.props.drawMode?l=this.nls("drawUserInfo"):(this.state.initialEmptyState&&this.props.selectMode||this.state.emptyStateIfDoneClick&&this.props.selectMode)&&(l=this.nls("selectUserInfo")),this.state.emptyStateIfDoneClick&&this.props.drawMode?r=this.nls("emptyDrawStateWarning"):this.state.emptyStateIfDoneClick&&this.props.selectMode&&(r=this.nls("emptySelectStateWarning")),this.props.drawMode&&this.props.chartRender?d=this.nls("infoMsgWhileDrawing"):this.props.selectMode&&this.props.chartRender&&(d=this.props.isNewSegmentsForSelection&&this.props.noGraphicAfterFirstSelection?this.nls("infoMsgWhileSelecting"):this.nls("addToSelectionWarning"));const h=this.nls("noFeaturesFound"),c=this.settingsOptionsRender(),u=this.statisticsDisplay(),p=this.exportOptionDisplay();return(0,t.jsx)("div",{className:"h-100 w-100",css:a(this.props.theme)},(0,t.jsx)("div",{style:{height:35},className:"ep-widget-header d-flex w-100"},(0,t.jsx)("div",{className:"align-items-center w-100 pt-1",style:{display:"inline-block"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("settingsOptions"),"aria-haspopup":"dialog",title:this.nls("settingsOptions"),icon:!0,id:"settingsOptions"+this.props.widgetId,className:"chart-actions",active:this.state.settingsOptionsOpen,size:"sm",type:"default",onClick:this.toggleSettings},(0,t.jsx)(i.Icon,{size:16,icon:le.settingsIcon})),this.state.allowExport&&this.props.chartRender&&(this.props.drawMode&&this.props.onDrawingComplete||this.props.selectMode)&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartExport"),"aria-haspopup":"dialog",title:this.nls("chartExport"),icon:!0,id:"export"+this.props.widgetId,className:"chart-actions",active:this.state.isExport,size:"sm",type:"default",onClick:this.toggleExport},(0,t.jsx)(i.Icon,{size:16,icon:ae()})),this.props.chartRender&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartFlip"),title:this.nls("chartFlip"),icon:!0,className:"chart-actions",active:this.state.isFlipChart,size:"sm",type:"default",onClick:this.onChartFlip},(0,t.jsx)(i.Icon,{size:16,icon:le.flipIcon})),this.state.displayStats&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartStatistics"),"aria-haspopup":"dialog",title:this.nls("chartStatistics"),icon:!0,id:"statistics"+this.props.widgetId,className:"chart-actions",active:this.state.statisticsOpen,size:"sm",type:"default",onClick:this.toggleStatistics},(0,t.jsx)(i.Icon,{size:16,icon:le.chartIcon}))),this.state.settingsOptionsOpen&&c,this.state.isExport&&p,this.state.statisticsOpen&&u)),(0,t.jsx)("div",{className:(0,t.classNames)("ep-widget-bodyContainer d-flex w-100",this.props.chartRender?"":"align-items-center")},(0,t.jsx)("div",{className:(0,t.classNames)("w-100",this.props.chartRender?"":"alignInfo align-items-center",this.props.noFeaturesFoundError?"alignInfo align-items-center":"")},!this.props.displayLoadingIndicator&&(0,t.jsx)(t.React.Fragment,null,!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput&&(0,t.jsx)("div",{tabIndex:0,ref:this.alertElement,"aria-label":l},(0,t.jsx)(i.Alert,{className:"mb-4 w-100 userInfo",onClose:function(){},open:!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput,text:l,type:"info",withIcon:!0})),this.state.emptyStateIfDoneClick&&!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){},open:this.state.emptyStateIfDoneClick&&!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput,text:r,type:"warning",withIcon:!0}),this.state.noFeaturesError&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){},open:this.state.noFeaturesError,text:h,type:"warning",withIcon:!0}),this.state.noValidInput&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){},open:this.state.noValidInput,text:this.state.viewModelErrorMsg,type:"warning",withIcon:!0})),(this.props.chartRender||this.state.exportData)&&(0,t.jsx)(ie,{ref:"chartObj",intl:this.props.intl,isExportEnable:this.state.exportData,parentWidgetId:this.props.widgetId,commonGeneralSettings:this.props.commonDsGeneralSettings,activeDs:this.props.activeDataSource,currentConfig:this.props.activeDatasourceConfig,theme:this.props.theme,selectedLinearUnit:this.state.selectedLinearUnit,selectedElevationUnit:this.state.selectedElevationUnit,showVolumetricObj:this.state.showViewLineGraph,volumetricObjLineColor:this.state.volumetricObjLineColor,volumetricObjLabel:this.state.volumetricObjLabel,chartDataUpdateTime:this.props.chartDataUpdateTime,profileResult:this.props.profileResult,unitOptions:this.state.unitOptions,highlightChartPositionOnMap:this.highlightChartPosition.bind(this),hideChartPosition:this.hideChartPosition.bind(this),chartInfo:this.getChartInfo.bind(this),toggleLegendSeriesState:this.onToggleSeries,elevationGraphColor:this.props.chartColorRender,isFlip:this.state.isFlipChart,isUniformChartScalingEnable:this.state.isUniformScalingEnable,drawingLayer:this.props.drawingLayer,intersectionHighlightLayer:this.props.intersectionHighlightLayer,mapView:this.props.jimuMapView,assetIntersectionResult:this.props.intersectionResult,setExportButton:this.setExportButtonState,isCustomIntervalEnabled:this.state.isCustomizeInterval,customDistanceInterval:this.state.distanceInterval})),this.props.displayLoadingIndicator&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Loading,{type:i.LoadingType.Donut}))),(0,t.jsx)("div",{className:"floatingInfoMsg"},!this.state.enableForNewProfile&&this.props.chartRender&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{title:d},(0,t.jsx)(i.Alert,{tabIndex:0,className:(0,t.classNames)("alignDismissibleInfo",this.state.dismissInfoMsg?"showMessage":"hideMessage"),onClose:this.dismissInfoMsg,open:this.state.dismissInfoMsg,text:d,type:"info",withIcon:!0,closable:!0})),(0,t.jsx)("div",{title:d},(0,t.jsx)(i.Alert,{tabIndex:0,className:(0,t.classNames)("alignDismissibleInfo",this.state.dismissWarningMsg?"showMessage":"hideMessage"),onClose:this.dismissWarningMsg,open:this.state.dismissWarningMsg,text:d,type:"warning",withIcon:!0,closable:!0})))),(0,t.jsx)("div",{className:"ep-widget-footer"},(0,t.jsx)("div",{className:"w-100 footer-display"},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("backButtonLabel"),title:this.nls("backButtonLabel"),className:"m-1 text-break",size:"default",type:"tertiary",onClick:this.props.onNavBack},(0,t.jsx)(i.Icon,{size:16,autoFlip:!0,icon:le.arrowNavBack}),this.nls("backButtonLabel")),(null===(s=this.props.commonDsGeneralSettings)||void 0===s?void 0:s.buttonStyle)===e.IconText&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("doneButtonLabel"),title:this.nls("doneButtonLabel"),className:this.state.enableForNewProfile||this.props.onDrawingComplete||this.state.noValidInput||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection?"hidden":"m-1 actionButton text-break",size:"default",type:"primary",onClick:this.onDoneClick},(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:16,icon:le.doneIcon}),this.nls("doneButtonLabel"))),this.props.chartRender&&(null===(o=this.props.commonDsGeneralSettings)||void 0===o?void 0:o.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("clearButtonLabel"),title:this.nls("clearButtonLabel"),className:this.state.enableForNewProfile||this.props.onDrawingComplete||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection?"hidden":"m-1 actionButton text-break",size:"default",type:"default",onClick:this.onClearButtonClick},(0,t.jsx)(i.Icon,{size:16,icon:le.clearIcon}),this.nls("clearButtonLabel"))),(this.state.enableForNewProfile||this.props.onDrawingComplete||this.state.noValidInput||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection)&&(null===(n=this.props.commonDsGeneralSettings)||void 0===n?void 0:n.buttonStyle)===e.IconText&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("newProfileButtonLabel"),title:this.nls("newProfileButtonLabel"),className:"m-1 actionButton text-break",size:"default",type:"primary",onClick:this.onNewProfileClick},(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:16,icon:this.props.drawMode?le.drawIcon:le.selectIcon}),this.nls("newProfileButtonLabel"))))))}}var he=C(10624),ce=C(59620),ue=C(33420),pe=C(86392),ge=C(62243),ve=C(79282),fe=C(8968),me=C(85633),ye=C(7343);class Se extends t.WidgetVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.15.0",description:"Upgrade output data source json and use data sources",upgradeFullInfo:!0,upgrader:e=>{var t;const i=e.outputDataSourceJsons,s=e.widgetJson.config.configInfo,o=e.widgetJson.set("useDataSources",(e=>{var t,i,s;let o=[];for(const n in e)(null===(t=e[n].profileSettings.layers)||void 0===t?void 0:t.length)>0&&(o=O(n,e[n].profileSettings.layers,o)),(null===(s=null===(i=e[n].assetSettings)||void 0===i?void 0:i.layers)||void 0===s?void 0:s.length)>0&&(o=O(n,e[n].assetSettings.layers,o));return o})(s)),n=Object.assign(Object.assign({},e),{widgetJson:o});let a=n;return null===(t=n.widgetJson.outputDataSources)||void 0===t||t.forEach((e=>{let t=i[e];t=t.set("geometryType","esriGeometryPolyline");const s=i.set(e,t);a=Object.assign(Object.assign({},n),{outputDataSourceJsons:s})})),a}}]}}const xe=new Se;var be=function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function a(e){try{r(s.next(e))}catch(e){n(e)}}function l(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}r((s=s.apply(e,t||[])).next())}))};const{epIcon:we}=S(),Le={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18};class Ie extends t.BaseWidget{constructor(s){var o,n,a,r,d,h;super(s),this.resultsAfterIntersectionTimeout=null,this.nls=e=>{const t=Object.assign({},l,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.createDrawingLayers=()=>{this.drawingLayer=new ce.default({listMode:"hide",effect:"bloom(0.8, 1px, 0)"}),this.nextPossibleSelectionLayer=new ce.default({listMode:"hide",effect:"bloom(0.8, 0px, 1%)"}),this.bufferLayer=new ce.default({listMode:"hide"}),this.intersectionHighlightLayer=new ce.default({listMode:"hide",effect:"bloom(0.8, 1px, 0)"})},this.componentDidMount=()=>{this.setState({chartColorRender:this.state.groundColor,noFeaturesError:!1,viewModelErrorState:!1})},this.waitForChildDataSourcesReady=e=>be(this,void 0,void 0,(function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const i=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==i?void 0:i.isDataSourceSet)&&!i.areChildDataSourcesCreated()&&(yield i.childDataSourcesReady()),Promise.resolve(i)})),this.loadConfiguredDataSources=e=>{var i,s,o,n,a,l,r,d,h,c;const u=t.DataSourceManager.getInstance().getDataSource(e),p=[],g=[];return null===(a=null===(n=null===(o=null===(s=null===(i=this.props.config)||void 0===i?void 0:i.configInfo)||void 0===s?void 0:s[e])||void 0===o?void 0:o.profileSettings)||void 0===n?void 0:n.layers)||void 0===a||a.forEach((e=>be(this,void 0,void 0,(function*(){!g.includes(e.layerId)&&g.push(e.layerId)})))),null===(c=null===(h=null===(d=null===(r=null===(l=this.props.config)||void 0===l?void 0:l.configInfo)||void 0===r?void 0:r[e])||void 0===d?void 0:d.assetSettings)||void 0===h?void 0:h.layers)||void 0===c||c.forEach((e=>be(this,void 0,void 0,(function*(){!g.includes(e.layerId)&&g.push(e.layerId)})))),g.forEach((e=>{p.push(new Promise(((t,i)=>{try{null==u||u.createDataSourceById(e).then((e=>{t(e)}),(()=>{t(null)}))}catch(e){t(null)}})))})),p},this.getSelectedFeatureRecords=e=>{let t=[];const i=D(e);null==i||i.forEach((e=>be(this,void 0,void 0,(function*(){var i,s,o,n;if(yield e.ready(),e.getSelectedRecords().length>0){t=e.getSelectedRecords();let a=!1;const l=null===(i=null==t?void 0:t[0])||void 0===i?void 0:i.dataSource.getMainDataSource().id;if((null==t?void 0:t[0].feature)&&(this.getSelectableLayers(this.state.currentDatasource),"polyline"===(null===(o=null===(s=null==t?void 0:t[0].feature)||void 0===s?void 0:s.geometry)||void 0===o?void 0:o.type)&&this.selectableLayersAtRuntime.includes(l)&&(a=!0)),a)return this.displayFeaturesResult(l,[null===(n=null==t?void 0:t[0])||void 0===n?void 0:n.feature]),!0}}))))},this.onDataSourceInfoChange=e=>{var i,s;if(null===(i=null==e?void 0:e.selectedIds)||void 0===i?void 0:i.length){let e=[];e=t.DataSourceManager.getInstance().getDataSource(this.state.dsToGetSelectedOnLoad).getSelectedRecords(),this.displayFeaturesResult(this.state.dsToGetSelectedOnLoad,[null===(s=null==e?void 0:e[0])||void 0===s?void 0:s.feature]),this.setState({dsToGetSelectedOnLoad:""})}},this.getSelectedFeatureOnLoad=()=>{var e,i,s;const o=t.UrlManager.getInstance(),n=t.urlUtils.getDataSourceInfosFromUrlParmas(o.getQueryObject(),o.getHashObject());for(const t in n)if(this.selectableLayersAtRuntime.includes(t)){const o=null===(e=n[t])||void 0===e?void 0:e.selection;if((null===(i=null==o?void 0:o.ids)||void 0===i?void 0:i.length)||(null===(s=null==o?void 0:o.queryParams)||void 0===s?void 0:s.geometry)){this.setState({dsToGetSelectedOnLoad:t});break}}},this.activeViewChangeHandler=e=>be(this,void 0,void 0,(function*(){var i,s,o,n,a;if(e&&e.view){this.mapView=e,this.state.jimuMapView&&(this.state.currentSketchVM&&!this.state.currentSketchVM.destroyed&&this.state.currentSketchVM.destroy(),this.clearAll(),this.setState({initialStage:!0,resultStage:!1,drawModeActive:null===(i=this.props.config.generalSettings)||void 0===i?void 0:i.isDrawToolActive,selectModeActive:null===(s=this.props.config.generalSettings)||void 0===s?void 0:s.isSelectToolActive}),this.destroyDrawingLayers(),this.createDrawingLayers()),this.setState({onWidgetLoadShowLoadingIndicator:!0,layersLoaded:!1});try{(null===(a=null===(n=null===(o=this.props.config)||void 0===o?void 0:o.configInfo)||void 0===n?void 0:n[null==e?void 0:e.dataSourceId])||void 0===a?void 0:a.profileSettings.isCustomizeOptionEnabled)?yield Promise.all(this.loadConfiguredDataSources(e.dataSourceId)):yield this.waitForChildDataSourcesReady(this.mapView)}catch(e){console.error(e)}this.setState({onWidgetLoadShowLoadingIndicator:!1,layersLoaded:!0}),e&&this.setState({jimuMapView:e},(()=>{if(""===e.dataSourceId)this.setState({currentDatasource:"default"},(()=>{this.activeCurrentDs=this.state.currentDatasource,this.selectedUnit=M(this.props.config.configInfo[this.state.currentDatasource],this.props.portalSelf),this.getSelectableLayers(this.state.currentDatasource)}));else if(this.state.jimuMapView.dataSourceId===this.props.config.activeDataSource&&this.props.config.configInfo[this.props.config.activeDataSource]){if(this.props.config.activeDataSource&&this.props.config.configInfo[this.props.config.activeDataSource]){let e=this.props.config.activeDataSource;this.state.jimuMapView&&this.state.jimuMapView.dataSourceId&&(e=this.props.config.configInfo.hasOwnProperty(this.state.jimuMapView.dataSourceId)?this.state.jimuMapView.dataSourceId:"default",this.setState({currentDatasource:e},(()=>{this.activeCurrentDs=this.state.currentDatasource,"default"!==this.state.currentDatasource&&this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setConfigForDataSources(),this.getSelectableLayers(this.state.currentDatasource)})))}}else this.setState({currentDatasource:this.state.jimuMapView.dataSourceId},(()=>{this.getSelectableLayers(this.state.currentDatasource)})),this.checkLineLayerAvailableInDsAndConfig(this.state.jimuMapView.dataSourceId);setTimeout((()=>{const i={mode:"3d"===this.state.jimuMapView.view.type?"relative-to-ground":"on-the-ground",offset:null};this.drawingLayer.set("elevationInfo",i),this.nextPossibleSelectionLayer.set("elevationInfo",i),this.state.jimuMapView.view.map.addMany([this.bufferLayer,this.nextPossibleSelectionLayer,this.drawingLayer,this.intersectionHighlightLayer]),this.createApiWidget(e),this.createEpViewModel(e);const s=(0,t.getAppStore)().getState().widgetsRuntimeInfo[this.props.id].state;s!==t.WidgetState.Opened&&s||this.loadSelectDrawToolOnLoad(this.activeCurrentDs),this.getSelectedFeatureOnLoad()}),100)}))}else this.setState({initialStage:!1,resultStage:!1})})),this.loadSelectDrawToolOnLoad=e=>{if("default"===e)this.state.drawModeActive&&this.manageActiveDrawSelect();else if(this.state.drawModeActive||this.state.selectModeActive){if(this.state.lineLayersNotFound&&this.state.selectModeActive)return;this.manageActiveDrawSelect()}else this.setState({resultStage:!1,initialStage:!0})},this.manageActiveDrawSelect=()=>{this.setState({resultStage:!0,initialStage:!1},(()=>{this.clearAll(!0),this._displayDefaultCursor(),this.activateDrawOrSelectTool()}))},this.checkLineLayerAvailableInDsAndConfig=e=>{var t;const i=D(e);let s=!0;null==i||i.forEach((e=>{e&&e.getLayerDefinition()&&e.getLayerDefinition().geometryType&&"esriGeometryPolyline"===e.getLayerDefinition().geometryType&&(s=!1)})),e&&this.props.config.configInfo[e]&&this.canShowSelectAndDrawOptions(this.props.config.configInfo[e])?this.canShowProfilingForBackward(this.props.config.configInfo[e])&&0===(null===(t=this.props.config.configInfo[e])||void 0===t?void 0:t.profileSettings.layers.length)&&(s=!0):s=!0,this.setState({lineLayersNotFound:s})},this.setConfigForDataSources=()=>{var e,t,i,s,o;const n=this.props.config.configInfo[this.state.currentDatasource];this.setState({groundColor:n?null===(e=n.profileChartSettings)||void 0===e?void 0:e.groundColor:this.defaultConfig.profileChartSettings.groundColor,graphicsHighlightColor:n?null===(t=n.profileChartSettings)||void 0===t?void 0:t.graphicsHighlightColor:this.defaultConfig.profileChartSettings.graphicsHighlightColor,chartColorRender:n?null===(i=n.profileChartSettings)||void 0===i?void 0:i.groundColor:this.defaultConfig.profileChartSettings.groundColor,customElevationLayer:n?null===(s=n.profileChartSettings)||void 0===s?void 0:s.isCustomElevationLayer:this.defaultConfig.profileChartSettings.isCustomElevationLayer,elevationLayer:n?null===(o=n.profileChartSettings)||void 0===o?void 0:o.elevationLayerURL:this.defaultConfig.profileChartSettings.elevationLayerURL,selectedLinearUnit:n?this.selectedUnit[1]:this.defaultConfig.profileChartSettings.linearUnit,selectedElevationUnit:n?this.selectedUnit[0]:this.defaultConfig.profileChartSettings.elevationUnit})},this.createDefaultConfigForDataSource=()=>{let e="",t="";return e=P(this.props.portalSelf),t=(e=>"english"===(null==e?void 0:e.units)?"miles":"kilometers")(this.props.portalSelf),{profileChartSettings:{isCustomElevationLayer:!0,elevationLayerURL:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",linearUnit:t,elevationUnit:e,displayStatistics:!0,selectedStatistics:b,groundColor:"#b54900",graphicsHighlightColor:"#b54900",showVolumetricObjLineInGraph:!1,volumetricObjLineColor:"#cf4ccf",volumetricObjLabel:this.nls("volumetricObj")}}},this.canShowProfilingForBackward=e=>{var t,i,s,o;let n=!1;return e&&((null==e?void 0:e.hasOwnProperty("advanceOptions"))||(null===(t=null==e?void 0:e.profileSettings)||void 0===t?void 0:t.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(i=null==e?void 0:e.profileSettings)||void 0===i?void 0:i.hasOwnProperty("isCustomizeOptionEnabled")))&&((null==e?void 0:e.advanceOptions)||(null===(s=null==e?void 0:e.profileSettings)||void 0===s?void 0:s.isProfileSettingsEnabled)&&(null===(o=null==e?void 0:e.profileSettings)||void 0===o?void 0:o.isCustomizeOptionEnabled))&&(n=!0),n},this.canShowSelectAndDrawOptions=e=>{var t;let i=!0;return(null===(t=null==e?void 0:e.profileSettings)||void 0===t?void 0:t.hasOwnProperty("isProfileSettingsEnabled"))&&(i=e.profileSettings.isProfileSettingsEnabled),i},this.createApiWidget=e=>{var i,s;const o=new he.default({view:e?e.view:null,layer:new ce.default,updateOnGraphicClick:!1,defaultCreateOptions:{mode:"click",hasZ:"3d"===(null===(i=null==e?void 0:e.view)||void 0===i?void 0:i.type)},polylineSymbol:{type:"simple-line",color:this.state.graphicsHighlightColor,width:5},pointSymbol:fe.default.fromJSON(Le),defaultUpdateOptions:{toggleToolOnClick:!1}});o.on("create",(i=>{if("start"===i.state){const e={type:"simple-line",color:this.state.graphicsHighlightColor,width:5};this.state.currentSketchVM.set("polylineSymbol",e)}else if("complete"===i.state&&(this.setState({noFeaturesError:!1}),this.state.selectModeActive)){this.setState({loadingIndicator:!0});const s={returnAllFields:!0,returnFullGeometry:!0};e.selectFeaturesByGraphic(i.graphic,"intersects",t.DataSourceSelectionMode.New,s).then((e=>{var t;const i=Object.values(this.state.jimuMapView.jimuLayerViews),s={};for(let o=0;o<i.length;o++)if((null===(t=e[i[o].id])||void 0===t?void 0:t.length)>0){s[i[o].getLayerDataSource().id]=e[i[o].id]}this.queryForNewSelection(s,!0)}),(e=>{const t=this.getErrorMsgState(w.UnknownError);this.setState({loadingIndicator:!1,viewModelErrorState:t[0],profileErrorMsg:t[1]})}))}})),this.setState({currentSketchVM:o}),null===(s=null==e?void 0:e.view)||void 0===s||s.on("click",(t=>{const i=this.nextPossibleSelectionLayer;this.state.addToSelectionTool&&(t.stopPropagation(),e.view.hitTest(t).then((e=>{if(e&&e.results){const t=e.results.filter((e=>"graphic"===e.type)).filter((e=>e.graphic.layer===i&&"polyline"===e.graphic.geometry.type));t&&t.length>0&&(this.clearChart(),this.newFeatureSelection=!1,this.mapView.clearSelectedFeatures(),this.selectFeatureForProfiling(t[0].graphic))}})))}))},this.createEpViewModel=(e,t)=>{var i;const s=[];this._defaultViewModel&&(this._defaultViewModel.profiles=s),this.state.customElevationLayer?s.push({type:"query",source:new ve.default({url:this.state.elevationLayer}),color:this.state.groundColor}):s.push({type:"ground",color:this.state.groundColor});const o=this.checkForVolumetricObjects(e.view.type);if(o&&s.push(o),"3d"===e.view.type&&s.push({type:"input",color:this.state.graphicsHighlightColor}),this._defaultViewModel&&t){if(t&&(this._defaultViewModel.view=e.view,this._defaultViewModel.profiles=s,null===(i=this._defaultViewModel.input)||void 0===i?void 0:i.geometry)){const e=new AbortController;this.setState({loadingIndicator:!0}),ge.default.whenOnce((()=>1===this._defaultViewModel.progress),e.signal).then((()=>be(this,void 0,void 0,(function*(){var t,i,s;const o=null===(s=null===(i=null===(t=this._defaultViewModel)||void 0===t?void 0:t.chartData)||void 0===i?void 0:i.lines)||void 0===s?void 0:s.find((e=>"ground"===e.type||"query"===e.type));this._defaultViewModel.chartData&&o?(yield new Promise((e=>setTimeout(e,500))),this.onChartDataReady(e.signal)):this.onErrorInChartData(!0,this.nls("noProfileError"))}))))}}else this._defaultViewModel=new pe.default({view:e?e.view:null,profiles:s});const n=this._defaultViewModel;null===ge.default||void 0===ge.default||ge.default.watch((()=>n.errorState),(e=>{var t;const i=this.getErrorMsgState(e);0!==(null==i?void 0:i.length)&&i&&(null===(t=this._abortController)||void 0===t||t.abort(),this.onErrorInChartData(i[0],i[1]))}),{initial:!0}),null===ge.default||void 0===ge.default||ge.default.watch((()=>{var e;return null===(e=n.input)||void 0===e?void 0:e.geometry}),(()=>be(this,void 0,void 0,(function*(){var e,t,i,s;if(n.input)try{null===(e=this._abortController)||void 0===e||e.abort();const{signal:o}=this._abortController=new AbortController;if(this.setState({loadingIndicator:!0,onDrawingComplete:"created"===this._defaultViewModel.state}),yield ge.default.whenOnce((()=>1===n.progress),o),o.aborted)return;if(yield new Promise((e=>setTimeout(e,1500))),this._defaultViewModel.chartData){if(!(null===(s=null===(i=null===(t=this._defaultViewModel)||void 0===t?void 0:t.chartData)||void 0===i?void 0:i.lines)||void 0===s?void 0:s.find((e=>"ground"===e.type||"query"===e.type))))return void this.onErrorInChartData(!0,this.nls("noProfileError"));yield new Promise((e=>setTimeout(e,500))),yield this.onChartDataReady(o)}else this.onErrorInChartData(!0,this.state.profileErrorMsg)}catch(e){if(!ye.default.isAbortError(e))throw e}}))))},this.checkForVolumetricObjects=e=>{var t,i,s,o;return"3d"===e&&(null===(i=null===(t=this.props.config.configInfo[this.state.currentDatasource])||void 0===t?void 0:t.profileChartSettings)||void 0===i?void 0:i.showVolumetricObjLineInGraph)?{type:"view",color:null===(o=null===(s=this.props.config.configInfo[this.state.currentDatasource])||void 0===s?void 0:s.profileChartSettings)||void 0===o?void 0:o.volumetricObjLineColor}:null},this.onChartDataReady=e=>be(this,void 0,void 0,(function*(){if(this.state.drawModeActive||this.state.selectModeActive){const t=yield this.createBufferGraphics(!0);if(e.aborted)return;this.setState({intersectionResult:t,viewModelErrorState:!1,profileResult:this._defaultViewModel.chartData,chartDataUpdateTime:Date.now()},(()=>be(this,void 0,void 0,(function*(){yield new Promise((e=>setTimeout(e,500))),this.setState({loadingIndicator:!1,startChartRendering:!0})}))))}})),this.onErrorInChartData=(e,t)=>{this.setState({loadingIndicator:!1,viewModelErrorState:e,profileErrorMsg:t||this.nls("unknownError"),startChartRendering:!1,profileResult:null,chartDataUpdateTime:Date.now()})},this.createBufferGraphics=e=>be(this,void 0,void 0,(function*(){return new Promise((i=>{var s,o,n;if(this.bufferGraphics=null,this.selectedBufferValues)if(null===(s=this._defaultViewModel)||void 0===s?void 0:s.input)if(this.selectedBufferValues.enabled&&this.selectedBufferValues.bufferDistance>0){let s=this._defaultViewModel.input.geometry.clone?this._defaultViewModel.input.geometry.clone():this._defaultViewModel.input.geometry;N.default&&!N.default.isSimple(s)&&(s=N.default.simplify(s)),t.geometryUtils.createBuffer(s,[this.selectedBufferValues.bufferDistance],this.selectedBufferValues.bufferUnits).then((t=>{var s,o;const n=Array.isArray(t)?t[0]:t,a=new H.default({geometry:n,symbol:null===fe.default||void 0===fe.default?void 0:fe.default.fromJSON(this.selectedBufferValues.bufferSymbol)});this.bufferGraphics=a,a&&this.bufferGraphics&&(null===(s=this.bufferLayer)||void 0===s||s.removeAll(),null===(o=this.bufferLayer)||void 0===o||o.add(a)),this.checkForIntersectingLayer(e).then((e=>{i(e)}))}))}else null===(o=this.bufferLayer)||void 0===o||o.removeAll(),this.checkForIntersectingLayer(e).then((e=>{i(e)}));else null===(n=this.bufferLayer)||void 0===n||n.removeAll(),e||this.setState({intersectionResult:[]}),i([]);else i([])}))})),this.onBufferChange=e=>{this.selectedBufferValues=e,this.createBufferGraphics()},this.getErrorMsgState=e=>{switch(e){case w.TooComplex:return[!0,this.nls("tooComplexError")];case w.InvalidGeometry:return[!0,this.nls("invalidGeometryError")];case w.InvalidElevationInfo:return[!0,this.nls("invalidElevationInfoError")];case w.UnknownError:return[!0,this.nls("unknownError")];case w.NoVisibleProfiles:case w.RefinedButNoChartData:return[!0,this.nls("noProfileError")];case w.None:return[]}},this.getSelectableLayers=e=>{const t=D(e),i=[],s=this.canShowSelectAndDrawOptions(this.props.config.configInfo[e])&&this.canShowProfilingForBackward(this.props.config.configInfo[e]);null==t||t.forEach((t=>{var o,n,a,l,r,d,h,c,u,p,g;const v=t;v&&v.layerDefinition&&v.layerDefinition.geometryType&&((null===(o=this.props.config.configInfo[e])||void 0===o?void 0:o.hasOwnProperty("advanceOptions"))||(null===(a=null===(n=this.props.config.configInfo[e])||void 0===n?void 0:n.profileSettings)||void 0===a?void 0:a.hasOwnProperty("isProfileSettingsEnabled")))&&((null===(l=this.props.config.configInfo[e])||void 0===l?void 0:l.hasOwnProperty("advanceOptions"))||(null===(d=null===(r=this.props.config.configInfo[e])||void 0===r?void 0:r.profileSettings)||void 0===d?void 0:d.isProfileSettingsEnabled))&&(((null===(h=this.props.config.configInfo[e])||void 0===h?void 0:h.advanceOptions)||(null===(u=null===(c=this.props.config.configInfo[e])||void 0===c?void 0:c.profileSettings)||void 0===u?void 0:u.isProfileSettingsEnabled))&&s?"esriGeometryPolyline"===v.layerDefinition.geometryType&&(null===(g=null===(p=this.props.config.configInfo[e])||void 0===p?void 0:p.profileSettings.layers)||void 0===g||g.forEach((e=>{e.layerId===t.id&&i.push(t.id)}))):"esriGeometryPolyline"===v.layerDefinition.geometryType&&i.push(t.id))})),this.selectableLayersAtRuntime=i},this.getValidFeatureRecord=e=>{let t=null;return e.some((e=>{var i,s,o,n,a,l;let r=null;if((null===(s=null===(i=null==e?void 0:e.feature)||void 0===i?void 0:i.layer)||void 0===s?void 0:s.id)?r=e.feature.layer.id:(null===(n=null===(o=null==e?void 0:e.dataSource)||void 0===o?void 0:o.layer)||void 0===n?void 0:n.id)&&(r=e.dataSource.layer.id),r&&"polyline"===(null===(l=null===(a=e.feature)||void 0===a?void 0:a.geometry)||void 0===l?void 0:l.type)){const i=this.getDSLayerID(r);if(this.isSelectableLayersChangedAtRuntime||this.getSelectableLayers(this.state.currentDatasource),this.selectableLayersAtRuntime.includes(i))return t={},t.record=e,t.dsLayerId=i,!0}})),t},this.getDSLayerID=e=>{var t,i;let s="";if(null===(i=null===(t=this.state)||void 0===t?void 0:t.jimuMapView)||void 0===i?void 0:i.dataSourceId){const t=D(this.state.jimuMapView.dataSourceId);null==t||t.forEach((t=>{if(t.jimuChildId===e)return s=t.id,!0}))}return s},this.getOutfieldsForDs=e=>{let t=[];return this.props.useDataSources.forEach((i=>{i.dataSourceId===e.id&&i.fields&&(t=[...i.fields])})),t.includes(e.layer.objectIdField)||t.push(e.layer.objectIdField),t},this.getFeatureFromLayer=(e,i)=>be(this,void 0,void 0,(function*(){const s=t.DataSourceManager.getInstance().getDataSource(e),o={};return o.where=s.layer.objectIdField+" = "+i,o.outFields=this.getOutfieldsForDs(s),o.returnGeometry=!0,o.returnFullGeometry=!0,o.returnZ=!0,o.notAddFieldsToClient=!0,o.outSR=this.mapView.view.spatialReference.toJSON(),new Promise((e=>s.query(o).then((t=>{if((null==t?void 0:t.records.length)>0){let i;t.records.forEach((e=>(i=e.feature,null!=i?i:null))),e(i)}}))))})),this.displayFeaturesResult=(e,t)=>{var i;const s={};s[e]=t,this.setState({initialStage:!1,resultStage:!0,selectModeActive:!0,drawModeActive:!1,onDrawingComplete:!1,startChartRendering:!1,viewModelErrorState:!1}),this._defaultViewModel&&this._defaultViewModel.clear(),(this.state.drawModeActive||this.state.selectModeActive)&&(null===(i=this.state.currentSketchVM)||void 0===i||i.cancel()),this.hideChartPosition(),this.queryForNewSelection(s,!1)},this.componentDidUpdate=e=>{var i,s,o,n,a,l,r,d,h,c,u,p,g,v;const f=null===(n=null===(o=null===(s=null===(i=(0,t.getAppStore)())||void 0===i?void 0:i.getState())||void 0===s?void 0:s.widgetsRuntimeInfo)||void 0===o?void 0:o[this.props.id])||void 0===n?void 0:n.state;if(f===t.WidgetState.Opened||!f){const t=null===(a=this.props)||void 0===a?void 0:a.selectedFeatureRecords;if((null==t?void 0:t.length)>0&&(!e||!e.mutableStatePropsVersion||!e.mutableStatePropsVersion.selectedFeatureRecords||(null===(l=null==e?void 0:e.mutableStatePropsVersion)||void 0===l?void 0:l.selectedFeatureRecords)!==(null===(r=this.props.mutableStatePropsVersion)||void 0===r?void 0:r.selectedFeatureRecords))){const e=this.getValidFeatureRecord(t);if(!(null==e?void 0:e.record))return;this.getFeatureFromLayer(e.dsLayerId,e.record.getId()).then((t=>{this.displayFeaturesResult(e.dsLayerId,[t])}))}}if(this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Run?this.state.addToSelectionTool&&this._displayAddToSelectionCursor():this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Design&&this._displayDefaultCursor(),!this.mapView)return;if(e.useMapWidgetIds===this.props.useMapWidgetIds&&e.config.activeDataSource===this.props.config.activeDataSource||this.props.config.configInfo[this.props.config.activeDataSource]&&this.setState({currentDatasource:this.props.config.activeDataSource},(()=>{var e;this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.getSelectedFeatureRecords(null===(e=this.mapView)||void 0===e?void 0:e.dataSourceId),this.setState({customElevationLayer:this.props.config.configInfo[this.state.currentDatasource].profileChartSettings.isCustomElevationLayer,elevationLayer:this.props.config.configInfo[this.state.currentDatasource].profileChartSettings.elevationLayerURL})})),e.state!==this.props.state&&!this.state.profileResult&&(this.state.drawModeActive||this.state.selectModeActive)){const e=(0,t.getAppStore)().getState().widgetsRuntimeInfo[this.props.id].state;e!==t.WidgetState.Opened&&e||(this.loadSelectDrawToolOnLoad(this.activeCurrentDs),this.getSelectedFeatureRecords(null===(d=this.mapView)||void 0===d?void 0:d.dataSourceId))}const m=null===(h=this.props.config.configInfo)||void 0===h?void 0:h[this.state.currentDatasource],y=null===(c=e.config.configInfo)||void 0===c?void 0:c[this.state.currentDatasource];this.props.config.configInfo.hasOwnProperty(this.state.currentDatasource)&&(this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setConfigForDataSources()),(null==y?void 0:y.profileChartSettings.groundColor)===(null==m?void 0:m.profileChartSettings.groundColor)&&(null==y?void 0:y.profileChartSettings.graphicsHighlightColor)===(null==m?void 0:m.profileChartSettings.graphicsHighlightColor)||this.setState({groundColor:null==m?void 0:m.profileChartSettings.groundColor,graphicsHighlightColor:null==m?void 0:m.profileChartSettings.graphicsHighlightColor},(()=>{var e,t;if(this.setState({chartColorRender:this.state.groundColor}),this.drawingLayer&&this.drawingLayer.graphics.length>0){const e={type:"simple-line",color:this.state.graphicsHighlightColor,width:5};this.drawingLayer.graphics.items.forEach((t=>{t.symbol=e}))}this._defaultViewModel&&this.state.groundColor&&(null===(t=null===(e=this._defaultViewModel.profiles.getItemAt(0))||void 0===e?void 0:e.color)||void 0===t||t.setColor(this.state.groundColor))})),(null==y?void 0:y.profileChartSettings.elevationUnit)===(null==m?void 0:m.profileChartSettings.elevationUnit)&&(null==y?void 0:y.profileChartSettings.linearUnit)===(null==m?void 0:m.profileChartSettings.linearUnit)||this.setState({selectedLinearUnit:null==m?void 0:m.profileChartSettings.linearUnit,selectedElevationUnit:null==m?void 0:m.profileChartSettings.elevationUnit}),(null==y?void 0:y.profileChartSettings.elevationLayerURL)===(null==m?void 0:m.profileChartSettings.elevationLayerURL)&&(null==y?void 0:y.profileChartSettings.isCustomElevationLayer)===(null==m?void 0:m.profileChartSettings.isCustomElevationLayer)||m&&y&&this.setState({elevationLayer:null==m?void 0:m.profileChartSettings.elevationLayerURL},(()=>{this.state.initialStage||this.activateToolForNewProfile(),this.createEpViewModel(this.mapView)})),(this.didProfileLayersSettingsChanged(null==y?void 0:y.profileSettings.layers,null==m?void 0:m.profileSettings.layers)||this.checkForPrevCurrentAdvanceConfig(y,m,this.nls("selectableLayersLabel")))&&this.setState({profileLineLayers:null==m?void 0:m.profileSettings.layers},(()=>{var e;this.getSelectableLayers(this.state.currentDatasource);let t=!1;(null==m?void 0:m.profileSettings.isProfileSettingsEnabled)&&0===this.state.profileLineLayers.length&&!this.state.drawModeActive&&(!(null==m?void 0:m.profileSettings.isCustomizeOptionEnabled)&&!this.state.selectModeActive||(null==m?void 0:m.profileSettings.isCustomizeOptionEnabled)&&this.state.selectModeActive)&&(this.onBackClick(),t=!0),(null==m?void 0:m.profileSettings.isProfileSettingsEnabled)||this.state.drawModeActive||(this.onBackClick(),t=!0),(null===(e=null==m?void 0:m.assetSettings)||void 0===e?void 0:e.isAssetSettingsEnabled)?this.createBufferGraphics():this.bufferLayer&&this.bufferLayer.removeAll(),this.setState({lineLayersNotFound:t})})),(this.didIntersectingLayersSettingsChanged(null===(u=null==y?void 0:y.assetSettings)||void 0===u?void 0:u.layers,null===(p=null==m?void 0:m.assetSettings)||void 0===p?void 0:p.layers)||this.checkForPrevCurrentAdvanceConfig(y,m,this.nls("intersectingLayersLabel")))&&((null===(g=null==m?void 0:m.assetSettings)||void 0===g?void 0:g.isAssetSettingsEnabled)?this.createBufferGraphics():this.bufferLayer&&this.bufferLayer.removeAll()),(null==y?void 0:y.profileChartSettings.volumetricObjLineColor)===(null==m?void 0:m.profileChartSettings.volumetricObjLineColor)&&(null==y?void 0:y.profileChartSettings.showVolumetricObjLineInGraph)===(null==m?void 0:m.profileChartSettings.showVolumetricObjLineInGraph)||this._defaultViewModel&&"3d"===(null===(v=this.state.jimuMapView.view)||void 0===v?void 0:v.type)&&this.createEpViewModel(this.mapView,!0)},this.checkForPrevCurrentAdvanceConfig=(e,t,i)=>{var s,o,n,a,l,r,d,h;let c=!1;return i===this.nls("selectableLayersLabel")&&(!e||((null==e?void 0:e.hasOwnProperty("advanceOptions"))&&(null==e?void 0:e.advanceOptions))===((null==t?void 0:t.hasOwnProperty("advanceOptions"))&&(null==t?void 0:t.advanceOptions))&&((null==e?void 0:e.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(s=null==e?void 0:e.profileSettings)||void 0===s?void 0:s.isProfileSettingsEnabled))===((null==t?void 0:t.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(o=null==t?void 0:t.profileSettings)||void 0===o?void 0:o.isProfileSettingsEnabled))&&((null==e?void 0:e.profileSettings.hasOwnProperty("isCustomizeOptionEnabled"))&&(null===(n=null==e?void 0:e.profileSettings)||void 0===n?void 0:n.isCustomizeOptionEnabled))===((null==t?void 0:t.profileSettings.hasOwnProperty("isCustomizeOptionEnabled"))&&(null===(a=null==t?void 0:t.profileSettings)||void 0===a?void 0:a.isCustomizeOptionEnabled))||(c=!0)),i===this.nls("intersectingLayersLabel")&&e&&(((null==e?void 0:e.hasOwnProperty("advanceOptions"))&&(null==e?void 0:e.advanceOptions))!==((null==t?void 0:t.hasOwnProperty("advanceOptions"))&&(null==t?void 0:t.advanceOptions))||(null==e?void 0:e.hasOwnProperty("assetSettings"))&&((null===(l=null==e?void 0:e.assetSettings)||void 0===l?void 0:l.hasOwnProperty("isAssetSettingsEnabled"))&&(null===(r=null==e?void 0:e.assetSettings)||void 0===r?void 0:r.isAssetSettingsEnabled))!==((null===(d=null==t?void 0:t.assetSettings)||void 0===d?void 0:d.hasOwnProperty("isAssetSettingsEnabled"))&&(null===(h=null==t?void 0:t.assetSettings)||void 0===h?void 0:h.isAssetSettingsEnabled)))&&(c=!0),c},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.didIntersectingLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.componentWillUnmount=()=>{var e,t;this._defaultViewModel&&this._defaultViewModel.clear(),this.state.currentSketchVM&&(null===(e=this.state.currentSketchVM)||void 0===e||e.cancel()),this.destroyDrawingLayers(),this._displayDefaultCursor(),null===(t=this.mapView)||void 0===t||t.clearSelectedFeatures()},this.buildOutputStatistics=(e,t,i)=>{var s,o,n;this.buildStatsValuesAsOutput(null===(o=null===(s=this._defaultViewModel)||void 0===s?void 0:s.visibleProfiles)||void 0===o?void 0:o[0],null===(n=this.props.outputDataSources)||void 0===n?void 0:n[0],e,t,i)},this.getOutputDataSource=e=>t.DataSourceManager.getInstance().getDataSource(e),this.buildStatsValuesAsOutput=(e,s,o,n,a)=>{var l,r,d,h,c,u;if(!this.getOutputDataSource(s))return;const p=[];p.push({alias:"OBJECTID",type:"double",name:"OBJECTID"}),b.forEach((e=>{p.push({alias:this.nls(e.value).replace(/ /g,""),type:"string",name:e.value})}));const g={},v=this.outputStatisticsValueDisplay(e,o,n,a);g.OBJECTID=0,v.forEach(((e,t)=>{var i;g[null===(i=p[t+1])||void 0===i?void 0:i.name]=null==e?void 0:e.statValue}));const f=[];p.forEach((e=>{if(e.name){const t={fieldName:e.name,label:e.alias};f.push(t)}}));const m=p.length;b.forEach((e=>{p.push({alias:this.nls(e.value).replace(/ /g,""),type:"string",name:this.nls(e.value).replace(/ /g,"")})})),v.forEach(((e,t)=>{var i;g[null===(i=p[t+m])||void 0===i?void 0:i.name]=null==e?void 0:e.statValue}));const y=new H.default({attributes:g,geometry:null!==(d=null===(r=null===(l=this._defaultViewModel)||void 0===l?void 0:l.input)||void 0===r?void 0:r.geometry)&&void 0!==d?d:{type:"polyline",paths:[],spatialReference:{wkid:4326}}}),S=Object.assign({},i.defaultMessages),x=new me.default({id:s+"_layer",title:this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:S.outputStatistics},{name:this.props.label}),fields:p,geometryType:"polyline",source:[y],objectIdField:"OBJECTID",popupTemplate:{title:this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:S.outputStatistics},{name:this.props.label}),fieldInfos:f,content:[{type:"fields",fieldInfos:f}]}});this.getOutputDataSource(s).layer=x;const w=g?t.DataSourceStatus.Unloaded:t.DataSourceStatus.NotReady;null===(h=this.getOutputDataSource(s))||void 0===h||h.setStatus(w),null===(c=this.getOutputDataSource(s))||void 0===c||c.setCountStatus(w),null===(u=this.getOutputDataSource(s))||void 0===u||u.addSourceVersion()},this.outputStatisticsValueDisplay=(e,t,i,s)=>{const o=[];let n="",a=null,l="";return b.forEach((r=>{var d;l=r.value,(null==e?void 0:e.statistics)?(s&&l!==L.AvgElevation&&l!==L.MaxDistance&&l!==L.MaxElevation&&l!==L.MinElevation&&(l=I(l)),a=null===(d=null==e?void 0:e.statistics)||void 0===d?void 0:d[l],n=this.getStatsValueWithUnit(e,a,l,t,i)):n=this.nls("noStatsValue"),o.push({statName:r.value,statValue:n})})),o},this.getStatsValueWithUnit=(e,t,i,s,o)=>{let n="",a=null;return x.forEach((l=>{i===L.MaxDistance?l.value===o&&(a=T(t,null==e?void 0:e.effectiveUnits.distance,o),n=this.props.intl.formatNumber(a,{maximumFractionDigits:2})+" "+this.nls(l.abbreviation)):i===L.MaxPositiveSlope||i===L.MaxNegativeSlope||i===L.AvgPositiveSlope||i===L.AvgNegativeSlope?n=null===t?this.nls("noStatsValue"):this.props.intl.formatNumber(t,{maximumFractionDigits:2})+" \xb0":l.value===s&&(a=T(t,null==e?void 0:e.effectiveUnits.elevation,s),n=this.props.intl.formatNumber(a,{maximumFractionDigits:2})+" "+this.nls(l.abbreviation))})),n},this.queryForNewSelection=(e,i)=>{var s,o,n,a,l,r,d,h;let c=null;if(Object.keys(e).length>0)for(const t in e){const u=e[t];if(u.length>0&&"polyline"===(null===(s=u[0].geometry)||void 0===s?void 0:s.type)&&this.selectableLayersAtRuntime.includes(t)){if("3d"===this.state.jimuMapView.view.type&&(null===(n=null===(o=u[0])||void 0===o?void 0:o.layer)||void 0===n?void 0:n.elevationInfo)){const e=null===(l=null===(a=u[0])||void 0===a?void 0:a.layer)||void 0===l?void 0:l.elevationInfo;this.drawingLayer.set("elevationInfo",e),this.nextPossibleSelectionLayer.set("elevationInfo",e)}this.newFeatureSelection=!0,this.setState({noGraphicAfterFirstSelection:!0}),c=new H.default({geometry:null===(r=u[0])||void 0===r?void 0:r.geometry,attributes:(null===(d=u[0])||void 0===d?void 0:d.attributes)?null===(h=u[0])||void 0===h?void 0:h.attributes:{}}),c.attributes.esriCTFeatureLayerId=t,i&&this.mapView.clearSelectedFeatures();break}}(this.drawingLayer||this.bufferLayer)&&(this.drawingLayer.removeAll(),this.bufferLayer.removeAll()),c?(this.setState({drawModeActive:!1,noFeaturesError:!1,viewModelErrorState:!1}),t.geometryUtils.projectToSpatialReference([c.geometry],this.state.jimuMapView.view.spatialReference).then((e=>{(null==e?void 0:e.length)>0&&(c.geometry=e[0]),this.selectFeatureForProfiling(c)}),(e=>{console.log(e),this.selectFeatureForProfiling(c)}))):(this.state.selectModeActive&&this.state.currentSketchVM.create("point"),this.setState({loadingIndicator:!1,noFeaturesError:!0},(()=>{setTimeout((()=>{var e;null===(e=this.mapView)||void 0===e||e.clearSelectedFeatures()}),100)})))},this.checkForIntersectingLayer=e=>new Promise((i=>{var s,o,n,a,l;const r=[];if((null===(s=this.intersectingLayersAtRuntime)||void 0===s?void 0:s.length)>0){const e=null===(n=null===(o=this._defaultViewModel)||void 0===o?void 0:o.input)||void 0===n?void 0:n.geometry,i=t.DataSourceManager.getInstance();(null===(l=null===(a=this.props.config.configInfo[this.state.currentDatasource])||void 0===a?void 0:a.assetSettings)||void 0===l?void 0:l.layers).forEach((t=>{if(this.intersectingLayersAtRuntime.includes(t.layerId)){const s=i.getDataSource(t.layerId);s&&s.layer&&this.considerLayerVisibility(s.id)&&r.push(this.queryForIntersectingLayers(t,e))}}))}Promise.all(r).then((t=>{e||this.setState({intersectionResult:t}),i(t)}))})),this.queryForIntersectingLayers=(e,i)=>be(this,void 0,void 0,(function*(){const s=this.bufferGraphics,o=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.layerId);return new Promise((t=>{var n,a,l,r;if("esriGeometryPolyline"===(null===(n=null==o?void 0:o.layerDefinition)||void 0===n?void 0:n.geometryType)||"esriGeometryPoint"===(null===(a=null==o?void 0:o.layerDefinition)||void 0===a?void 0:a.geometryType)){const n={};n.geometry=(null==s?void 0:s.geometry)?s.geometry.toJSON():i.toJSON(),n.returnGeometry=!0,n.returnZ=!0;const a=this.filterExistingFeatures(o);a&&(n.where=a),n.outFields=[o.layerDefinition.objectIdField],e.displayField&&!n.outFields.includes(e.displayField)&&n.outFields.push(e.displayField),(null===(l=e.elevationSettings)||void 0===l?void 0:l.field1)&&!n.outFields.includes(e.elevationSettings.field1)&&n.outFields.push(e.elevationSettings.field1),(null===(r=e.elevationSettings)||void 0===r?void 0:r.field2)&&!n.outFields.includes(e.elevationSettings.field2)&&n.outFields.push(e.elevationSettings.field2),n.outFields=this.getOutfieldsForDs(o),n.notAddFieldsToClient=!0,n.outSR=this.mapView.view.spatialReference.toJSON(),n.distance=.1,n.units="esriSRUnit_Meter";try{o.query(n).then((n=>{const a=[];(null==n?void 0:n.records.length)>0&&n.records.forEach((e=>{const t=e.feature,o=[],n=[],l={connectedFeatureForProfiling:n,disconnectedFeatureForProfiling:o,intersectingFeature:t,record:e},r=t.geometry;if("polyline"===r.type){let e=i;const t=N.default.intersect(r,s?s.geometry:e);if(t&&n.push(t),s){const t=s.geometry;e=new z.default({hasZ:t.hasZ,hasM:t.hasM,paths:t.rings,spatialReference:t.spatialReference})}const a=N.default.intersectLinesToPoints(r,e);a.length>0&&a.forEach((e=>{if(t){N.default.intersects(e,t)||o.push(e)}else o.push(e)}))}a.push(l)}));const l={title:o.getLabel(),settings:e,intersectionResult:a,inputGeometry:i};t(l)}),(e=>{console.log(e),t(null)}))}catch(e){t(null)}}else t(null)}))})),this.considerLayerVisibility=e=>{const t=this.mapView.getJimuLayerViewByDataSourceId(e).layer;return t.visible&&(t.minScale>=this.mapView.view.scale&&t.maxScale<=this.mapView.view.scale||0===t.minScale&&t.maxScale<=this.mapView.view.scale||0===t.maxScale&&t.minScale>=this.mapView.view.scale||0===t.minScale&&0===t.maxScale)},this.queryForIndividualLayers=e=>{var i,s;const o=[],n=t.DataSourceManager.getInstance();if(this.canShowSelectAndDrawOptions(this.props.config.configInfo[this.state.currentDatasource])&&this.canShowProfilingForBackward(this.props.config.configInfo[this.state.currentDatasource])){if((null===(i=this.props.config.configInfo[this.state.currentDatasource])||void 0===i?void 0:i.profileSettings.layers.length)>0){(null===(s=this.props.config.configInfo[this.state.currentDatasource])||void 0===s?void 0:s.profileSettings.layers).forEach((t=>{if(this.selectableLayersAtRuntime.includes(t.layerId)){const i=n.getDataSource(t.layerId);i&&i.layer&&this.considerLayerVisibility(i.id)&&o.push(this.queryIndividualLayer(i.layer,i,e))}}))}}else this.selectableLayersAtRuntime.forEach((t=>{const i=n.getDataSource(t);if(i&&i.layer&&this.considerLayerVisibility(i.id)){const t=i.getLayerDefinition();(null==t?void 0:t.geometryType)&&"esriGeometryPolyline"===t.geometryType&&o.push(this.queryIndividualLayer(i.layer,i,e))}}));return o},this.queryIndividualLayer=(e,t,i)=>be(this,void 0,void 0,(function*(){const s=this.getMetersForVerticalSR(e),o=this.filterExistingFeatures(t),n=e.definitionExpression,a=Date.now(),l={};l.geometry=i.toJSON(),l.returnFullGeometry=!0,l.returnGeometry=!0,l.returnZ=!0,l.outFields=this.getOutfieldsForDs(t),l.notAddFieldsToClient=!0,l.outSR=this.mapView.view.spatialReference.toJSON(),l.where=o?n?o+" AND "+n+" AND "+a+"="+a:o+" AND "+a+"="+a:n?n+" AND "+a+"="+a:a+"="+a;let r=[];try{yield t.query(l).then((e=>{const i=[];(null==e?void 0:e.records.length)>0&&e.records.forEach((e=>{const o=e.feature;if(i.push(o),s){const e=W.default.getMetersPerUnitForSR(new _.default(this.mapView.view.spatialReference.toJSON())),t=o.geometry;t.paths.length>0&&t.paths.forEach((t=>{t.length>0&&t.forEach((t=>{t.length>1&&(t[2]=t[2]*s/e)}))}))}o.attributes.esriCTFeatureLayerId=t.dataSourceJson.id})),r=i}),(e=>{console.log(e)}))}catch(e){r=[]}return r})),this.getMetersForVerticalSR=e=>{var t,i,s,o;let n=1;return n=(null===(i=null===(t=e.sourceJSON)||void 0===t?void 0:t.sourceSpatialReference)||void 0===i?void 0:i.vcsWkid)?W.default.getMetersPerVerticalUnitForSR(new _.default({wkid:e.sourceJSON.sourceSpatialReference.vcsWkid})):(null===(o=null===(s=e.sourceJSON)||void 0===s?void 0:s.sourceSpatialReference)||void 0===o?void 0:o.vcsWkt)?W.default.getMetersPerVerticalUnitForSR(new _.default({wkid:e.sourceJSON.sourceSpatialReference.vcsWkt})):null,n},this.filterExistingFeatures=e=>{let t="";const i=e.layer.objectIdField,s=this.drawingLayer.graphics.filter((t=>{var i;return!(!(null===(i=null==t?void 0:t.attributes)||void 0===i?void 0:i.hasOwnProperty("esriCTFeatureLayerId"))||t.attributes.esriCTFeatureLayerId!==e.dataSourceJson.id)}));return s.forEach(((o,n)=>{var a;(null===(a=null==o?void 0:o.attributes)||void 0===a?void 0:a.hasOwnProperty("esriCTFeatureLayerId"))&&o.attributes.esriCTFeatureLayerId===e.dataSourceJson.id&&(n===s.length-1?t+=i+" <> "+o.attributes[i]:t+=i+" <> "+o.attributes[i]+" and ")})),t},this.selectFeatureForProfiling=e=>{let t=!1,i=!1;const s=this.drawingLayer.graphics.length;if(s>0){const o=this.drawingLayer.graphics.getItemAt(0).geometry,n=this.drawingLayer.graphics.getItemAt(s-1).geometry,a=o.getPoint(0,0),l=n.getPoint(0,n.paths[0].length-1),r=e.geometry.getPoint(0,0),d=e.geometry.getPoint(0,e.geometry.paths[0].length-1);N.default.intersects(r,a)?(t=!0,i=!0):N.default.intersects(d,a)?(t=!0,i=!1):N.default.intersects(d,l)?(t=!1,i=!0):N.default.intersects(r,l)&&(t=!1,i=!1)}const o={type:"simple-line",color:new Y.default(this.state.graphicsHighlightColor?this.state.graphicsHighlightColor:"#00ffff").toRgba(),width:5},n=e.geometry;if(i){const e=[];for(let t=n.paths.length-1;t>=0;t--){const i=[];for(let e=n.paths[t].length-1;e>=0;e--)i.push(n.paths[t][e]);e.push(i)}n.paths=e}const a=new H.default({geometry:n,attributes:e.attributes,symbol:o});let l=!1;!this.state.addToSelectionTool&&this._defaultViewModel&&(this._defaultViewModel.input=a,l=!0),t?this.drawingLayer.graphics.add(a,0):this.drawingLayer.graphics.add(a),this.nextPossibleSelectionLayer.removeAll(),setTimeout((()=>{this.renderChartOnSelect(l),this.highlightNextPossibleSelection()}),200)},this.createSinglePathPolyline=e=>{const t=[];e.paths.forEach((e=>{e.forEach((e=>t.push(e)))}));const i=new z.default({hasZ:e.hasZ,spatialReference:e.spatialReference.toJSON()});return i.addPath(t),i},this.renderChartOnSelect=e=>{if(this.state.addToSelectionTool){let t;if(this.drawingLayer.graphics.length>1){const e=new z.default({spatialReference:this.drawingLayer.graphics.getItemAt(0).geometry.spatialReference.toJSON(),hasZ:!1});let i=[];this.drawingLayer.graphics.forEach((t=>{const s=t.geometry;if(s.hasZ&&(e.hasZ=!0),s.paths.length>1)s.paths.forEach((t=>{i.length>0?(t.forEach((e=>i.push(e))),e.addPath(i),i=[]):e.addPath(t)}));else{const t=e.paths.length;t>0?s.paths.forEach((i=>{i.forEach((i=>e.paths[t-1].push(i)))})):s.paths.forEach((e=>{e.forEach((e=>i.push(e)))}))}})),i.length>0&&e.addPath(i),t=new H.default({geometry:e})}else 1===this.drawingLayer.graphics.length&&(t=this.drawingLayer.graphics.getItemAt(0));!e&&this._defaultViewModel&&(this._defaultViewModel.input=t)}},this.highlightNextPossibleSelection=()=>{let e,t,i,s;const o=this.drawingLayer.graphics.length;if(o>0){i=this.drawingLayer.graphics.getItemAt(0).geometry,e=i.getPoint(0,0);let n=i.paths[0].length-1;t=i.getPoint(0,n),o>1&&(s=this.drawingLayer.graphics.getItemAt(o-1).geometry,n=s.paths[0].length-1,t=s.getPoint(0,n));const a=new H.default({geometry:e});this.nextPossibleSelectionLayer.graphics.add(a);const l=new H.default({geometry:t});this.nextPossibleSelectionLayer.graphics.add(l),this.queryForNextPossibleSelection([e,t])}},this.queryForNextPossibleSelection=e=>{let t=[];e.forEach((e=>{t=t.concat(this.queryForIndividualLayers(this.pointToExtent(e)))})),this.setState({nextPossibleloadingIndicator:!0}),Promise.all(t).then((t=>{this.setState({nextPossibleloadingIndicator:!1});const i=[],s=t.flat();(null==s?void 0:s.length)>0&&(s.forEach((t=>{var s,o,n,a,l;if((null===(o=null===(s=null==t?void 0:t.geometry)||void 0===s?void 0:s.paths)||void 0===o?void 0:o.length)>0){const s=t.geometry.getPoint(0,0),o=t.geometry.paths[t.geometry.paths.length-1].length-1,r=t.geometry.getPoint(0,o);if(s&&N.default.intersects(e[0],s)||r&&N.default.intersects(e[0],r)||s&&N.default.intersects(e[1],s)||r&&N.default.intersects(e[1],r)){const e={type:"simple-line",color:[252,252,3,.8],style:"short-dot",width:"3d"===(null===(l=null===(a=null===(n=this.state)||void 0===n?void 0:n.jimuMapView)||void 0===a?void 0:a.view)||void 0===l?void 0:l.type)?7:4},s=new H.default({geometry:t.geometry,attributes:t.attributes,symbol:e});i.push(s)}}})),i&&i.length>0&&this.nextPossibleSelectionLayer.graphics.addMany(i)),setTimeout((()=>{this.updateStateCanAddToSelection()}),200)}),(e=>{console.log(e),this.updateStateCanAddToSelection()}))},this.updateStateCanAddToSelection=()=>{var e;null===(e=this.state.currentSketchVM)||void 0===e||e.cancel();let t=!1;this.nextPossibleSelectionLayer.graphics.filter((e=>"polyline"===e.geometry.type)).length>0?t=!0:this.newFeatureSelection?this.setState({noGraphicAfterFirstSelection:!0}):this.setState({noGraphicAfterFirstSelection:!1}),t?this._activateAddToSelectionTool():this._deActivateAddToSelectionTool()},this._activateAddToSelectionTool=()=>{var e;this.state.addToSelectionTool||this.setState({addToSelectionTool:!0}),this.state.jimuMapView&&this.state.jimuMapView.view&&(this.state.jimuMapView.view.popupEnabled=!1),this._displayAddToSelectionCursor(),null===(e=this.nextPossibleSelectionLayer)||void 0===e||e.set("visible",!0)},this._deActivateAddToSelectionTool=()=>{var e;this.state.addToSelectionTool&&this.setState({addToSelectionTool:!1}),this.state.jimuMapView&&this.state.jimuMapView.view&&(this.state.jimuMapView.view.popupEnabled=!0),this._displayDefaultCursor(),null===(e=this.nextPossibleSelectionLayer)||void 0===e||e.set("visible",!1)},this._displayAddToSelectionCursor=()=>{this.state.jimuMapView&&this.state.jimuMapView.view&&this.state.jimuMapView.view&&this.state.jimuMapView.view.container&&null!==this.state.jimuMapView.view.container.style.cursor&&(this.state.jimuMapView.view.container.style.cursor="copy")},this.activateDrawOrSelectTool=()=>{this.state.currentSketchVM&&((this.state.drawModeActive||this.state.selectModeActive)&&this.state.currentSketchVM.cancel(),this.setState({onDrawingComplete:!1,startChartRendering:!1,viewModelErrorState:!1,loadingIndicator:!1},(()=>{this.state.drawModeActive&&this._defaultViewModel&&this._defaultViewModel.start({mode:"sketch"}),this.state.selectModeActive&&this.state.currentSketchVM.create("point")})))},this.destroyDrawingLayers=()=>{this.drawingLayer&&(this.drawingLayer.removeAll(),this.drawingLayer.destroy()),this.nextPossibleSelectionLayer&&(this.nextPossibleSelectionLayer.removeAll(),this.nextPossibleSelectionLayer.destroy()),this.bufferLayer&&(this.bufferLayer.removeAll(),this.bufferLayer.destroy()),this.intersectionHighlightLayer&&(this.intersectionHighlightLayer.removeAll(),this.intersectionHighlightLayer.destroy()),this.hideChartPosition()},this._displayDefaultCursor=()=>{this.state.jimuMapView&&this.state.jimuMapView.view&&this.state.jimuMapView.view&&this.state.jimuMapView.view.container&&null!==this.state.jimuMapView.view.container.style.cursor&&(this.state.jimuMapView.view.container.style.cursor=null)},this.pointToExtent=(e,t=5)=>{const i=t*(this.state.jimuMapView.view.extent.width/this.state.jimuMapView.view.width),s={xmin:e.x-i,ymin:e.y-i,xmax:e.x+i,ymax:e.y+i,spatialReference:this.state.jimuMapView.view.spatialReference};return new ue.default(s)},this.selectableLayersAvailableAtRuntime=e=>{this.selectableLayersAtRuntime=e,this.isSelectableLayersChangedAtRuntime=!0},this.intersectingLayersAvailableAtRuntime=e=>{this.intersectingLayersAtRuntime=e,this.resultsAfterIntersectionTimeout&&clearTimeout(this.resultsAfterIntersectionTimeout),this.resultsAfterIntersectionTimeout=setTimeout((()=>{this.resultsAfterIntersectionTimeout=null,this.createBufferGraphics()}),500)},this.onSelectButtonClicked=()=>{this.setState({initialStage:!1,resultStage:!0,selectModeActive:!0,drawModeActive:!1},(()=>{this.activateDrawOrSelectTool()}))},this.onDrawButtonClicked=()=>{this.setState({initialStage:!1,resultStage:!0,selectModeActive:!1,drawModeActive:!0},(()=>{this.activateDrawOrSelectTool()}))},this.onBackClick=()=>{this.clearAll(),this.getSelectableLayers(this.state.currentDatasource),this.setState({initialStage:!0,startChartRendering:!1,onDrawingComplete:!1,resultStage:!1,drawModeActive:!1,selectModeActive:!1})},this.clearAll=e=>{var t;this._defaultViewModel&&this._defaultViewModel.clear(),(this.state.drawModeActive||this.state.selectModeActive)&&(null===(t=this.state.currentSketchVM)||void 0===t||t.cancel()),this._deActivateAddToSelectionTool(),this.clearGraphics(),!e&&this.mapView.clearSelectedFeatures(),this.clearChart()},this.clearGraphics=()=>{this.drawingLayer&&this.drawingLayer.removeAll(),this.nextPossibleSelectionLayer&&this.nextPossibleSelectionLayer.removeAll(),this.bufferLayer&&this.bufferLayer.removeAll(),this.intersectionHighlightLayer&&this.intersectionHighlightLayer.removeAll(),this.hideChartPosition()},this.clearChart=()=>{this.setState({profileResult:null,noFeaturesError:!1},(()=>{var e;this.buildStatsValuesAsOutput(this.state.profileResult,null===(e=this.props.outputDataSources)||void 0===e?void 0:e[0],"","",!1)}))},this.activateToolForNewProfile=()=>{this.clearAll(),this.setState({initialStage:!1,resultStage:!0},(()=>{this.activateDrawOrSelectTool()}))},this.onDoneButtonCLicked=()=>{let e=!1;return this._defaultViewModel.stop(),"created"!==this._defaultViewModel.state&&"selected"!==this._defaultViewModel.state||(e=!0),e?this.stopFurtherSelectingLines():this.activateDrawOrSelectTool(),e},this.stopFurtherSelectingLines=()=>{this._deActivateAddToSelectionTool(),this.nextPossibleSelectionLayer&&this.nextPossibleSelectionLayer.removeAll()},this.highlightChartPosition=e=>{this._defaultViewModel&&(this._defaultViewModel.hoveredChartPosition=e)},this.hideChartPosition=()=>{this._defaultViewModel&&(this._defaultViewModel.hoveredChartPosition=null)},this.onViewsCreate=e=>{this.setState({isMapLoaded:!0})},this.renderFrontLandingPage=()=>{var s,o;return(0,t.jsx)("div",{tabIndex:-1,className:"h-100 w-100 d-flex align-items-center mainSection"},(0,t.jsx)("div",{tabIndex:-1,className:"adjust-cards"},(0,t.jsx)(i.Card,{tabIndex:0,"aria-label":this.nls("selectLinesDesc"),button:!0,"data-testid":"selectButton",className:(0,t.classNames)("front-cards mt-4 mb-4 shadow","default"===this.state.currentDatasource||this.state.lineLayersNotFound?"hidden":"front-section"),onClick:this.onSelectButtonClicked,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onSelectButtonClicked()}},(0,t.jsx)(i.CardBody,{className:"w-100 h-100 p-4"},(0,t.jsx)("h5",{className:"text-truncate",style:{textAlign:"center"}},this.nls("selectLinesLabel")),(0,t.jsx)("p",{title:this.nls("selectLinesDesc"),className:"m-4 userGuideInfo"},this.nls("selectLinesDesc")),(0,t.jsx)("div",{style:{textAlign:"center"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("selectButtonLabel"),title:this.nls("selectButtonLabel"),size:"default",type:"secondary",className:"text-break"},(null===(s=this.props.config.generalSettings)||void 0===s?void 0:s.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:"12",icon:we.selectIcon}),this.nls("selectButtonLabel")))))),(0,t.jsx)(i.Card,{tabIndex:0,"aria-label":this.nls("drawProfileDesc"),button:!0,"data-testid":"drawButton",className:(0,t.classNames)("front-cards front-section mt-4 mb-4 shadow","default"===this.state.currentDatasource||this.state.lineLayersNotFound?"h-100 ":""),onClick:this.onDrawButtonClicked,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onDrawButtonClicked()}},(0,t.jsx)(i.CardBody,{className:"w-100 h-100 p-4"},(0,t.jsx)("h5",{className:"text-truncate",style:{textAlign:"center"}},this.nls("drawProfileLabel")),(0,t.jsx)("p",{title:this.nls("drawProfileDesc"),className:"m-4 userGuideInfo"},this.nls("drawProfileDesc")),(0,t.jsx)("div",{style:{textAlign:"center"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("drawButtonLabel"),title:this.nls("drawButtonLabel"),size:"default",type:"secondary",className:"text-break"},(null===(o=this.props.config.generalSettings)||void 0===o?void 0:o.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:"12",icon:we.drawIcon}),this.nls("drawButtonLabel"))))))))},this.resetToDefault=()=>{var e,t;this.buildStatsValuesAsOutput(null,null===(e=this.props.outputDataSources)||void 0===e?void 0:e[0],this.state.selectedElevationUnit,this.state.selectedLinearUnit,!1),(this.state.drawModeActive||this.state.selectModeActive)&&(null===(t=this.state.currentSketchVM)||void 0===t||t.cancel()),this._defaultViewModel&&this._defaultViewModel.clear(),this.clearGraphics(),this._displayDefaultCursor()},this.defaultConfig=this.createDefaultConfigForDataSource(),this.newFeatureSelection=!1,this.createDrawingLayers(),this.activeCurrentDs="default",this.selectableLayersAtRuntime=[],this.intersectingLayersAtRuntime=[],this.isSelectableLayersChangedAtRuntime=!1,this._defaultViewModel=null,this.selectedBufferValues=null;const c=this.props.config.configInfo[this.props.config.activeDataSource];this.selectedUnit=M(c,this.props.portalSelf),this.bufferGraphics=null,this.state={initialStage:!0,resultStage:!1,selectModeActive:null===(o=this.props.config.generalSettings)||void 0===o?void 0:o.isSelectToolActive,addToSelectionTool:!1,drawModeActive:null===(n=this.props.config.generalSettings)||void 0===n?void 0:n.isDrawToolActive,onDrawingComplete:!1,currentDatasource:this.props.config.activeDataSource,currentSketchVM:null,jimuMapView:null,startChartRendering:!1,groundColor:null===(a=null==c?void 0:c.profileChartSettings)||void 0===a?void 0:a.groundColor,graphicsHighlightColor:null===(r=null==c?void 0:c.profileChartSettings)||void 0===r?void 0:r.graphicsHighlightColor,chartColorRender:"",customElevationLayer:null===(d=null==c?void 0:c.profileChartSettings)||void 0===d?void 0:d.isCustomElevationLayer,elevationLayer:null===(h=null==c?void 0:c.profileChartSettings)||void 0===h?void 0:h.elevationLayerURL,profileResult:null,selectedLinearUnit:this.selectedUnit[1],selectedElevationUnit:this.selectedUnit[0],noFeaturesError:!1,profileLineLayers:[],lineLayersNotFound:!(this.canShowSelectAndDrawOptions(c)&&this.canShowProfilingForBackward(c)&&0!==c.profileSettings.layers.length||this.canShowSelectAndDrawOptions(c)&&!this.canShowProfilingForBackward(c)),viewModelErrorState:!1,profileErrorMsg:"",noGraphicAfterFirstSelection:!1,onWidgetLoadShowLoadingIndicator:!0,loadingIndicator:!1,nextPossibleloadingIndicator:!1,selectedFeatureRecord:null,intersectionResult:null,chartDataUpdateTime:0,isMapLoaded:!1,layersLoaded:!1,dsToGetSelectedOnLoad:""}}render(){var e,n,a,l;const r=this.renderFrontLandingPage();let d;const h=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0];if(this.props.hasOwnProperty("useMapWidgetIds")&&this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length&&(d=(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:this.props.useMapWidgetIds[0],onActiveViewChange:this.activeViewChangeHandler.bind(this),onViewsCreate:this.onViewsCreate})),!h)return this.resetToDefault(),(0,t.jsx)(i.WidgetPlaceholder,{icon:we.elevationIcon,widgetId:this.props.id,"data-testid":"widgetPlaceholder",message:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:this.nls("_widgetLabel")})});let c=null;return this.state.dsToGetSelectedOnLoad&&(null===(e=this.props.useDataSources)||void 0===e?void 0:e.length)&&(c=null===(n=this.props.useDataSources)||void 0===n?void 0:n.filter((e=>e.dataSourceId===this.state.dsToGetSelectedOnLoad)),c=c.length>0?c[0]:null),(0,t.jsx)("div",{css:o(this.props.theme),className:"jimu-widget"},(0,t.jsx)("div",{className:"widget-elevation-profile"},!this.state.layersLoaded&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Loading,{type:i.LoadingType.Donut}),(0,t.jsx)("p",{className:"loading-text pt-2"},this.nls("mapLoadingMsg"))),this.state.layersLoaded&&this.state.onWidgetLoadShowLoadingIndicator&&this.state.isMapLoaded&&(0,t.jsx)(i.Loading,{type:i.LoadingType.Donut}),d,c&&(0,t.jsx)(t.DataSourceComponent,{useDataSource:c,onDataSourceInfoChange:this.onDataSourceInfoChange,widgetId:this.props.id}),!this.state.onWidgetLoadShowLoadingIndicator&&this.state.initialStage&&r,!this.state.onWidgetLoadShowLoadingIndicator&&this.state.resultStage&&(0,t.jsx)(de,{theme:this.props.theme,intl:this.props.intl,widgetId:this.props.id,displayLoadingIndicator:this.state.loadingIndicator||this.state.nextPossibleloadingIndicator,activeDataSource:this.state.currentDatasource,commonDsGeneralSettings:this.props.config.generalSettings,defaultConfig:this.defaultConfig,activeDatasourceConfig:this.props.config.configInfo[this.state.currentDatasource],profileResult:this.state.profileResult,intersectionResult:this.state.intersectionResult,visibleGroundProfileStats:null===(l=null===(a=this._defaultViewModel)||void 0===a?void 0:a.visibleProfiles)||void 0===l?void 0:l[0],selectMode:this.state.selectModeActive,drawMode:this.state.drawModeActive,onDrawingComplete:this.state.onDrawingComplete,isNewSegmentsForSelection:this.state.addToSelectionTool,noGraphicAfterFirstSelection:this.state.noGraphicAfterFirstSelection,chartRender:this.state.startChartRendering,chartColorRender:this.state.chartColorRender,noFeaturesFoundError:this.state.noFeaturesError,onNavBack:this.onBackClick,doneClick:this.onDoneButtonCLicked,activateDrawSelectToolForNewProfile:this.activateToolForNewProfile,selectableLayersRuntime:this.selectableLayersAvailableAtRuntime,intersectingLayersRuntime:this.intersectingLayersAvailableAtRuntime,chartPosition:this.highlightChartPosition,hideChartPosition:this.hideChartPosition,buildOutputStatistics:this.buildOutputStatistics,intersectingBufferRuntime:this.onBufferChange,drawingLayer:this.drawingLayer,intersectionHighlightLayer:this.intersectionHighlightLayer,jimuMapView:this.state.jimuMapView,viewModelErrorState:this.state.viewModelErrorState,profileErrorMsg:this.state.profileErrorMsg,chartDataUpdateTime:this.state.chartDataUpdateTime,currentPageId:this.props.currentPageId})))}}Ie.versionManager=xe,Ie.mapExtraStateProps=(e,t)=>{var i,s,o;return{appMode:null===(i=e.appRuntimeInfo)||void 0===i?void 0:i.appMode,selectedFeatureRecords:null===(s=null==t?void 0:t.mutableStateProps)||void 0===s?void 0:s.selectedFeatureRecords,currentPageId:null===(o=e.appRuntimeInfo)||void 0===o?void 0:o.currentPageId}};const Ce=Ie;function Ae(e){C.p=e}})(),A})())}}}));